(()=>{"use strict";const e=e=>{let t=0;return{getLength:()=>e,hit:()=>(t+=1,t),isSunk:()=>t===e,getNumberOfHits:()=>t}},t=e(1);t.hit(),console.log(t.getLength());const o=()=>{const t=[],o=()=>t;function n(e,t){return{position:[e,t],occupiedByShip:!1,hit:!1,ship:null,board:o()}}function i(e){if(!e)return!1;const t=o();let n=[];const i=[],r=[];return e.forEach((e=>{const o=e.position[0],n=e.position[1];[[o-1,n-1],[o-1,n],[o-1,n+1],[o,n+1],[o+1,n+1],[o+1,n],[o+1,n-1],[o,n-1]].forEach((e=>{!1===a(e[0],e[1])&&r.push(t[e[0]][e[1]])}))})),n=r.filter((t=>!1===e.includes(t))),n.forEach((e=>{i.includes(e)||i.push(e)})),i}function r(e,t,o,n,i){const r=[];for(let s=0;s<e;s++)if("horizontal"===n){if(a(t,o+s))return console.log("out of bounds"),!1;r.push(i[t][o+s])}else if("vertical"===n){if(a(t+s,o))return console.log("out of bounds"),!1;r.push(i[t+s][o])}return r}function a(e,t){return e<0||e>9||t<0||t>9}function s(e){return!0===e.occupiedByShip}function l(e,t){return console.log(e,"target fields"),!!e&&!e.some(s)&&!t.some(s)}function c(t,n,a,s="horizontal"){const c=r(t,n,a,s,o());if(!l(c,i(c)))return!1;const d=e(t);return c.forEach((e=>{e.occupiedByShip=!0,e.ship=d})),d}return{createField:n,initGameboard:function(){for(let e=0;e<10;e++){const o=[];for(let t=0;t<10;t++)o.push(n(e,t));t.push(o)}},printBoard:function(){t.forEach((e=>{let t="";e.forEach((e=>{e.occupiedByShip||e.hit?!e.occupiedByShip&&e.hit?t+="|  -  |":e.occupiedByShip&&!e.hit?t+="|  O  |":e.occupiedByShip&&e.hit&&(t+="|  X  |"):t+=`| ${e.position} |`})),console.log(t)}))},getBoard:o,findTargetFields:r,findNeighbourFields:i,canShipBePlaced:l,placeShip:c,receiveAttack:function(e,o){return a(e,o)?(console.log("out of bounds"),!1):t[e][o].hit?(console.log("field already hit"),!1):(null!==t[e][o].ship&&t[e][o].ship.hit(),t[e][o].hit=!0,t[e][o])},areAllShipsSunk:function(){const e=[];return t.forEach((t=>{const o=t.filter((e=>!0===e.occupiedByShip));e.push(...o)})),!!e.every((e=>!0===e.hit))},placeShipsRandomly:function(e){const t=[];let o=1;for(;t.length!==e;){const e=Math.floor(10*Math.random()),n=Math.floor(10*Math.random());let i;switch(Math.floor(2*Math.random())){case 1:i="vertical";break;case 0:i="horizontal"}const r=c(o,e,n,i);!1!==r&&(t.push(r),o++)}}}};let n,i,r,a=0;function s(e,t,o){return!(e>9||e<0||t<0||t>9)&&!0!==o[e][t].hit}function l(){return[Math.floor(10*Math.random()),Math.floor(10*Math.random())]}function c(e,t,o){let n=e.position[0],i=e.position[1],r=t.position[0],a=t.position[1];const l=[];let c;if(n===r?c="horizontal":i===a&&(c="vertical"),console.log(c),"horizontal"===c){i>a&&(n=t.position[0],i=t.position[1],r=e.position[0],a=e.position[1]);const o=[n,i-1],s=[r,a+1];l.push(o,s)}else if("vertical"===c){n>r&&(n=t.position[0],i=t.position[1],r=e.position[0],a=e.position[1]);const o=[n-1,i],s=[r+1,a];l.push(o,s)}console.log(l,"possible fields");const d=l.filter((e=>s(e[0],e[1],o.getBoard())));return console.log(d,"target fields"),d}const d=(e,t)=>{const o=e;let d=t;function u(e){const t=e.getPlayersTurn();switch(d){case!0:d=!1;break;case!1:d=!0}switch(t){case!0:e.setPlayersTurn(!1);break;case!1:e.setPlayersTurn(!0)}}return{attack:function(e,t,p,h){if(u(t),!o)return console.log("player one turn",d),console.log("player two turn",t.getPlayersTurn()),e.receiveAttack(p,h);console.log("player one turn",d),console.log("player two turn",t.getPlayersTurn()),function(e){if(void 0!==n&&!0===n.isSunk()&&(a=0,n=void 0),1===a){const t=function(e,t){const o=e.position[0],n=e.position[1],i=[[o,n+1],[o,n-1],[o+1,n],[o-1,n]].filter((e=>s(e[0],e[1],t.getBoard())));return i}(i,e),o=t[Math.floor(Math.random()*t.length)];return r=e.receiveAttack(...o),null!==r.ship&&(a+=1),void console.log(n)}if(a>1){console.log("hitedField",i,"temp hited field",r);const t=c(i,r,e),o=t[Math.floor(Math.random()*t.length)],n=e.receiveAttack(...o);return void(null!==n.ship&&(r=n,a+=1))}let t=l();for(;!1===s(t[0],t[1],e.getBoard());)t=l();i=e.receiveAttack(...t),null!==i.ship&&(n=i.ship,a+=1)}(e)},getPlayersTurn:()=>d,setPlayersTurn:e=>{d=e},isMoveLegal:function(e,t,o){return!0!==o[e][t].hit},changePlayersTurn:u,findRandomMove:function(){return[Math.floor(10*Math.random()),Math.floor(10*Math.random())]}}};let u,p;const h=()=>u,f=()=>p,m=d(!1,!0),g=d(!0,!1),y=function(){const e=o(),t=b(),n=document.querySelector("main"),i=document.querySelector(".player-one-board"),r=document.querySelector(".player-two-board"),a=document.querySelector(".switch-position"),s=[];let l,c,d=t.getPlayerOneGameboard(),u="init",p=1,h="vertical";function f(e,t){t.innerHTML="",e.forEach((e=>{e.forEach((e=>{!function(e,t){const o=document.createElement("div");o.classList.add("field"),null!==e.ship&&o.classList.add("ship"),null!==e.ship&&t===r&&o.classList.add("hidden"),null!==e.ship&&e.ship.isSunk()&&o.classList.add("sunk"),!0===e.hit&&o.classList.add("hit"),o.board=e.board,o.field=e,s.includes(e.postion)||s.push(e.position),"init"===u?(o.addEventListener("mouseover",E),o.addEventListener("mouseout",S),o.addEventListener("click",G),o.addEventListener("click",L)):"game"===u&&o.addEventListener("click",y),t.appendChild(o)}(e,t)}))}))}function g(e,t){f(e,i),f(t,r)}function y(e){if(e.target.parentElement!==r)return;if(!0!==m.getPlayersTurn())return;if(!0===e.target.field.hit)return;const o=e.target.field.position[0],n=e.target.field.position[1];if(t.play(o,n),t.isGameFinished()){const e=t.getPlayerOneGameboard(),o=t.getPlayerTwoGameboard();g(e.getBoard(),o.getBoard())}else f(e.target.parentElement.board,e.target.parentElement),setTimeout((()=>{t.play(),f(d.getBoard(),i)}),"1500")}function v(o){if(d=t.getPlayerOneGameboard(),i.boardObject=d,p>5)return;if(o.target.parentElement.boardObject!==d)return;const n=Array.from(document.querySelectorAll(".field"));l=o.target.field.position[0],c=o.target.field.position[1];const r=d.getBoard(),a=e.findTargetFields(p,l,c,h,r);let s,u;return!1!==a&&(s=a.map((e=>e.position)),u=n.filter((e=>!0===s.includes(e.field.position)))),u||void 0}function E(e){const t=v(e);t&&t.forEach((e=>e.classList.add("active")))}function S(e){const t=v(e);t&&t.forEach((e=>e.classList.remove("active")))}function G(e){if(p>5||e.target.parentElement===r)return;const o=d,s=d.getBoard(),u=i;!1!==o.placeShip(p,l,c,h)&&(f(s,u),p+=1),p>5&&function(){const e=document.createElement("div");e.classList.add("start-game"),e.classList.add("modal");const o=document.createElement("button");o.classList.add("start-game-button"),o.textContent="Start Game",n.appendChild(e),e.appendChild(o),o.addEventListener("click",(()=>{n.removeChild(e),t.startGame(),a.classList.toggle("hidden")}))}()}function L(){const e=t.getPlayerOneGameboard(),o=t.getPlayerTwoGameboard();p>5&&(u="game"),p<5&&(u="init"),g(e.getBoard(),o.getBoard())}return a.addEventListener("click",(function(){switch(h){case"vertical":h="horizontal";break;case"horizontal":h="vertical"}})),{renderGameboards:g,createEndGamePopup:function(e){const o=document.createElement("div");o.classList.add("end-game"),o.classList.add("modal");const i=document.createElement("p");i.classList.add("end-game-text"),i.textContent=`${e} Won`;const r=document.createElement("button");r.classList.add("new-game-button"),r.textContent="New Game",n.appendChild(o),o.appendChild(i),o.appendChild(r),r.addEventListener("click",(()=>{!function(){const e=document.querySelector(".modal");n.removeChild(e),u="init",p=1,t.initGameboards()}(),a.classList.toggle("hidden")}))},removeFieldsEventListeners:function(){document.querySelectorAll(".field").forEach((e=>{e.removeEventListener("click",y)}))},playerOneDisplay:i,playerTwoDisplay:r}}();function b(){function e(){return!0===u.areAllShipsSunk()||!0===p.areAllShipsSunk()}function t(e){y.createEndGamePopup(e),y.removeFieldsEventListeners()}return{startGame:function(){m.setPlayersTurn(!0),g.setPlayersTurn(!1),p.placeShipsRandomly(5),y.renderGameboards(u.getBoard(),p.getBoard())},play:function(o,n){const i=m.getPlayersTurn(),r=g.getPlayersTurn();if(!0===i?m.attack(p,g,o,n):!0===r&&g.attack(u,m),e()){let e="";!0===u.areAllShipsSunk()&&(e="Player Two"),!0===p.areAllShipsSunk()&&(e="Player One"),t(e)}},endGame:t,isGameFinished:e,initGameboards:function(){const e=y.playerOneDisplay,t=y.playerTwoDisplay;u=o(),p=o(),u.initGameboard(),p.initGameboard(),e.board=u.getBoard(),t.board=p.getBoard(),y.renderGameboards(u.getBoard(),p.getBoard())},getPlayerOneGameboard:h,getPlayerTwoGameboard:f}}const v=b();v.initGameboards();const E=v.getPlayerOneGameboard(),S=v.getPlayerOneGameboard().getBoard();console.log(E.getBoard()),E.printBoard(),console.log(c(S[6][7],S[5][7],E)),window.startGame=v.startGame,window.endGame=v.endGame})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVUzRCxFQUFlMkQsTyIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvc2hpcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2dhbWVib2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2FpLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvcGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2RvbS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgc2hpcEZhY3RvcnkgPSAobGVuZ3RoKSA9PiB7XG4gIFxuICBsZXQgbnVtYmVyT2ZIaXRzID0gMDtcblxuICBjb25zdCBnZXRMZW5ndGggPSAoKSA9PiBsZW5ndGg7XG4gIGNvbnN0IGdldE51bWJlck9mSGl0cyA9ICgpID0+IG51bWJlck9mSGl0c1xuXG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBudW1iZXJPZkhpdHMgKz0gMVxuICAgIHJldHVybiBudW1iZXJPZkhpdHNcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgaWYgKG51bWJlck9mSGl0cyA9PT0gbGVuZ3RoKSByZXR1cm4gdHJ1ZTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRMZW5ndGgsXG4gICAgaGl0LFxuICAgIGlzU3VuayxcbiAgICBnZXROdW1iZXJPZkhpdHNcbiAgfTtcbn07XG5cbmNvbnN0IHNoaXAgPSBzaGlwRmFjdG9yeSgxKTtcbnNoaXAuaGl0KCk7XG5cbmNvbnNvbGUubG9nKHNoaXAuZ2V0TGVuZ3RoKCkpO1xuZXhwb3J0IHsgc2hpcEZhY3RvcnkgfTtcbiIsImltcG9ydCB7IHNoaXBGYWN0b3J5IH0gZnJvbSBcIi4vc2hpcC5qc1wiO1xuXG5leHBvcnQgY29uc3QgZ2FtZWJvYXJkRmFjdG9yeSA9ICgpID0+IHtcbiAgY29uc3QgYm9hcmQgPSBbXTtcblxuICBjb25zdCBnZXRCb2FyZCA9ICgpID0+IGJvYXJkO1xuXG4gIGZ1bmN0aW9uIGNyZWF0ZUZpZWxkKHgsIHkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcG9zaXRpb246IFt4LCB5XSxcbiAgICAgIG9jY3VwaWVkQnlTaGlwOiBmYWxzZSxcbiAgICAgIGhpdDogZmFsc2UsXG4gICAgICBzaGlwOiBudWxsLFxuICAgICAgYm9hcmQ6IGdldEJvYXJkKCksXG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGluaXRHYW1lYm9hcmQoKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICBjb25zdCBhcnIgPSBbXTtcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGorKykge1xuICAgICAgICBhcnIucHVzaChjcmVhdGVGaWVsZChpLCBqKSk7XG4gICAgICB9XG4gICAgICBib2FyZC5wdXNoKGFycik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcHJpbnRCb2FyZCgpIHtcbiAgICBib2FyZC5mb3JFYWNoKChyb3cpID0+IHtcbiAgICAgIGxldCBzdHJpbmcgPSBcIlwiO1xuICAgICAgcm93LmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICAgIGlmICghZmllbGQub2NjdXBpZWRCeVNoaXAgJiYgIWZpZWxkLmhpdCkge1xuICAgICAgICAgIHN0cmluZyArPSBgfCAke2ZpZWxkLnBvc2l0aW9ufSB8YDtcbiAgICAgICAgfSBlbHNlIGlmICghZmllbGQub2NjdXBpZWRCeVNoaXAgJiYgZmllbGQuaGl0KSB7XG4gICAgICAgICAgc3RyaW5nICs9IGB8ICAtICB8YDtcbiAgICAgICAgfSBlbHNlIGlmIChmaWVsZC5vY2N1cGllZEJ5U2hpcCAmJiAhZmllbGQuaGl0KSB7XG4gICAgICAgICAgc3RyaW5nICs9IFwifCAgTyAgfFwiO1xuICAgICAgICB9IGVsc2UgaWYgKGZpZWxkLm9jY3VwaWVkQnlTaGlwICYmIGZpZWxkLmhpdCkge1xuICAgICAgICAgIHN0cmluZyArPSBcInwgIFggIHxcIjtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBjb25zb2xlLmxvZyhzdHJpbmcpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZmluZE5laWdoYm91ckZpZWxkcyh0YXJnZXRGaWVsZHMpIHtcbiAgICBpZiAoIXRhcmdldEZpZWxkcykgcmV0dXJuIGZhbHNlO1xuICAgIGNvbnN0IGJvYXJkID0gZ2V0Qm9hcmQoKTtcbiAgICBsZXQgZHVwbGljYXRlZE5laWdoYm91cnMgPSBbXTtcbiAgICBjb25zdCBuZWlnaGJvdXJzID0gW107XG4gICAgY29uc3QgcG9zc2JpbGVOZWlnaGJvdXJzID0gW107XG5cbiAgICB0YXJnZXRGaWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgIGNvbnN0IHggPSBmaWVsZC5wb3NpdGlvblswXTtcbiAgICAgIGNvbnN0IHkgPSBmaWVsZC5wb3NpdGlvblsxXTtcblxuICAgICAgLy8gYWxsIHRoZSBwb3NzaWJsZSBuZWlnaGJvdXIgZmllbGRzXG4gICAgICBjb25zdCBwb3NzaWJsZU5laWdoYm91cnNDb29yZGluYXRlcyA9IFtcbiAgICAgICAgW3ggLSAxLCB5IC0gMV0sXG4gICAgICAgIFt4IC0gMSwgeV0sXG4gICAgICAgIFt4IC0gMSwgeSArIDFdLFxuICAgICAgICBbeCwgeSArIDFdLFxuICAgICAgICBbeCArIDEsIHkgKyAxXSxcbiAgICAgICAgW3ggKyAxLCB5XSxcbiAgICAgICAgW3ggKyAxLCB5IC0gMV0sXG4gICAgICAgIFt4LCB5IC0gMV0sXG4gICAgICBdO1xuXG4gICAgICAvLyBwdXNoIHRoZSBuZWlnaGJvdXIgZmllbGRzIHRoYXQgYXJlIG5vdCBvdXQgb2YgYm91bmRzXG4gICAgICBwb3NzaWJsZU5laWdoYm91cnNDb29yZGluYXRlcy5mb3JFYWNoKChjb29yZGluYXRlKSA9PiB7XG4gICAgICAgIGlmIChpc091dE9mQm91bmQoY29vcmRpbmF0ZVswXSwgY29vcmRpbmF0ZVsxXSkgPT09IGZhbHNlKVxuICAgICAgICAgIHBvc3NiaWxlTmVpZ2hib3Vycy5wdXNoKGJvYXJkW2Nvb3JkaW5hdGVbMF1dW2Nvb3JkaW5hdGVbMV1dKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gYWRkIG9ubHkgbmVpZ2hib3VycyB0aGF0IGFyZSBub3QgaW5jbHVkZWQgaW4gdGhlIHRhcmdldCBmaWVsZHMgYXJyYXlcblxuICAgIGR1cGxpY2F0ZWROZWlnaGJvdXJzID0gcG9zc2JpbGVOZWlnaGJvdXJzLmZpbHRlcihcbiAgICAgIChuZWlnaGJvdXIpID0+IHRhcmdldEZpZWxkcy5pbmNsdWRlcyhuZWlnaGJvdXIpID09PSBmYWxzZSxcbiAgICApO1xuXG4gICAgZHVwbGljYXRlZE5laWdoYm91cnMuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgIGlmICghbmVpZ2hib3Vycy5pbmNsdWRlcyhmaWVsZCkpIG5laWdoYm91cnMucHVzaChmaWVsZCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbmVpZ2hib3VycztcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmRUYXJnZXRGaWVsZHMoc2hpcExlbmd0aCwgeCwgeSwgZGlyZWN0aW9uLCBib2FyZCkge1xuICAgIGNvbnN0IHRhcmdldEZpZWxkcyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoZGlyZWN0aW9uID09PSBcImhvcml6b250YWxcIikge1xuICAgICAgICBpZiAoaXNPdXRPZkJvdW5kKHgsIHkgKyBpKSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwib3V0IG9mIGJvdW5kc1wiKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGFyZ2V0RmllbGRzLnB1c2goYm9hcmRbeF1beSArIGldKTtcbiAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSBcInZlcnRpY2FsXCIpIHtcbiAgICAgICAgaWYgKGlzT3V0T2ZCb3VuZCh4ICsgaSwgeSkpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIm91dCBvZiBib3VuZHNcIik7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRhcmdldEZpZWxkcy5wdXNoKGJvYXJkW3ggKyBpXVt5XSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0YXJnZXRGaWVsZHM7XG4gIH1cblxuICBmdW5jdGlvbiBpc091dE9mQm91bmQoeCwgeSkge1xuICAgIGlmICh4IDwgMCB8fCB4ID4gOSB8fCB5IDwgMCB8fCB5ID4gOSkgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZnVuY3Rpb24gY2hlY2tJZkZpZWxkT2NjdXBpZWQoZmllbGQpIHtcbiAgICByZXR1cm4gZmllbGQub2NjdXBpZWRCeVNoaXAgPT09IHRydWU7XG4gIH1cblxuICBmdW5jdGlvbiBjYW5TaGlwQmVQbGFjZWQodGFyZ2V0RmllbGRzLCBuZWlnaGJvdXJGaWVsZHMpIHtcbiAgICBjb25zb2xlLmxvZyh0YXJnZXRGaWVsZHMsIFwidGFyZ2V0IGZpZWxkc1wiKTtcbiAgICBpZiAoIXRhcmdldEZpZWxkcykgcmV0dXJuIGZhbHNlO1xuXG4gICAgLy8gaWYgZmllbGRzIGFyZSBhbHJlYWR5IG9jY3VwaWVkLCBvciBuZWlnaGJvdXIgZmllbGRzIGFyZSBvY2N1cGllZCwgcmV0dXJuIGZhbHNlXG4gICAgaWYgKFxuICAgICAgdGFyZ2V0RmllbGRzLnNvbWUoY2hlY2tJZkZpZWxkT2NjdXBpZWQpIHx8XG4gICAgICBuZWlnaGJvdXJGaWVsZHMuc29tZShjaGVja0lmRmllbGRPY2N1cGllZClcbiAgICApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYWNlU2hpcChzaGlwTGVuZ3RoLCB4LCB5LCBkaXJlY3Rpb24gPSBcImhvcml6b250YWxcIikge1xuICAgIGNvbnN0IGJvYXJkID0gZ2V0Qm9hcmQoKTtcbiAgICBjb25zdCB0YXJnZXRGaWVsZHMgPSBmaW5kVGFyZ2V0RmllbGRzKHNoaXBMZW5ndGgsIHgsIHksIGRpcmVjdGlvbiwgYm9hcmQpO1xuICAgIGNvbnN0IG5laWdoYm91ckZpZWxkcyA9IGZpbmROZWlnaGJvdXJGaWVsZHModGFyZ2V0RmllbGRzKTtcbiAgICBpZiAoIWNhblNoaXBCZVBsYWNlZCh0YXJnZXRGaWVsZHMsIG5laWdoYm91ckZpZWxkcykpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3Qgc2hpcCA9IHNoaXBGYWN0b3J5KHNoaXBMZW5ndGgpO1xuXG4gICAgdGFyZ2V0RmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICBmaWVsZC5vY2N1cGllZEJ5U2hpcCA9IHRydWU7XG4gICAgICBmaWVsZC5zaGlwID0gc2hpcDtcbiAgICB9KTtcbiAgICByZXR1cm4gc2hpcDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYWNlU2hpcHNSYW5kb21seShhbW91bnQpIHtcbiAgICBjb25zdCBwbGFjZWRTaGlwcyA9IFtdO1xuICAgIGxldCBjdXJyZW50U2hpcExlbmdodCA9IDE7XG4gICAgd2hpbGUgKHBsYWNlZFNoaXBzLmxlbmd0aCAhPT0gYW1vdW50KSB7XG4gICAgICBjb25zdCB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgY29uc3QgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIGNvbnN0IHJhbmRvbURpcmVjdGlvbiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpO1xuICAgICAgbGV0IGRpcmVjdGlvbjtcblxuICAgICAgc3dpdGNoIChyYW5kb21EaXJlY3Rpb24pIHtcbiAgICAgICAgY2FzZSAxOlxuICAgICAgICAgIGRpcmVjdGlvbiA9IFwidmVydGljYWxcIjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAwOlxuICAgICAgICAgIGRpcmVjdGlvbiA9IFwiaG9yaXpvbnRhbFwiO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzaGlwID0gcGxhY2VTaGlwKGN1cnJlbnRTaGlwTGVuZ2h0LCB4LCB5LCBkaXJlY3Rpb24pO1xuXG4gICAgICBpZiAoc2hpcCAhPT0gZmFsc2UpIHtcbiAgICAgICAgcGxhY2VkU2hpcHMucHVzaChzaGlwKTtcbiAgICAgICAgY3VycmVudFNoaXBMZW5naHQrKztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiByZWNlaXZlQXR0YWNrKHgsIHkpIHtcbiAgICBpZiAoaXNPdXRPZkJvdW5kKHgsIHkpKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIm91dCBvZiBib3VuZHNcIik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKGJvYXJkW3hdW3ldLmhpdCkge1xuICAgICAgY29uc29sZS5sb2coXCJmaWVsZCBhbHJlYWR5IGhpdFwiKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoYm9hcmRbeF1beV0uc2hpcCAhPT0gbnVsbCkgYm9hcmRbeF1beV0uc2hpcC5oaXQoKTtcblxuICAgIGJvYXJkW3hdW3ldLmhpdCA9IHRydWU7XG4gICAgLy8gcHJpbnRCb2FyZCgpO1xuICAgIHJldHVybiBib2FyZFt4XVt5XVxuICB9XG5cbiAgZnVuY3Rpb24gYXJlQWxsU2hpcHNTdW5rKCkge1xuICAgIGNvbnN0IGZpZWxkc09jY3VwaWVkQnlTaGlwcyA9IFtdO1xuICAgIGJvYXJkLmZvckVhY2goKHJvdykgPT4ge1xuICAgICAgY29uc3Qgb2NjdXBpZWQgPSByb3cuZmlsdGVyKChmaWVsZCkgPT4ge1xuICAgICAgICByZXR1cm4gZmllbGQub2NjdXBpZWRCeVNoaXAgPT09IHRydWU7XG4gICAgICB9KTtcbiAgICAgIGZpZWxkc09jY3VwaWVkQnlTaGlwcy5wdXNoKC4uLm9jY3VwaWVkKTtcbiAgICB9KTtcbiAgICBpZiAoZmllbGRzT2NjdXBpZWRCeVNoaXBzLmV2ZXJ5KChmaWVsZCkgPT4gZmllbGQuaGl0ID09PSB0cnVlKSkgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBjcmVhdGVGaWVsZCxcbiAgICBpbml0R2FtZWJvYXJkLFxuICAgIHByaW50Qm9hcmQsXG4gICAgZ2V0Qm9hcmQsXG4gICAgZmluZFRhcmdldEZpZWxkcyxcbiAgICBmaW5kTmVpZ2hib3VyRmllbGRzLFxuICAgIGNhblNoaXBCZVBsYWNlZCxcbiAgICBwbGFjZVNoaXAsXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBhcmVBbGxTaGlwc1N1bmssXG4gICAgcGxhY2VTaGlwc1JhbmRvbWx5LFxuICB9O1xufTtcbiIsImxldCBoaXRzID0gMDtcbmxldCBoaXRlZFNoaXA7XG5sZXQgaGl0ZWRGaWVsZDtcbmxldCB0ZW1wSGl0ZWRGaWVsZDtcblxuZnVuY3Rpb24gaXNNb3ZlTGVnYWwoeCwgeSwgYm9hcmQpIHtcbiAgaWYgKHggPiA5IHx8IHggPCAwIHx8IHkgPCAwIHx8IHkgPiA5KSByZXR1cm4gZmFsc2U7XG4gIGlmIChib2FyZFt4XVt5XS5oaXQgPT09IHRydWUpIHJldHVybiBmYWxzZTtcbiAgcmV0dXJuIHRydWU7XG59XG5mdW5jdGlvbiBmaW5kUmFuZG9tTW92ZSgpIHtcbiAgY29uc3QgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgY29uc3QgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcblxuICByZXR1cm4gW3gsIHldO1xufVxuXG5mdW5jdGlvbiBmaW5kRm91ckFkamFjZW50RmllbGRzKGZpZWxkLCBib2FyZCkge1xuICBjb25zdCB4ID0gZmllbGQucG9zaXRpb25bMF07XG4gIGNvbnN0IHkgPSBmaWVsZC5wb3NpdGlvblsxXTtcbiAgY29uc3QgcG9zc2libGVGaWVsZHMgPSBbXG4gICAgW3gsIHkgKyAxXSxcbiAgICBbeCwgeSAtIDFdLFxuICAgIFt4ICsgMSwgeV0sXG4gICAgW3ggLSAxLCB5XSxcbiAgXTtcbiAgY29uc3QgdGFyZ2V0RmllbGRzID0gcG9zc2libGVGaWVsZHMuZmlsdGVyKChmaWVsZCkgPT5cbiAgICBpc01vdmVMZWdhbChmaWVsZFswXSwgZmllbGRbMV0sIGJvYXJkLmdldEJvYXJkKCkpLFxuICApO1xuICByZXR1cm4gdGFyZ2V0RmllbGRzO1xufVxuXG5mdW5jdGlvbiBmaW5kQWRqYWNlbnRGaWVsZE9uQXhpcyhmaWVsZE9uZSwgZmllbGRUd28sIGJvYXJkKSB7XG4gIGxldCBhID0gZmllbGRPbmUucG9zaXRpb25bMF07XG4gIGxldCBiID0gZmllbGRPbmUucG9zaXRpb25bMV07XG4gIGxldCB4ID0gZmllbGRUd28ucG9zaXRpb25bMF07XG4gIGxldCB5ID0gZmllbGRUd28ucG9zaXRpb25bMV07XG4gIGNvbnN0IHBvc3NpYmxlRmllbGRzID0gW107XG4gIGxldCBheGlzO1xuICBcblxuICBpZiAoYSA9PT0geCkge1xuICAgIGF4aXMgPSBcImhvcml6b250YWxcIjtcbiAgfSBlbHNlIGlmIChiID09PSB5KSB7XG4gICAgYXhpcyA9IFwidmVydGljYWxcIjtcbiAgfVxuICBjb25zb2xlLmxvZyhheGlzKVxuICBpZiAoYXhpcyA9PT0gXCJob3Jpem9udGFsXCIpIHtcbiAgICBpZiAoYiA+IHkpIHtcbiAgICAgICAgYSA9IGZpZWxkVHdvLnBvc2l0aW9uWzBdXG4gICAgICAgIGIgPSBmaWVsZFR3by5wb3NpdGlvblsxXVxuICAgICAgICB4ID0gZmllbGRPbmUucG9zaXRpb25bMF1cbiAgICAgICAgeSA9IGZpZWxkT25lLnBvc2l0aW9uWzFdXG4gICAgfVxuICAgIGNvbnN0IHRhcmdldEZpZWxkT25lID0gW2EsIGIgLSAxXTtcbiAgICBjb25zdCB0YXJnZXRGaWVsZFR3byA9IFt4LCB5ICsgMV07XG4gICAgcG9zc2libGVGaWVsZHMucHVzaCh0YXJnZXRGaWVsZE9uZSwgdGFyZ2V0RmllbGRUd28pO1xuICB9IGVsc2UgaWYgKGF4aXMgPT09IFwidmVydGljYWxcIikge1xuICAgIGlmIChhID4geCkge1xuICAgICAgICBhID0gZmllbGRUd28ucG9zaXRpb25bMF1cbiAgICAgICAgYiA9IGZpZWxkVHdvLnBvc2l0aW9uWzFdXG4gICAgICAgIHggPSBmaWVsZE9uZS5wb3NpdGlvblswXVxuICAgICAgICB5ID0gZmllbGRPbmUucG9zaXRpb25bMV1cbiAgICAgICAgLy8gY29uc29sZS5sb2coYSwgYilcbiAgICAgICAgLy8gY29uc29sZS5sb2coeCwgeSlcbiAgICB9XG4gICAgY29uc3QgdGFyZ2V0RmllbGRPbmUgPSBbYSAtIDEsIGJdO1xuICAgIGNvbnN0IHRhcmdldEZpZWxkVHdvID0gW3ggKyAxLCB5XTtcbiAgICBwb3NzaWJsZUZpZWxkcy5wdXNoKHRhcmdldEZpZWxkT25lLCB0YXJnZXRGaWVsZFR3byk7XG4gIH1cblxuICBjb25zb2xlLmxvZyhwb3NzaWJsZUZpZWxkcywgJ3Bvc3NpYmxlIGZpZWxkcycpXG4vLyAgIGNvbnNvbGUubG9nKGlzTW92ZUxlZ2FsKHBvc3NpYmxlRmllbGRzWzBdWzBdLCBwb3NzaWJsZUZpZWxkc1swXVsxXSwgYm9hcmQuZ2V0Qm9hcmQoKSkpXG4vLyAgIGNvbnNvbGUubG9nKGlzTW92ZUxlZ2FsKHBvc3NpYmxlRmllbGRzWzFdWzBdLCBwb3NzaWJsZUZpZWxkc1sxXVsxXSwgYm9hcmQuZ2V0Qm9hcmQoKSkpXG4gIGNvbnN0IHRhcmdldEZpZWxkcyA9IHBvc3NpYmxlRmllbGRzLmZpbHRlcigoZmllbGQpID0+IHtcbiAgICByZXR1cm4gaXNNb3ZlTGVnYWwoZmllbGRbMF0sIGZpZWxkWzFdLCBib2FyZC5nZXRCb2FyZCgpKTtcbiAgfSk7XG4gIGNvbnNvbGUubG9nKHRhcmdldEZpZWxkcywgJ3RhcmdldCBmaWVsZHMnKVxuICByZXR1cm4gdGFyZ2V0RmllbGRzO1xufVxuXG4vLyBOYSByYXppZSBhaSBwbyAxIHRyYWZpZW5pdSB1ZGVyemEgdyBqZWRlbiB6IGN6dGVyZWNoIHNsb3TDs3cgdyBva8OzxYJcbmZ1bmN0aW9uIGFpQXR0YWNrKGJvYXJkKSB7XG4gIGlmIChoaXRlZFNoaXAgIT09IHVuZGVmaW5lZCAmJiBoaXRlZFNoaXAuaXNTdW5rKCkgPT09IHRydWUpIHtcbiAgICBoaXRzID0gMDtcbiAgICBoaXRlZFNoaXAgPSB1bmRlZmluZWQ7XG4gIH1cbiAgaWYgKGhpdHMgPT09IDEpIHtcbiAgICBjb25zdCBhZGphY2VudEZpZWxkcyA9IGZpbmRGb3VyQWRqYWNlbnRGaWVsZHMoaGl0ZWRGaWVsZCwgYm9hcmQpO1xuICAgIGNvbnN0IHJhbmRvbU51bSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGFkamFjZW50RmllbGRzLmxlbmd0aCk7XG4gICAgY29uc3QgcmFuZG9tTW92ZSA9IGFkamFjZW50RmllbGRzW3JhbmRvbU51bV07XG4gICAgdGVtcEhpdGVkRmllbGQgPSBib2FyZC5yZWNlaXZlQXR0YWNrKC4uLnJhbmRvbU1vdmUpO1xuICAgIGlmICh0ZW1wSGl0ZWRGaWVsZC5zaGlwICE9PSBudWxsKSB7XG4gICAgICBoaXRzICs9IDE7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coaGl0ZWRTaGlwKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoaGl0cyA+IDEpIHtcbiAgICBjb25zb2xlLmxvZygnaGl0ZWRGaWVsZCcsIGhpdGVkRmllbGQsICd0ZW1wIGhpdGVkIGZpZWxkJywgdGVtcEhpdGVkRmllbGQpXG4gICAgY29uc3QgdGFyZ2V0RmllbGRzID0gZmluZEFkamFjZW50RmllbGRPbkF4aXMoXG4gICAgICBoaXRlZEZpZWxkLFxuICAgICAgdGVtcEhpdGVkRmllbGQsXG4gICAgICBib2FyZCxcbiAgICApO1xuICAgIGNvbnN0IHJhbmRvbU51bSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRhcmdldEZpZWxkcy5sZW5ndGgpO1xuICAgIGNvbnN0IHJhbmRvbU1vdmUgPSB0YXJnZXRGaWVsZHNbcmFuZG9tTnVtXTtcbiAgICBjb25zdCBuZXdIaXRlZEZpZWxkID0gYm9hcmQucmVjZWl2ZUF0dGFjayguLi5yYW5kb21Nb3ZlKTtcbiAgICBpZiAobmV3SGl0ZWRGaWVsZC5zaGlwICE9PSBudWxsKSB7XG4gICAgICB0ZW1wSGl0ZWRGaWVsZCA9IG5ld0hpdGVkRmllbGQ7XG4gICAgICBoaXRzICs9IDE7XG4gICAgfVxuICAgIHJldHVyblxuICB9XG4gIGxldCByYW5kb21Nb3ZlID0gZmluZFJhbmRvbU1vdmUoKTtcbiAgd2hpbGUgKFxuICAgIGlzTW92ZUxlZ2FsKHJhbmRvbU1vdmVbMF0sIHJhbmRvbU1vdmVbMV0sIGJvYXJkLmdldEJvYXJkKCkpID09PSBmYWxzZVxuICApIHtcbiAgICByYW5kb21Nb3ZlID0gZmluZFJhbmRvbU1vdmUoKTtcbiAgfVxuICBoaXRlZEZpZWxkID0gYm9hcmQucmVjZWl2ZUF0dGFjayguLi5yYW5kb21Nb3ZlKTtcbiAgaWYgKGhpdGVkRmllbGQuc2hpcCAhPT0gbnVsbCkge1xuICAgIGhpdGVkU2hpcCA9IGhpdGVkRmllbGQuc2hpcDtcbiAgICBoaXRzICs9IDE7XG4gIH1cbn1cbmV4cG9ydCB7IGFpQXR0YWNrLCBmaW5kQWRqYWNlbnRGaWVsZE9uQXhpcyB9O1xuIiwiaW1wb3J0IHsgYWlBdHRhY2sgfSBmcm9tIFwiLi9haS5qc1wiO1xuXG5leHBvcnQgY29uc3QgcGxheWVyID0gKGFpLCBpc0l0UGxheWVyc1R1cm4pID0+IHtcbiAgY29uc3QgaXNBaSA9IGFpO1xuICBsZXQgcGxheWVyc1R1cm4gPSBpc0l0UGxheWVyc1R1cm47XG4gIGNvbnN0IGdldFBsYXllcnNUdXJuID0gKCkgPT4gcGxheWVyc1R1cm47XG4gIGNvbnN0IHNldFBsYXllcnNUdXJuID0gKHZhbHVlKSA9PiB7XG4gICAgcGxheWVyc1R1cm4gPSB2YWx1ZVxuICB9XG5cbiAgZnVuY3Rpb24gY2hhbmdlUGxheWVyc1R1cm4oc2Vjb25kUGxheWVyKSB7XG4gICAgY29uc3Qgc2Vjb25kUGxheWVyVHVybiA9IHNlY29uZFBsYXllci5nZXRQbGF5ZXJzVHVybigpO1xuICAgIHN3aXRjaCAocGxheWVyc1R1cm4pIHtcbiAgICAgIGNhc2UgdHJ1ZTpcbiAgICAgICAgcGxheWVyc1R1cm4gPSBmYWxzZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGZhbHNlOlxuICAgICAgICBwbGF5ZXJzVHVybiA9IHRydWU7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBzd2l0Y2ggKHNlY29uZFBsYXllclR1cm4pIHtcbiAgICAgIGNhc2UgdHJ1ZTpcbiAgICAgICAgc2Vjb25kUGxheWVyLnNldFBsYXllcnNUdXJuKGZhbHNlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGZhbHNlOlxuICAgICAgICBzZWNvbmRQbGF5ZXIuc2V0UGxheWVyc1R1cm4odHJ1ZSk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBcbiAgfVxuXG4gIGZ1bmN0aW9uIGF0dGFjayhib2FyZCwgYXR0YWNrZWRQbGF5ZXIsIHgsIHkpIHtcbiAgICBjaGFuZ2VQbGF5ZXJzVHVybihhdHRhY2tlZFBsYXllcik7XG4gICAgaWYgKGlzQWkpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwicGxheWVyIG9uZSB0dXJuXCIsIHBsYXllcnNUdXJuKTtcbiAgICAgIGNvbnNvbGUubG9nKFwicGxheWVyIHR3byB0dXJuXCIsIGF0dGFja2VkUGxheWVyLmdldFBsYXllcnNUdXJuKCkpO1xuICAgICAgYWlBdHRhY2soYm9hcmQsIGF0dGFja2VkUGxheWVyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coXCJwbGF5ZXIgb25lIHR1cm5cIiwgcGxheWVyc1R1cm4pO1xuICAgICAgY29uc29sZS5sb2coXCJwbGF5ZXIgdHdvIHR1cm5cIiwgYXR0YWNrZWRQbGF5ZXIuZ2V0UGxheWVyc1R1cm4oKSk7XG4gICAgICByZXR1cm4gYm9hcmQucmVjZWl2ZUF0dGFjayh4LCB5KTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBmaW5kUmFuZG9tTW92ZSgpIHtcbiAgICBjb25zdCB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG5cbiAgICByZXR1cm4gW3gsIHldO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNNb3ZlTGVnYWwoeCwgeSwgYm9hcmQpIHtcbiAgICBpZiAoYm9hcmRbeF1beV0uaGl0ID09PSB0cnVlKSByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvLyBmdW5jdGlvbiBhaUF0dGFjayhib2FyZCkge1xuICAvLyAgIGxldCByYW5kb21Nb3ZlID0gZmluZFJhbmRvbU1vdmUoKTtcbiAgLy8gICB3aGlsZSAoXG4gIC8vICAgICBpc01vdmVMZWdhbChyYW5kb21Nb3ZlWzBdLCByYW5kb21Nb3ZlWzFdLCBib2FyZC5nZXRCb2FyZCgpKSA9PT0gZmFsc2VcbiAgLy8gICApIHtcbiAgLy8gICAgIHJhbmRvbU1vdmUgPSBmaW5kUmFuZG9tTW92ZSgpO1xuICAvLyAgIH1cbiAgLy8gICBjb25zb2xlLmxvZyguLi5yYW5kb21Nb3ZlKVxuICAvLyAgIHJldHVybiBib2FyZC5yZWNlaXZlQXR0YWNrKC4uLnJhbmRvbU1vdmUpO1xuICAvLyB9XG5cbiAgcmV0dXJuIHtcbiAgICBhdHRhY2ssXG4gICAgZ2V0UGxheWVyc1R1cm4sXG4gICAgc2V0UGxheWVyc1R1cm4sXG4gICAgaXNNb3ZlTGVnYWwsXG4gICAgY2hhbmdlUGxheWVyc1R1cm4sXG4gICAgZmluZFJhbmRvbU1vdmVcbiAgfTtcbn07XG4iLCJpbXBvcnQgeyBnYW1lYm9hcmRGYWN0b3J5IH0gZnJvbSBcIi4vZ2FtZWJvYXJkLmpzXCI7XG5pbXBvcnQgeyBwbGF5ZXIgfSBmcm9tIFwiLi9wbGF5ZXIuanNcIjtcbmltcG9ydCB7IGRvbUNvbnRyb2xsZXIgfSBmcm9tIFwiLi9kb20uanNcIjtcblxubGV0IHBsYXllck9uZUdhbWVib2FyZCBcbmxldCBwbGF5ZXJUd29HYW1lYm9hcmQgXG5jb25zdCBnZXRQbGF5ZXJPbmVHYW1lYm9hcmQgPSAoKSA9PiBwbGF5ZXJPbmVHYW1lYm9hcmRcbmNvbnN0IGdldFBsYXllclR3b0dhbWVib2FyZCA9ICgpID0+IHBsYXllclR3b0dhbWVib2FyZFxuY29uc3QgcGxheWVyT25lID0gcGxheWVyKGZhbHNlLCB0cnVlKTtcbmNvbnN0IHBsYXllclR3byA9IHBsYXllcih0cnVlLCBmYWxzZSk7XG5jb25zdCBkb20gPSBkb21Db250cm9sbGVyKFxuICBwbGF5ZXJPbmUsXG4gIHBsYXllclR3byxcbik7XG5leHBvcnQgZnVuY3Rpb24gZ2FtZSgpIHtcbiAgZnVuY3Rpb24gaW5pdEdhbWVib2FyZHMoKSB7XG4gICAgY29uc3QgcGxheWVyT25lRGlzcGxheSA9IGRvbS5wbGF5ZXJPbmVEaXNwbGF5XG4gICAgY29uc3QgcGxheWVyVHdvRGlzcGxheSA9IGRvbS5wbGF5ZXJUd29EaXNwbGF5XG4gICAgcGxheWVyT25lR2FtZWJvYXJkID0gZ2FtZWJvYXJkRmFjdG9yeSgpO1xuICAgIHBsYXllclR3b0dhbWVib2FyZCA9IGdhbWVib2FyZEZhY3RvcnkoKTtcbiAgICBwbGF5ZXJPbmVHYW1lYm9hcmQuaW5pdEdhbWVib2FyZCgpO1xuICAgIHBsYXllclR3b0dhbWVib2FyZC5pbml0R2FtZWJvYXJkKCk7XG4gICAgcGxheWVyT25lRGlzcGxheS5ib2FyZCA9IHBsYXllck9uZUdhbWVib2FyZC5nZXRCb2FyZCgpXG4gICAgcGxheWVyVHdvRGlzcGxheS5ib2FyZCA9IHBsYXllclR3b0dhbWVib2FyZC5nZXRCb2FyZCgpXG4gICAgZG9tLnJlbmRlckdhbWVib2FyZHMocGxheWVyT25lR2FtZWJvYXJkLmdldEJvYXJkKCksIHBsYXllclR3b0dhbWVib2FyZC5nZXRCb2FyZCgpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0YXJ0R2FtZSgpIHtcbiAgICBwbGF5ZXJPbmUuc2V0UGxheWVyc1R1cm4odHJ1ZSk7XG4gICAgcGxheWVyVHdvLnNldFBsYXllcnNUdXJuKGZhbHNlKTtcblxuICAgIHBsYXllclR3b0dhbWVib2FyZC5wbGFjZVNoaXBzUmFuZG9tbHkoNSk7XG4gICAgZG9tLnJlbmRlckdhbWVib2FyZHMocGxheWVyT25lR2FtZWJvYXJkLmdldEJvYXJkKCksIHBsYXllclR3b0dhbWVib2FyZC5nZXRCb2FyZCgpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXkoeCwgeSkge1xuICAgIGNvbnN0IHBsYXllck9uZVR1cm4gPSBwbGF5ZXJPbmUuZ2V0UGxheWVyc1R1cm4oKTtcbiAgICBjb25zdCBwbGF5ZXJUd29UdXJuID0gcGxheWVyVHdvLmdldFBsYXllcnNUdXJuKCk7XG5cbiAgICBpZiAocGxheWVyT25lVHVybiA9PT0gdHJ1ZSkge1xuICAgICAgcGxheWVyT25lLmF0dGFjayhwbGF5ZXJUd29HYW1lYm9hcmQsIHBsYXllclR3bywgeCwgeSk7XG4gICAgfSBlbHNlIGlmIChwbGF5ZXJUd29UdXJuID09PSB0cnVlKSB7XG4gICAgICBwbGF5ZXJUd28uYXR0YWNrKHBsYXllck9uZUdhbWVib2FyZCwgcGxheWVyT25lKTtcbiAgICB9XG5cbiAgICBpZiAoaXNHYW1lRmluaXNoZWQoKSkge1xuICAgICAgbGV0IHdpbm5lciA9IFwiXCI7XG4gICAgICBpZiAocGxheWVyT25lR2FtZWJvYXJkLmFyZUFsbFNoaXBzU3VuaygpID09PSB0cnVlKSB7XG4gICAgICAgIHdpbm5lciA9IFwiUGxheWVyIFR3b1wiO1xuICAgICAgfVxuICAgICAgaWYgKHBsYXllclR3b0dhbWVib2FyZC5hcmVBbGxTaGlwc1N1bmsoKSA9PT0gdHJ1ZSkge1xuICAgICAgICB3aW5uZXIgPSBcIlBsYXllciBPbmVcIjtcbiAgICAgIH1cbiAgICAgIGVuZEdhbWUod2lubmVyKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBpc0dhbWVGaW5pc2hlZCgpIHtcbiAgICBpZiAoXG4gICAgICBwbGF5ZXJPbmVHYW1lYm9hcmQuYXJlQWxsU2hpcHNTdW5rKCkgPT09IHRydWUgfHxcbiAgICAgIHBsYXllclR3b0dhbWVib2FyZC5hcmVBbGxTaGlwc1N1bmsoKSA9PT0gdHJ1ZVxuICAgICkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGVuZEdhbWUod2lubmVyKSB7XG4gICAgZG9tLmNyZWF0ZUVuZEdhbWVQb3B1cCh3aW5uZXIpO1xuICAgIGRvbS5yZW1vdmVGaWVsZHNFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBzdGFydEdhbWUsXG4gICAgcGxheSxcbiAgICBlbmRHYW1lLFxuICAgIGlzR2FtZUZpbmlzaGVkLFxuICAgIGluaXRHYW1lYm9hcmRzLFxuICAgIGdldFBsYXllck9uZUdhbWVib2FyZCxcbiAgICBnZXRQbGF5ZXJUd29HYW1lYm9hcmRcbiAgfTtcbn1cblxuZXhwb3J0IHsgcGxheWVyT25lLCBwbGF5ZXJUd28gfTtcbiIsImltcG9ydCB7IGdhbWUsIHBsYXllck9uZSB9IGZyb20gXCIuL2dhbWUuanNcIjtcbmltcG9ydCB7IGdhbWVib2FyZEZhY3RvcnkgfSBmcm9tIFwiLi9nYW1lYm9hcmQuanNcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGRvbUNvbnRyb2xsZXIoKSB7XG4gIGNvbnN0IGdhbWVib2FyZENvbnRyb2xsZXIgPSBnYW1lYm9hcmRGYWN0b3J5KCk7XG4gIGNvbnN0IGdhbWVDb250cm9sbGVyID0gZ2FtZSgpO1xuICBjb25zdCBtYWluID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIm1haW5cIik7XG4gIGNvbnN0IHBsYXllck9uZURpc3BsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci1vbmUtYm9hcmRcIik7XG4gIGNvbnN0IHBsYXllclR3b0Rpc3BsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci10d28tYm9hcmRcIik7XG4gIGNvbnN0IHN3aXRjaFBvc2l0aW9uQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zd2l0Y2gtcG9zaXRpb25cIik7XG4gIGNvbnN0IGZpZWxkcyA9IFtdO1xuICBsZXQgcGxheWVyT25lR2FtZWJvYXJkID0gZ2FtZUNvbnRyb2xsZXIuZ2V0UGxheWVyT25lR2FtZWJvYXJkKCk7XG4gIGxldCBnYW1lTW9kZSA9IFwiaW5pdFwiO1xuICBsZXQgc2hpcExlbmd0aCA9IDE7XG4gIGxldCB4O1xuICBsZXQgeTtcbiAgbGV0IHBvc2l0aW9uID0gXCJ2ZXJ0aWNhbFwiO1xuXG4gIGZ1bmN0aW9uIHJlbmRlckZpZWxkKGZpZWxkLCBib2FyZERpc3BsYXkpIHtcbiAgICBjb25zdCByZW5kZXJlZEZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICByZW5kZXJlZEZpZWxkLmNsYXNzTGlzdC5hZGQoXCJmaWVsZFwiKTtcbiAgICBpZiAoZmllbGQuc2hpcCAhPT0gbnVsbCkge1xuICAgICAgcmVuZGVyZWRGaWVsZC5jbGFzc0xpc3QuYWRkKFwic2hpcFwiKTtcbiAgICB9XG4gICAgaWYgKGZpZWxkLnNoaXAgIT09IG51bGwgJiYgYm9hcmREaXNwbGF5ID09PSBwbGF5ZXJUd29EaXNwbGF5KSB7XG4gICAgICAgIHJlbmRlcmVkRmllbGQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgIH1cbiAgICBpZiAoZmllbGQuc2hpcCAhPT0gbnVsbCAmJiBmaWVsZC5zaGlwLmlzU3VuaygpKSB7XG4gICAgICByZW5kZXJlZEZpZWxkLmNsYXNzTGlzdC5hZGQoXCJzdW5rXCIpO1xuICAgIH1cbiAgICBpZiAoZmllbGQuaGl0ID09PSB0cnVlKSB7XG4gICAgICByZW5kZXJlZEZpZWxkLmNsYXNzTGlzdC5hZGQoXCJoaXRcIik7XG4gICAgfVxuICAgIHJlbmRlcmVkRmllbGQuYm9hcmQgPSBmaWVsZC5ib2FyZDtcbiAgICByZW5kZXJlZEZpZWxkLmZpZWxkID0gZmllbGQ7XG5cbiAgICBpZiAoIWZpZWxkcy5pbmNsdWRlcyhmaWVsZC5wb3N0aW9uKSkge1xuICAgICAgZmllbGRzLnB1c2goZmllbGQucG9zaXRpb24pO1xuICAgIH1cblxuICAgIGlmIChnYW1lTW9kZSA9PT0gXCJpbml0XCIpIHtcbiAgICAgIHJlbmRlcmVkRmllbGQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCBoaWdobGlnaHRUYXJnZXRGaWVsZCk7XG4gICAgICByZW5kZXJlZEZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW91dFwiLCB1bmhpZ2hsaWdodFRhcmdldEZpZWxkcyk7XG4gICAgICByZW5kZXJlZEZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBwbGFjZVNoaXApO1xuICAgICAgcmVuZGVyZWRGaWVsZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2hhbmdlR2FtZU1vZGUpO1xuICAgIH0gZWxzZSBpZiAoZ2FtZU1vZGUgPT09IFwiZ2FtZVwiKSB7XG4gICAgICByZW5kZXJlZEZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBwbGF5T25DbGljayk7XG4gICAgfVxuXG4gICAgYm9hcmREaXNwbGF5LmFwcGVuZENoaWxkKHJlbmRlcmVkRmllbGQpO1xuXG4gICAgcmV0dXJuIHJlbmRlcmVkRmllbGQ7XG4gIH1cblxuICBmdW5jdGlvbiByZW5kZXJHYW1lYm9hcmQoYm9hcmQsIGJvYXJkRGlzcGxheSkge1xuICAgIGJvYXJkRGlzcGxheS5pbm5lckhUTUwgPSBcIlwiO1xuXG4gICAgYm9hcmQuZm9yRWFjaCgocm93KSA9PiB7XG4gICAgICByb3cuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgICAgcmVuZGVyRmllbGQoZmllbGQsIGJvYXJkRGlzcGxheSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbmRlckdhbWVib2FyZHMocGxheWVyT25lR2FtZWJvYXJkLCBwbGF5ZXJUd29HYW1lYm9hcmQpIHtcbiAgICByZW5kZXJHYW1lYm9hcmQocGxheWVyT25lR2FtZWJvYXJkLCBwbGF5ZXJPbmVEaXNwbGF5KTtcbiAgICByZW5kZXJHYW1lYm9hcmQocGxheWVyVHdvR2FtZWJvYXJkLCBwbGF5ZXJUd29EaXNwbGF5KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXlPbkNsaWNrKGUpIHtcbiAgICAvLyBJZiBjbGlja2VkIGZpZWxkIGlzIG5vdCBvbiBlbmVteSBib2FyZCBvciBpdCBpcyBub3QgaHVtYW4gcGxheWVyIHR1cm46IHJldHVyblxuICAgIGlmIChlLnRhcmdldC5wYXJlbnRFbGVtZW50ICE9PSBwbGF5ZXJUd29EaXNwbGF5KSByZXR1cm47XG4gICAgaWYgKHBsYXllck9uZS5nZXRQbGF5ZXJzVHVybigpICE9PSB0cnVlKSByZXR1cm47XG4gICAgaWYgKGUudGFyZ2V0LmZpZWxkLmhpdCA9PT0gdHJ1ZSkgcmV0dXJuO1xuXG4gICAgY29uc3QgeCA9IGUudGFyZ2V0LmZpZWxkLnBvc2l0aW9uWzBdO1xuICAgIGNvbnN0IHkgPSBlLnRhcmdldC5maWVsZC5wb3NpdGlvblsxXTtcblxuICAgIGdhbWVDb250cm9sbGVyLnBsYXkoeCwgeSk7XG5cbiAgICAvLyBUaGlzIGdhbWUgZW5kaW5nIGNvbmRpdGlvbiBpcyBhbHNvIHByZXNlbnQgaW4gZ2FtZS5qc1xuICAgIGlmIChnYW1lQ29udHJvbGxlci5pc0dhbWVGaW5pc2hlZCgpKSB7XG4gICAgICBjb25zdCBwbGF5ZXJPbmVHYW1lYm9hcmQgPSBnYW1lQ29udHJvbGxlci5nZXRQbGF5ZXJPbmVHYW1lYm9hcmQoKTtcbiAgICAgIGNvbnN0IHBsYXllclR3b0dhbWVib2FyZCA9IGdhbWVDb250cm9sbGVyLmdldFBsYXllclR3b0dhbWVib2FyZCgpO1xuICAgICAgcmVuZGVyR2FtZWJvYXJkcyhcbiAgICAgICAgcGxheWVyT25lR2FtZWJvYXJkLmdldEJvYXJkKCksXG4gICAgICAgIHBsYXllclR3b0dhbWVib2FyZC5nZXRCb2FyZCgpLFxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcmVuZGVyR2FtZWJvYXJkKGUudGFyZ2V0LnBhcmVudEVsZW1lbnQuYm9hcmQsIGUudGFyZ2V0LnBhcmVudEVsZW1lbnQpO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBnYW1lQ29udHJvbGxlci5wbGF5KCk7XG4gICAgICByZW5kZXJHYW1lYm9hcmQocGxheWVyT25lR2FtZWJvYXJkLmdldEJvYXJkKCksIHBsYXllck9uZURpc3BsYXkpO1xuICAgIH0sIFwiMTUwMFwiKTtcbiAgfVxuXG4gIC8vIFN0YXJ0L0VuZCBHYW1lIFBvcHVwc1xuXG4gIGZ1bmN0aW9uIGNyZWF0ZUVuZEdhbWVQb3B1cCh3aW5uZXIpIHtcbiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgbW9kYWwuY2xhc3NMaXN0LmFkZChcImVuZC1nYW1lXCIpO1xuICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbFwiKTtcblxuICAgIGNvbnN0IHRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcbiAgICB0ZXh0LmNsYXNzTGlzdC5hZGQoXCJlbmQtZ2FtZS10ZXh0XCIpO1xuICAgIHRleHQudGV4dENvbnRlbnQgPSBgJHt3aW5uZXJ9IFdvbmA7XG5cbiAgICBjb25zdCBuZXdHYW1lQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICBuZXdHYW1lQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJuZXctZ2FtZS1idXR0b25cIik7XG4gICAgbmV3R2FtZUJ1dHRvbi50ZXh0Q29udGVudCA9IFwiTmV3IEdhbWVcIjtcblxuICAgIG1haW4uYXBwZW5kQ2hpbGQobW9kYWwpO1xuICAgIG1vZGFsLmFwcGVuZENoaWxkKHRleHQpO1xuICAgIG1vZGFsLmFwcGVuZENoaWxkKG5ld0dhbWVCdXR0b24pO1xuXG4gICAgbmV3R2FtZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICByZXNldERpc3BsYXkoKVxuICAgICAgICBzd2l0Y2hQb3NpdGlvbkJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nKVxuICAgIH0pXG4gIH1cblxuICBmdW5jdGlvbiBjcmVhdGVTdGFydEdhbWVQb3B1cCgpIHtcbiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgbW9kYWwuY2xhc3NMaXN0LmFkZChcInN0YXJ0LWdhbWVcIik7XG4gICAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsXCIpO1xuXG4gICAgY29uc3Qgc3RhcnRHYW1lQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICBzdGFydEdhbWVCdXR0b24uY2xhc3NMaXN0LmFkZChcInN0YXJ0LWdhbWUtYnV0dG9uXCIpO1xuICAgIHN0YXJ0R2FtZUJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU3RhcnQgR2FtZVwiO1xuXG4gICAgbWFpbi5hcHBlbmRDaGlsZChtb2RhbCk7XG4gICAgbW9kYWwuYXBwZW5kQ2hpbGQoc3RhcnRHYW1lQnV0dG9uKTtcblxuICAgIHN0YXJ0R2FtZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgbWFpbi5yZW1vdmVDaGlsZChtb2RhbCk7XG4gICAgICBnYW1lQ29udHJvbGxlci5zdGFydEdhbWUoKTtcbiAgICAgIHN3aXRjaFBvc2l0aW9uQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpXG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiByZW1vdmVGaWVsZHNFdmVudExpc3RlbmVycygpIHtcbiAgICBjb25zdCBkaXNwbGF5ZWRGaWVsZHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmZpZWxkXCIpO1xuXG4gICAgZGlzcGxheWVkRmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICBmaWVsZC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgcGxheU9uQ2xpY2spO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVzZXREaXNwbGF5KCkge1xuICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbFwiKTtcblxuICAgIG1haW4ucmVtb3ZlQ2hpbGQobW9kYWwpO1xuICAgIGdhbWVNb2RlID0gXCJpbml0XCI7XG4gICAgc2hpcExlbmd0aCA9IDE7XG4gICAgZ2FtZUNvbnRyb2xsZXIuaW5pdEdhbWVib2FyZHMoKTtcbiAgfVxuXG4gIC8vIFNISVAgUExBQ0lORyBMT0dJQ1xuXG4gIGZ1bmN0aW9uIHNob3dUYXJnZXRGaWVsZHMoZSkge1xuICAgIHBsYXllck9uZUdhbWVib2FyZCA9IGdhbWVDb250cm9sbGVyLmdldFBsYXllck9uZUdhbWVib2FyZCgpO1xuXG4gICAgcGxheWVyT25lRGlzcGxheS5ib2FyZE9iamVjdCA9IHBsYXllck9uZUdhbWVib2FyZDtcbiAgICBpZiAoc2hpcExlbmd0aCA+IDUpIHJldHVybjtcbiAgICBpZiAoZS50YXJnZXQucGFyZW50RWxlbWVudC5ib2FyZE9iamVjdCAhPT0gcGxheWVyT25lR2FtZWJvYXJkKSB7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgcmVuZGVyZWRGaWVsZHMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZmllbGRcIikpO1xuXG4gICAgeCA9IGUudGFyZ2V0LmZpZWxkLnBvc2l0aW9uWzBdO1xuICAgIHkgPSBlLnRhcmdldC5maWVsZC5wb3NpdGlvblsxXTtcbiAgICAvLyBjb25zdCBib2FyZCA9IGUudGFyZ2V0LnBhcmVudEVsZW1lbnQuYm9hcmQ7XG4gICAgY29uc3QgYm9hcmQgPSBwbGF5ZXJPbmVHYW1lYm9hcmQuZ2V0Qm9hcmQoKTtcbiAgICBjb25zdCB0YXJnZXRGaWVsZHMgPSBnYW1lYm9hcmRDb250cm9sbGVyLmZpbmRUYXJnZXRGaWVsZHMoXG4gICAgICBzaGlwTGVuZ3RoLFxuICAgICAgeCxcbiAgICAgIHksXG4gICAgICBwb3NpdGlvbixcbiAgICAgIGJvYXJkLFxuICAgICk7XG4gICAgbGV0IHRhcmdldEZpZWxkc1Bvc2l0aW9ucztcbiAgICBsZXQgZGlzcGxheWVkVGFyZ2V0RmllbGRzO1xuICAgIGlmICh0YXJnZXRGaWVsZHMgIT09IGZhbHNlKSB7XG4gICAgICB0YXJnZXRGaWVsZHNQb3NpdGlvbnMgPSB0YXJnZXRGaWVsZHMubWFwKChmaWVsZCkgPT4gZmllbGQucG9zaXRpb24pO1xuICAgICAgZGlzcGxheWVkVGFyZ2V0RmllbGRzID0gcmVuZGVyZWRGaWVsZHMuZmlsdGVyKFxuICAgICAgICAoZmllbGQpID0+XG4gICAgICAgICAgdGFyZ2V0RmllbGRzUG9zaXRpb25zLmluY2x1ZGVzKGZpZWxkLmZpZWxkLnBvc2l0aW9uKSA9PT0gdHJ1ZSxcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChkaXNwbGF5ZWRUYXJnZXRGaWVsZHMpIHtcbiAgICAgIHJldHVybiBkaXNwbGF5ZWRUYXJnZXRGaWVsZHM7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaGlnaGxpZ2h0VGFyZ2V0RmllbGQoZSkge1xuICAgIGNvbnN0IHRhcmdldEZpZWxkcyA9IHNob3dUYXJnZXRGaWVsZHMoZSk7XG4gICAgaWYgKHRhcmdldEZpZWxkcykge1xuICAgICAgdGFyZ2V0RmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiBmaWVsZC5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiB1bmhpZ2hsaWdodFRhcmdldEZpZWxkcyhlKSB7XG4gICAgY29uc3QgdGFyZ2V0RmllbGRzID0gc2hvd1RhcmdldEZpZWxkcyhlKTtcbiAgICBpZiAodGFyZ2V0RmllbGRzKSB7XG4gICAgICB0YXJnZXRGaWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IGZpZWxkLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIikpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYWNlU2hpcChlKSB7XG4gICAgaWYgKHNoaXBMZW5ndGggPiA1IHx8IGUudGFyZ2V0LnBhcmVudEVsZW1lbnQgPT09IHBsYXllclR3b0Rpc3BsYXkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgYm9hcmRPYmplY3QgPSBwbGF5ZXJPbmVHYW1lYm9hcmQ7XG4gICAgY29uc3QgYm9hcmQgPSBwbGF5ZXJPbmVHYW1lYm9hcmQuZ2V0Qm9hcmQoKTtcbiAgICBjb25zdCBkaXNwbGF5ZWRCb2FyZCA9IHBsYXllck9uZURpc3BsYXk7XG5cbiAgICBjb25zdCBzaGlwID0gYm9hcmRPYmplY3QucGxhY2VTaGlwKHNoaXBMZW5ndGgsIHgsIHksIHBvc2l0aW9uKTtcbiAgICBpZiAoc2hpcCAhPT0gZmFsc2UpIHtcbiAgICAgIHJlbmRlckdhbWVib2FyZChib2FyZCwgZGlzcGxheWVkQm9hcmQpO1xuICAgICAgc2hpcExlbmd0aCArPSAxO1xuICAgIH1cbiAgICBpZiAoc2hpcExlbmd0aCA+IDUpIGNyZWF0ZVN0YXJ0R2FtZVBvcHVwKCk7XG4gIH1cblxuICBmdW5jdGlvbiBjaGFuZ2VHYW1lTW9kZSgpIHtcbiAgICBjb25zdCBwbGF5ZXJPbmVHYW1lYm9hcmQgPSBnYW1lQ29udHJvbGxlci5nZXRQbGF5ZXJPbmVHYW1lYm9hcmQoKTtcbiAgICBjb25zdCBwbGF5ZXJUd29HYW1lYm9hcmQgPSBnYW1lQ29udHJvbGxlci5nZXRQbGF5ZXJUd29HYW1lYm9hcmQoKTtcbiAgICBpZiAoc2hpcExlbmd0aCA+IDUpIGdhbWVNb2RlID0gXCJnYW1lXCI7XG4gICAgaWYgKHNoaXBMZW5ndGggPCA1KSBnYW1lTW9kZSA9IFwiaW5pdFwiO1xuICAgIHJlbmRlckdhbWVib2FyZHMoXG4gICAgICBwbGF5ZXJPbmVHYW1lYm9hcmQuZ2V0Qm9hcmQoKSxcbiAgICAgIHBsYXllclR3b0dhbWVib2FyZC5nZXRCb2FyZCgpLFxuICAgICk7XG4gIH1cblxuICBmdW5jdGlvbiBzd2l0Y2hQb3NpdGlvbigpIHtcbiAgICBzd2l0Y2ggKHBvc2l0aW9uKSB7XG4gICAgICBjYXNlIFwidmVydGljYWxcIjpcbiAgICAgICAgcG9zaXRpb24gPSBcImhvcml6b250YWxcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiaG9yaXpvbnRhbFwiOlxuICAgICAgICBwb3NpdGlvbiA9IFwidmVydGljYWxcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgc3dpdGNoUG9zaXRpb25CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHN3aXRjaFBvc2l0aW9uKTtcblxuICByZXR1cm4ge1xuICAgIHJlbmRlckdhbWVib2FyZHMsXG4gICAgY3JlYXRlRW5kR2FtZVBvcHVwLFxuICAgIHJlbW92ZUZpZWxkc0V2ZW50TGlzdGVuZXJzLFxuICAgIHBsYXllck9uZURpc3BsYXksXG4gICAgcGxheWVyVHdvRGlzcGxheSxcbiAgfTtcbn1cbiIsImltcG9ydCB7IGdhbWUgfSBmcm9tIFwiLi9nYW1lLmpzXCI7XG5pbXBvcnQgeyBmaW5kQWRqYWNlbnRGaWVsZE9uQXhpcyB9IGZyb20gXCIuL2FpLmpzXCI7XG5cblxuY29uc3QgZ2FtZUNvbnRyb2xsZXIgPSBnYW1lKClcblxuXG5nYW1lQ29udHJvbGxlci5pbml0R2FtZWJvYXJkcygpXG5jb25zdCBib2FyZE9iamVjdCA9IGdhbWVDb250cm9sbGVyLmdldFBsYXllck9uZUdhbWVib2FyZCgpXG5jb25zdCBwbGF5ZXJPbmVCb2FyZCA9IGdhbWVDb250cm9sbGVyLmdldFBsYXllck9uZUdhbWVib2FyZCgpLmdldEJvYXJkKClcbmNvbnNvbGUubG9nKGJvYXJkT2JqZWN0LmdldEJvYXJkKCkpXG4vLyBjb25zb2xlLmxvZyhwbGF5ZXJPbmVCb2FyZClcbmJvYXJkT2JqZWN0LnByaW50Qm9hcmQoKVxuY29uc29sZS5sb2coZmluZEFkamFjZW50RmllbGRPbkF4aXMocGxheWVyT25lQm9hcmRbNl1bN10sIHBsYXllck9uZUJvYXJkWzVdWzddLCBib2FyZE9iamVjdCkpXG5cblxud2luZG93LnN0YXJ0R2FtZSA9IGdhbWVDb250cm9sbGVyLnN0YXJ0R2FtZVxud2luZG93LmVuZEdhbWUgPSBnYW1lQ29udHJvbGxlci5lbmRHYW1lXG4vLyBnYW1lQ29udHJvbGxlci5zdGFydEdhbWUoKVxuXG4iXSwibmFtZXMiOlsic2hpcEZhY3RvcnkiLCJsZW5ndGgiLCJudW1iZXJPZkhpdHMiLCJnZXRMZW5ndGgiLCJoaXQiLCJpc1N1bmsiLCJnZXROdW1iZXJPZkhpdHMiLCJzaGlwIiwiY29uc29sZSIsImxvZyIsImdhbWVib2FyZEZhY3RvcnkiLCJib2FyZCIsImdldEJvYXJkIiwiY3JlYXRlRmllbGQiLCJ4IiwieSIsInBvc2l0aW9uIiwib2NjdXBpZWRCeVNoaXAiLCJmaW5kTmVpZ2hib3VyRmllbGRzIiwidGFyZ2V0RmllbGRzIiwiZHVwbGljYXRlZE5laWdoYm91cnMiLCJuZWlnaGJvdXJzIiwicG9zc2JpbGVOZWlnaGJvdXJzIiwiZm9yRWFjaCIsImZpZWxkIiwiY29vcmRpbmF0ZSIsImlzT3V0T2ZCb3VuZCIsInB1c2giLCJmaWx0ZXIiLCJuZWlnaGJvdXIiLCJpbmNsdWRlcyIsImZpbmRUYXJnZXRGaWVsZHMiLCJzaGlwTGVuZ3RoIiwiZGlyZWN0aW9uIiwiaSIsImNoZWNrSWZGaWVsZE9jY3VwaWVkIiwiY2FuU2hpcEJlUGxhY2VkIiwibmVpZ2hib3VyRmllbGRzIiwic29tZSIsInBsYWNlU2hpcCIsImluaXRHYW1lYm9hcmQiLCJhcnIiLCJqIiwicHJpbnRCb2FyZCIsInJvdyIsInN0cmluZyIsInJlY2VpdmVBdHRhY2siLCJhcmVBbGxTaGlwc1N1bmsiLCJmaWVsZHNPY2N1cGllZEJ5U2hpcHMiLCJvY2N1cGllZCIsImV2ZXJ5IiwicGxhY2VTaGlwc1JhbmRvbWx5IiwiYW1vdW50IiwicGxhY2VkU2hpcHMiLCJjdXJyZW50U2hpcExlbmdodCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImhpdGVkU2hpcCIsImhpdGVkRmllbGQiLCJ0ZW1wSGl0ZWRGaWVsZCIsImhpdHMiLCJpc01vdmVMZWdhbCIsImZpbmRSYW5kb21Nb3ZlIiwiZmluZEFkamFjZW50RmllbGRPbkF4aXMiLCJmaWVsZE9uZSIsImZpZWxkVHdvIiwiYSIsImIiLCJwb3NzaWJsZUZpZWxkcyIsImF4aXMiLCJ0YXJnZXRGaWVsZE9uZSIsInRhcmdldEZpZWxkVHdvIiwicGxheWVyIiwiYWkiLCJpc0l0UGxheWVyc1R1cm4iLCJpc0FpIiwicGxheWVyc1R1cm4iLCJjaGFuZ2VQbGF5ZXJzVHVybiIsInNlY29uZFBsYXllciIsInNlY29uZFBsYXllclR1cm4iLCJnZXRQbGF5ZXJzVHVybiIsInNldFBsYXllcnNUdXJuIiwiYXR0YWNrIiwiYXR0YWNrZWRQbGF5ZXIiLCJ1bmRlZmluZWQiLCJhZGphY2VudEZpZWxkcyIsImZpbmRGb3VyQWRqYWNlbnRGaWVsZHMiLCJyYW5kb21Nb3ZlIiwibmV3SGl0ZWRGaWVsZCIsImFpQXR0YWNrIiwidmFsdWUiLCJwbGF5ZXJPbmVHYW1lYm9hcmQiLCJwbGF5ZXJUd29HYW1lYm9hcmQiLCJnZXRQbGF5ZXJPbmVHYW1lYm9hcmQiLCJnZXRQbGF5ZXJUd29HYW1lYm9hcmQiLCJwbGF5ZXJPbmUiLCJwbGF5ZXJUd28iLCJkb20iLCJnYW1lYm9hcmRDb250cm9sbGVyIiwiZ2FtZUNvbnRyb2xsZXIiLCJnYW1lIiwibWFpbiIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInBsYXllck9uZURpc3BsYXkiLCJwbGF5ZXJUd29EaXNwbGF5Iiwic3dpdGNoUG9zaXRpb25CdXR0b24iLCJmaWVsZHMiLCJnYW1lTW9kZSIsInJlbmRlckdhbWVib2FyZCIsImJvYXJkRGlzcGxheSIsImlubmVySFRNTCIsInJlbmRlcmVkRmllbGQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwicG9zdGlvbiIsImFkZEV2ZW50TGlzdGVuZXIiLCJoaWdobGlnaHRUYXJnZXRGaWVsZCIsInVuaGlnaGxpZ2h0VGFyZ2V0RmllbGRzIiwiY2hhbmdlR2FtZU1vZGUiLCJwbGF5T25DbGljayIsImFwcGVuZENoaWxkIiwicmVuZGVyRmllbGQiLCJyZW5kZXJHYW1lYm9hcmRzIiwiZSIsInRhcmdldCIsInBhcmVudEVsZW1lbnQiLCJwbGF5IiwiaXNHYW1lRmluaXNoZWQiLCJzZXRUaW1lb3V0Iiwic2hvd1RhcmdldEZpZWxkcyIsImJvYXJkT2JqZWN0IiwicmVuZGVyZWRGaWVsZHMiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwidGFyZ2V0RmllbGRzUG9zaXRpb25zIiwiZGlzcGxheWVkVGFyZ2V0RmllbGRzIiwibWFwIiwicmVtb3ZlIiwiZGlzcGxheWVkQm9hcmQiLCJtb2RhbCIsInN0YXJ0R2FtZUJ1dHRvbiIsInRleHRDb250ZW50IiwicmVtb3ZlQ2hpbGQiLCJzdGFydEdhbWUiLCJ0b2dnbGUiLCJjcmVhdGVTdGFydEdhbWVQb3B1cCIsImNyZWF0ZUVuZEdhbWVQb3B1cCIsIndpbm5lciIsInRleHQiLCJuZXdHYW1lQnV0dG9uIiwiaW5pdEdhbWVib2FyZHMiLCJyZXNldERpc3BsYXkiLCJyZW1vdmVGaWVsZHNFdmVudExpc3RlbmVycyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJkb21Db250cm9sbGVyIiwiZW5kR2FtZSIsInBsYXllck9uZVR1cm4iLCJwbGF5ZXJUd29UdXJuIiwicGxheWVyT25lQm9hcmQiLCJ3aW5kb3ciXSwic291cmNlUm9vdCI6IiJ9