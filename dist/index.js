(()=>{"use strict";const e=e=>{let t=0;return{getLength:()=>e,hit:()=>(t+=1,t),isSunk:()=>t===e,getNumberOfHits:()=>t}},t=e(1);t.hit(),console.log(t.getLength());const o=()=>{const t=[],o=()=>t;function n(e,t){return{position:[e,t],occupiedByShip:!1,hit:!1,ship:null,board:o()}}function i(e){if(!e)return!1;const t=o();let n=[];const i=[],r=[];return e.forEach((e=>{const o=e.position[0],n=e.position[1];[[o-1,n-1],[o-1,n],[o-1,n+1],[o,n+1],[o+1,n+1],[o+1,n],[o+1,n-1],[o,n-1]].forEach((e=>{!1===a(e[0],e[1])&&r.push(t[e[0]][e[1]])}))})),n=r.filter((t=>!1===e.includes(t))),n.forEach((e=>{i.includes(e)||i.push(e)})),i}function r(e,t,o,n,i){const r=[];for(let s=0;s<e;s++)if("horizontal"===n){if(a(t,o+s))return console.log("out of bounds"),!1;r.push(i[t][o+s])}else if("vertical"===n){if(a(t+s,o))return console.log("out of bounds"),!1;r.push(i[t+s][o])}return r}function a(e,t){return e<0||e>9||t<0||t>9}function s(e){return!0===e.occupiedByShip}function l(e,t){return console.log(e,"target fields"),!!e&&!e.some(s)&&!t.some(s)}function c(t,n,a,s="horizontal"){const c=r(t,n,a,s,o());if(!l(c,i(c)))return!1;const d=e(t);return c.forEach((e=>{e.occupiedByShip=!0,e.ship=d})),d}return{createField:n,initGameboard:function(){for(let e=0;e<10;e++){const o=[];for(let t=0;t<10;t++)o.push(n(e,t));t.push(o)}},printBoard:function(){t.forEach((e=>{let t="";e.forEach((e=>{e.occupiedByShip||e.hit?!e.occupiedByShip&&e.hit?t+="|  -  |":e.occupiedByShip&&!e.hit?t+="|  O  |":e.occupiedByShip&&e.hit&&(t+="|  X  |"):t+=`| ${e.position} |`})),console.log(t)}))},getBoard:o,findTargetFields:r,findNeighbourFields:i,canShipBePlaced:l,placeShip:c,receiveAttack:function(e,o){return a(e,o)?(console.log("out of bounds"),!1):t[e][o].hit?(console.log("field already hit"),!1):(null!==t[e][o].ship&&t[e][o].ship.hit(),t[e][o].hit=!0,t[e][o])},areAllShipsSunk:function(){const e=[];return t.forEach((t=>{const o=t.filter((e=>!0===e.occupiedByShip));e.push(...o)})),!!e.every((e=>!0===e.hit))},placeShipsRandomly:function(e){const t=[];let o=1;for(;t.length!==e;){const e=Math.floor(10*Math.random()),n=Math.floor(10*Math.random());let i;switch(Math.floor(2*Math.random())){case 1:i="vertical";break;case 0:i="horizontal"}const r=c(o,e,n,i);!1!==r&&(t.push(r),o++)}}}};let n,i,r,a=0;function s(e,t,o){return!(e>9||e<0||t<0||t>9)&&!0!==o[e][t].hit}function l(){return[Math.floor(10*Math.random()),Math.floor(10*Math.random())]}function c(e,t,o){let n=e.position[0],i=e.position[1],r=t.position[0],a=t.position[1];const l=[];let c;if(n===r?c="horizontal":i===a&&(c="vertical"),console.log(c),"horizontal"===c){i>a&&(n=t.position[0],i=t.position[1],r=e.position[0],a=e.position[1]);const o=[n,i-1],s=[r,a+1];l.push(o,s)}else if("vertical"===c){n>r&&(n=t.position[0],i=t.position[1],r=e.position[0],a=e.position[1]);const o=[n-1,i],s=[r+1,a];l.push(o,s)}console.log(l,"possible fields");const d=l.filter((e=>s(e[0],e[1],o.getBoard())));return console.log(d,"target fields"),d}const d=(e,t)=>{const o=e;let d=t;function u(e){const t=e.getPlayersTurn();switch(d){case!0:d=!1;break;case!1:d=!0}switch(t){case!0:e.setPlayersTurn(!1);break;case!1:e.setPlayersTurn(!0)}}return{attack:function(e,t,p,h){if(u(t),!o)return console.log("player one turn",d),console.log("player two turn",t.getPlayersTurn()),e.receiveAttack(p,h);console.log("player one turn",d),console.log("player two turn",t.getPlayersTurn()),function(e){if(void 0!==n&&!0===n.isSunk()&&(a=0,n=void 0),1===a){const t=function(e,t){const o=e.position[0],n=e.position[1],i=[[o,n+1],[o,n-1],[o+1,n],[o-1,n]].filter((e=>s(e[0],e[1],t.getBoard())));return i}(i,e),o=t[Math.floor(Math.random()*t.length)];return r=e.receiveAttack(...o),null!==r.ship&&(a+=1),void console.log(n)}if(a>1){console.log("hitedField",i,"temp hited field",r);const t=c(i,r,e),o=t[Math.floor(Math.random()*t.length)],n=e.receiveAttack(...o);return void(null!==n.ship&&(r=n,a+=1))}let t=l();for(;!1===s(t[0],t[1],e.getBoard());)t=l();i=e.receiveAttack(...t),null!==i.ship&&(n=i.ship,a+=1)}(e)},getPlayersTurn:()=>d,setPlayersTurn:e=>{d=e},isMoveLegal:function(e,t,o){return!0!==o[e][t].hit},changePlayersTurn:u,findRandomMove:function(){return[Math.floor(10*Math.random()),Math.floor(10*Math.random())]}}};let u,p;const h=()=>u,f=()=>p,m=d(!1,!0),g=d(!0,!1),y=function(){const e=o(),t=b(),n=document.querySelector("main"),i=document.querySelector(".player-one-board"),r=document.querySelector(".player-two-board"),a=document.querySelector(".switch-position"),s=[];let l,c,d=t.getPlayerOneGameboard(),u="init",p=1,h="vertical";function f(e,t){t.innerHTML="",e.forEach((e=>{e.forEach((e=>{!function(e,t){const o=document.createElement("div");o.classList.add("field"),null!==e.ship&&o.classList.add("ship"),null!==e.ship&&t===r&&o.classList.add("hidden"),null!==e.ship&&e.ship.isSunk()&&o.classList.add("sunk"),!0===e.hit&&o.classList.add("hit"),o.board=e.board,o.field=e,s.includes(e.postion)||s.push(e.position),"init"===u?(o.addEventListener("mouseover",E),o.addEventListener("mouseout",S),o.addEventListener("click",G),o.addEventListener("click",L)):"game"===u&&o.addEventListener("click",y),t.appendChild(o)}(e,t)}))}))}function g(e,t){f(e,i),f(t,r)}function y(e){if(e.target.parentElement!==r)return;if(!0!==m.getPlayersTurn())return;if(!0===e.target.field.hit)return;const o=e.target.field.position[0],n=e.target.field.position[1];if(t.play(o,n),t.isGameFinished()){const e=t.getPlayerOneGameboard(),o=t.getPlayerTwoGameboard();g(e.getBoard(),o.getBoard())}else f(e.target.parentElement.board,e.target.parentElement),setTimeout((()=>{t.play(),f(d.getBoard(),i)}),"1500")}function v(o){if(d=t.getPlayerOneGameboard(),i.boardObject=d,p>5)return;if(o.target.parentElement.boardObject!==d)return;const n=Array.from(document.querySelectorAll(".field"));l=o.target.field.position[0],c=o.target.field.position[1];const r=d.getBoard(),a=e.findTargetFields(p,l,c,h,r);let s,u;return!1!==a&&(s=a.map((e=>e.position)),u=n.filter((e=>!0===s.includes(e.field.position)))),u||void 0}function E(e){const t=v(e);t&&t.forEach((e=>e.classList.add("active")))}function S(e){const t=v(e);t&&t.forEach((e=>e.classList.remove("active")))}function G(e){if(p>5||e.target.parentElement===r)return;const o=d,s=d.getBoard(),u=i;!1!==o.placeShip(p,l,c,h)&&(f(s,u),p+=1),p>5&&function(){const e=document.createElement("div");e.classList.add("start-game"),e.classList.add("modal");const o=document.createElement("button");o.classList.add("start-game-button"),o.textContent="Start Game",n.appendChild(e),e.appendChild(o),o.addEventListener("click",(()=>{n.removeChild(e),t.startGame(),a.classList.toggle("hidden")}))}()}function L(){const e=t.getPlayerOneGameboard(),o=t.getPlayerTwoGameboard();p>5&&(u="game"),p<5&&(u="init"),g(e.getBoard(),o.getBoard())}return a.addEventListener("click",(function(){switch(h){case"vertical":h="horizontal";break;case"horizontal":h="vertical"}})),{renderGameboards:g,createEndGamePopup:function(e){const o=document.createElement("div");o.classList.add("end-game"),o.classList.add("modal");const i=document.createElement("p");i.classList.add("end-game-text"),i.textContent=`${e} Won`;const r=document.createElement("button");r.classList.add("new-game-button"),r.textContent="New Game",n.appendChild(o),o.appendChild(i),o.appendChild(r),r.addEventListener("click",(()=>{!function(){const e=document.querySelector(".modal");n.removeChild(e),u="init",p=1,t.initGameboards()}(),a.classList.toggle("hidden")}))},removeFieldsEventListeners:function(){document.querySelectorAll(".field").forEach((e=>{e.removeEventListener("click",y)}))},playerOneDisplay:i,playerTwoDisplay:r}}();function b(){function e(){return!0===u.areAllShipsSunk()||!0===p.areAllShipsSunk()}function t(e){y.createEndGamePopup(e),y.removeFieldsEventListeners()}return{startGame:function(){m.setPlayersTurn(!0),g.setPlayersTurn(!1),p.placeShipsRandomly(5),y.renderGameboards(u.getBoard(),p.getBoard())},play:function(o,n){const i=m.getPlayersTurn(),r=g.getPlayersTurn();if(!0===i?m.attack(p,g,o,n):!0===r&&g.attack(u,m),e()){let e="";!0===u.areAllShipsSunk()&&(e="Player Two"),!0===p.areAllShipsSunk()&&(e="Player One"),t(e)}},endGame:t,isGameFinished:e,initGameboards:function(){const e=y.playerOneDisplay,t=y.playerTwoDisplay;u=o(),p=o(),u.initGameboard(),p.initGameboard(),e.board=u.getBoard(),t.board=p.getBoard(),y.renderGameboards(u.getBoard(),p.getBoard())},getPlayerOneGameboard:h,getPlayerTwoGameboard:f}}const v=b();v.initGameboards();const E=v.getPlayerOneGameboard(),S=v.getPlayerOneGameboard().getBoard();console.log(E.getBoard()),E.printBoard(),console.log(c(S[6][7],S[5][7],E)),window.startGame=v.startGame,window.endGame=v.endGame})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJtYXBwaW5ncyI6Im1CQUFBLE1BQU1BLEVBQWVDLElBRW5CLElBQUlDLEVBQWUsRUFlbkIsTUFBTyxDQUNMQyxVQWRnQixJQUFNRixFQWV0QkcsSUFaVSxLQUNWRixHQUFnQixFQUNUQSxHQVdQRyxPQVJhLElBQ1RILElBQWlCRCxFQVFyQkssZ0JBaEJzQixJQUFNSixFQWlCN0IsRUFHR0ssRUFBT1AsRUFBWSxHQUN6Qk8sRUFBS0gsTUFFTEksUUFBUUMsSUFBSUYsRUFBS0osYUMxQlYsTUFBTU8sRUFBbUIsS0FDOUIsTUFBTUMsRUFBUSxHQUVSQyxFQUFXLElBQU1ELEVBRXZCLFNBQVNFLEVBQVlDLEVBQUdDLEdBQ3RCLE1BQU8sQ0FDTEMsU0FBVSxDQUFDRixFQUFHQyxHQUNkRSxnQkFBZ0IsRUFDaEJiLEtBQUssRUFDTEcsS0FBTSxLQUNOSSxNQUFPQyxJQUVYLENBOEJBLFNBQVNNLEVBQW9CQyxHQUMzQixJQUFLQSxFQUFjLE9BQU8sRUFDMUIsTUFBTVIsRUFBUUMsSUFDZCxJQUFJUSxFQUF1QixHQUMzQixNQUFNQyxFQUFhLEdBQ2JDLEVBQXFCLEdBbUMzQixPQWpDQUgsRUFBYUksU0FBU0MsSUFDcEIsTUFBTVYsRUFBSVUsRUFBTVIsU0FBUyxHQUNuQkQsRUFBSVMsRUFBTVIsU0FBUyxHQUdhLENBQ3BDLENBQUNGLEVBQUksRUFBR0MsRUFBSSxHQUNaLENBQUNELEVBQUksRUFBR0MsR0FDUixDQUFDRCxFQUFJLEVBQUdDLEVBQUksR0FDWixDQUFDRCxFQUFHQyxFQUFJLEdBQ1IsQ0FBQ0QsRUFBSSxFQUFHQyxFQUFJLEdBQ1osQ0FBQ0QsRUFBSSxFQUFHQyxHQUNSLENBQUNELEVBQUksRUFBR0MsRUFBSSxHQUNaLENBQUNELEVBQUdDLEVBQUksSUFJb0JRLFNBQVNFLEtBQ2MsSUFBL0NDLEVBQWFELEVBQVcsR0FBSUEsRUFBVyxLQUN6Q0gsRUFBbUJLLEtBQUtoQixFQUFNYyxFQUFXLElBQUlBLEVBQVcsSUFBSSxHQUM5RCxJQUtKTCxFQUF1QkUsRUFBbUJNLFFBQ3ZDQyxJQUFtRCxJQUFyQ1YsRUFBYVcsU0FBU0QsS0FHdkNULEVBQXFCRyxTQUFTQyxJQUN2QkgsRUFBV1MsU0FBU04sSUFBUUgsRUFBV00sS0FBS0gsRUFBTSxJQUdsREgsQ0FDVCxDQUVBLFNBQVNVLEVBQWlCQyxFQUFZbEIsRUFBR0MsRUFBR2tCLEVBQVd0QixHQUNyRCxNQUFNUSxFQUFlLEdBQ3JCLElBQUssSUFBSWUsRUFBSSxFQUFHQSxFQUFJRixFQUFZRSxJQUM5QixHQUFrQixlQUFkRCxFQUE0QixDQUM5QixHQUFJUCxFQUFhWixFQUFHQyxFQUFJbUIsR0FFdEIsT0FEQTFCLFFBQVFDLElBQUksa0JBQ0wsRUFFVFUsRUFBYVEsS0FBS2hCLEVBQU1HLEdBQUdDLEVBQUltQixHQUNqQyxNQUFPLEdBQWtCLGFBQWRELEVBQTBCLENBQ25DLEdBQUlQLEVBQWFaLEVBQUlvQixFQUFHbkIsR0FFdEIsT0FEQVAsUUFBUUMsSUFBSSxrQkFDTCxFQUVUVSxFQUFhUSxLQUFLaEIsRUFBTUcsRUFBSW9CLEdBQUduQixHQUNqQyxDQUVGLE9BQU9JLENBQ1QsQ0FFQSxTQUFTTyxFQUFhWixFQUFHQyxHQUN2QixPQUFJRCxFQUFJLEdBQUtBLEVBQUksR0FBS0MsRUFBSSxHQUFLQSxFQUFJLENBRXJDLENBRUEsU0FBU29CLEVBQXFCWCxHQUM1QixPQUFnQyxJQUF6QkEsRUFBTVAsY0FDZixDQUVBLFNBQVNtQixFQUFnQmpCLEVBQWNrQixHQUVyQyxPQURBN0IsUUFBUUMsSUFBSVUsRUFBYyxtQkFDckJBLElBSUhBLEVBQWFtQixLQUFLSCxLQUNsQkUsRUFBZ0JDLEtBQUtILEVBTXpCLENBRUEsU0FBU0ksRUFBVVAsRUFBWWxCLEVBQUdDLEVBQUdrQixFQUFZLGNBQy9DLE1BQ01kLEVBQWVZLEVBQWlCQyxFQUFZbEIsRUFBR0MsRUFBR2tCLEVBRDFDckIsS0FHZCxJQUFLd0IsRUFBZ0JqQixFQURHRCxFQUFvQkMsSUFFMUMsT0FBTyxFQUVULE1BQU1aLEVBQU9QLEVBQVlnQyxHQU16QixPQUpBYixFQUFhSSxTQUFTQyxJQUNwQkEsRUFBTVAsZ0JBQWlCLEVBQ3ZCTyxFQUFNakIsS0FBT0EsQ0FBSSxJQUVaQSxDQUNULENBMkRBLE1BQU8sQ0FDTE0sY0FDQTJCLGNBOUxGLFdBQ0UsSUFBSyxJQUFJTixFQUFJLEVBQUdBLEVBQUksR0FBSUEsSUFBSyxDQUMzQixNQUFNTyxFQUFNLEdBQ1osSUFBSyxJQUFJQyxFQUFJLEVBQUdBLEVBQUksR0FBSUEsSUFDdEJELEVBQUlkLEtBQUtkLEVBQVlxQixFQUFHUSxJQUUxQi9CLEVBQU1nQixLQUFLYyxFQUNiLENBQ0YsRUF1TEVFLFdBckxGLFdBQ0VoQyxFQUFNWSxTQUFTcUIsSUFDYixJQUFJQyxFQUFTLEdBQ2JELEVBQUlyQixTQUFTQyxJQUNOQSxFQUFNUCxnQkFBbUJPLEVBQU1wQixLQUV4Qm9CLEVBQU1QLGdCQUFrQk8sRUFBTXBCLElBQ3hDeUMsR0FBVSxVQUNEckIsRUFBTVAsaUJBQW1CTyxFQUFNcEIsSUFDeEN5QyxHQUFVLFVBQ0RyQixFQUFNUCxnQkFBa0JPLEVBQU1wQixNQUN2Q3lDLEdBQVUsV0FOVkEsR0FBVSxLQUFLckIsRUFBTVIsWUFPdkIsSUFFRlIsUUFBUUMsSUFBSW9DLEVBQU8sR0FFdkIsRUFzS0VqQyxXQUNBbUIsbUJBQ0FiLHNCQUNBa0Isa0JBQ0FHLFlBQ0FPLGNBdkNGLFNBQXVCaEMsRUFBR0MsR0FDeEIsT0FBSVcsRUFBYVosRUFBR0MsSUFDbEJQLFFBQVFDLElBQUksa0JBQ0wsR0FHTEUsRUFBTUcsR0FBR0MsR0FBR1gsS0FDZEksUUFBUUMsSUFBSSxzQkFDTCxJQUdnQixPQUFyQkUsRUFBTUcsR0FBR0MsR0FBR1IsTUFBZUksRUFBTUcsR0FBR0MsR0FBR1IsS0FBS0gsTUFFaERPLEVBQU1HLEdBQUdDLEdBQUdYLEtBQU0sRUFFWE8sRUFBTUcsR0FBR0MsR0FDbEIsRUF3QkVnQyxnQkF0QkYsV0FDRSxNQUFNQyxFQUF3QixHQU85QixPQU5BckMsRUFBTVksU0FBU3FCLElBQ2IsTUFBTUssRUFBV0wsRUFBSWhCLFFBQVFKLElBQ0ssSUFBekJBLEVBQU1QLGlCQUVmK0IsRUFBc0JyQixRQUFRc0IsRUFBUyxNQUVyQ0QsRUFBc0JFLE9BQU8xQixJQUF3QixJQUFkQSxFQUFNcEIsS0FFbkQsRUFhRStDLG1CQXBFRixTQUE0QkMsR0FDMUIsTUFBTUMsRUFBYyxHQUNwQixJQUFJQyxFQUFvQixFQUN4QixLQUFPRCxFQUFZcEQsU0FBV21ELEdBQVEsQ0FDcEMsTUFBTXRDLEVBQUl5QyxLQUFLQyxNQUFzQixHQUFoQkQsS0FBS0UsVUFDcEIxQyxFQUFJd0MsS0FBS0MsTUFBc0IsR0FBaEJELEtBQUtFLFVBRTFCLElBQUl4QixFQUVKLE9BSHdCc0IsS0FBS0MsTUFBc0IsRUFBaEJELEtBQUtFLFdBSXRDLEtBQUssRUFDSHhCLEVBQVksV0FDWixNQUNGLEtBQUssRUFDSEEsRUFBWSxhQUloQixNQUFNMUIsRUFBT2dDLEVBQVVlLEVBQW1CeEMsRUFBR0MsRUFBR2tCLElBRW5DLElBQVQxQixJQUNGOEMsRUFBWTFCLEtBQUtwQixHQUNqQitDLElBRUosQ0FDRixFQTRDQyxFQ3pOSCxJQUNJSSxFQUNBQyxFQUNBQyxFQUhBQyxFQUFPLEVBS1gsU0FBU0MsRUFBWWhELEVBQUdDLEVBQUdKLEdBQ3pCLFFBQUlHLEVBQUksR0FBS0EsRUFBSSxHQUFLQyxFQUFJLEdBQUtBLEVBQUksS0FDWCxJQUFwQkosRUFBTUcsR0FBR0MsR0FBR1gsR0FFbEIsQ0FDQSxTQUFTMkQsSUFJUCxNQUFPLENBSEdSLEtBQUtDLE1BQXNCLEdBQWhCRCxLQUFLRSxVQUNoQkYsS0FBS0MsTUFBc0IsR0FBaEJELEtBQUtFLFVBRzVCLENBaUJBLFNBQVNPLEVBQXdCQyxFQUFVQyxFQUFVdkQsR0FDbkQsSUFBSXdELEVBQUlGLEVBQVNqRCxTQUFTLEdBQ3RCb0QsRUFBSUgsRUFBU2pELFNBQVMsR0FDdEJGLEVBQUlvRCxFQUFTbEQsU0FBUyxHQUN0QkQsRUFBSW1ELEVBQVNsRCxTQUFTLEdBQzFCLE1BQU1xRCxFQUFpQixHQUN2QixJQUFJQyxFQVNKLEdBTklILElBQU1yRCxFQUNSd0QsRUFBTyxhQUNFRixJQUFNckQsSUFDZnVELEVBQU8sWUFFVDlELFFBQVFDLElBQUk2RCxHQUNDLGVBQVRBLEVBQXVCLENBQ3JCRixFQUFJckQsSUFDSm9ELEVBQUlELEVBQVNsRCxTQUFTLEdBQ3RCb0QsRUFBSUYsRUFBU2xELFNBQVMsR0FDdEJGLEVBQUltRCxFQUFTakQsU0FBUyxHQUN0QkQsRUFBSWtELEVBQVNqRCxTQUFTLElBRTFCLE1BQU11RCxFQUFpQixDQUFDSixFQUFHQyxFQUFJLEdBQ3pCSSxFQUFpQixDQUFDMUQsRUFBR0MsRUFBSSxHQUMvQnNELEVBQWUxQyxLQUFLNEMsRUFBZ0JDLEVBQ3RDLE1BQU8sR0FBYSxhQUFURixFQUFxQixDQUMxQkgsRUFBSXJELElBQ0pxRCxFQUFJRCxFQUFTbEQsU0FBUyxHQUN0Qm9ELEVBQUlGLEVBQVNsRCxTQUFTLEdBQ3RCRixFQUFJbUQsRUFBU2pELFNBQVMsR0FDdEJELEVBQUlrRCxFQUFTakQsU0FBUyxJQUkxQixNQUFNdUQsRUFBaUIsQ0FBQ0osRUFBSSxFQUFHQyxHQUN6QkksRUFBaUIsQ0FBQzFELEVBQUksRUFBR0MsR0FDL0JzRCxFQUFlMUMsS0FBSzRDLEVBQWdCQyxFQUN0QyxDQUVBaEUsUUFBUUMsSUFBSTRELEVBQWdCLG1CQUc1QixNQUFNbEQsRUFBZWtELEVBQWV6QyxRQUFRSixHQUNuQ3NDLEVBQVl0QyxFQUFNLEdBQUlBLEVBQU0sR0FBSWIsRUFBTUMsY0FHL0MsT0FEQUosUUFBUUMsSUFBSVUsRUFBYyxpQkFDbkJBLENBQ1QsQ0M3RU8sTUFBTXNELEVBQVMsQ0FBQ0MsRUFBSUMsS0FDekIsTUFBTUMsRUFBT0YsRUFDYixJQUFJRyxFQUFjRixFQU1sQixTQUFTRyxFQUFrQkMsR0FDekIsTUFBTUMsRUFBbUJELEVBQWFFLGlCQUN0QyxPQUFRSixHQUNOLEtBQUssRUFDSEEsR0FBYyxFQUNkLE1BQ0YsS0FBSyxFQUNIQSxHQUFjLEVBR2xCLE9BQVFHLEdBQ04sS0FBSyxFQUNIRCxFQUFhRyxnQkFBZSxHQUM1QixNQUNGLEtBQUssRUFDSEgsRUFBYUcsZ0JBQWUsR0FJbEMsQ0FzQ0EsTUFBTyxDQUNMQyxPQXJDRixTQUFnQnhFLEVBQU95RSxFQUFnQnRFLEVBQUdDLEdBRXhDLEdBREErRCxFQUFrQk0sSUFDZFIsRUFPRixPQUZBcEUsUUFBUUMsSUFBSSxrQkFBbUJvRSxHQUMvQnJFLFFBQVFDLElBQUksa0JBQW1CMkUsRUFBZUgsa0JBQ3ZDdEUsRUFBTW1DLGNBQWNoQyxFQUFHQyxHQU45QlAsUUFBUUMsSUFBSSxrQkFBbUJvRSxHQUMvQnJFLFFBQVFDLElBQUksa0JBQW1CMkUsRUFBZUgsa0JEK0NwRCxTQUFrQnRFLEdBS2hCLFFBSmtCMEUsSUFBZDNCLElBQWtELElBQXZCQSxFQUFVckQsV0FDdkN3RCxFQUFPLEVBQ1BILE9BQVkyQixHQUVELElBQVR4QixFQUFZLENBQ2QsTUFBTXlCLEVBdkVWLFNBQWdDOUQsRUFBT2IsR0FDckMsTUFBTUcsRUFBSVUsRUFBTVIsU0FBUyxHQUNuQkQsRUFBSVMsRUFBTVIsU0FBUyxHQU9uQkcsRUFOaUIsQ0FDckIsQ0FBQ0wsRUFBR0MsRUFBSSxHQUNSLENBQUNELEVBQUdDLEVBQUksR0FDUixDQUFDRCxFQUFJLEVBQUdDLEdBQ1IsQ0FBQ0QsRUFBSSxFQUFHQyxJQUUwQmEsUUFBUUosR0FDMUNzQyxFQUFZdEMsRUFBTSxHQUFJQSxFQUFNLEdBQUliLEVBQU1DLGNBRXhDLE9BQU9PLENBQ1QsQ0EwRDJCb0UsQ0FBdUI1QixFQUFZaEQsR0FFcEQ2RSxFQUFhRixFQUREL0IsS0FBS0MsTUFBTUQsS0FBS0UsU0FBVzZCLEVBQWVyRixTQVE1RCxPQU5BMkQsRUFBaUJqRCxFQUFNbUMsaUJBQWlCMEMsR0FDWixPQUF4QjVCLEVBQWVyRCxPQUNqQnNELEdBQVEsUUFHVnJELFFBQVFDLElBQUlpRCxFQUVkLENBRUEsR0FBSUcsRUFBTyxFQUFHLENBQ1pyRCxRQUFRQyxJQUFJLGFBQWNrRCxFQUFZLG1CQUFvQkMsR0FDMUQsTUFBTXpDLEVBQWU2QyxFQUNuQkwsRUFDQUMsRUFDQWpELEdBR0k2RSxFQUFhckUsRUFERG9DLEtBQUtDLE1BQU1ELEtBQUtFLFNBQVd0QyxFQUFhbEIsU0FFcER3RixFQUFnQjlFLEVBQU1tQyxpQkFBaUIwQyxHQUs3QyxZQUoyQixPQUF2QkMsRUFBY2xGLE9BQ2hCcUQsRUFBaUI2QixFQUNqQjVCLEdBQVEsR0FHWixDQUNBLElBQUkyQixFQUFhekIsSUFDakIsTUFDa0UsSUFBaEVELEVBQVkwQixFQUFXLEdBQUlBLEVBQVcsR0FBSTdFLEVBQU1DLGFBRWhENEUsRUFBYXpCLElBRWZKLEVBQWFoRCxFQUFNbUMsaUJBQWlCMEMsR0FDWixPQUFwQjdCLEVBQVdwRCxPQUNibUQsRUFBWUMsRUFBV3BELEtBQ3ZCc0QsR0FBUSxFQUVaLENDM0ZNNkIsQ0FBUy9FLEVBTWIsRUEyQkVzRSxlQWhFcUIsSUFBTUosRUFpRTNCSyxlQWhFc0JTLElBQ3RCZCxFQUFjYyxHQWdFZDdCLFlBcEJGLFNBQXFCaEQsRUFBR0MsRUFBR0osR0FDekIsT0FBd0IsSUFBcEJBLEVBQU1HLEdBQUdDLEdBQUdYLEdBRWxCLEVBa0JFMEUsb0JBQ0FmLGVBN0JGLFdBSUUsTUFBTyxDQUhHUixLQUFLQyxNQUFzQixHQUFoQkQsS0FBS0UsVUFDaEJGLEtBQUtDLE1BQXNCLEdBQWhCRCxLQUFLRSxVQUc1QixFQXlCQyxFQ3RFSCxJQUFJbUMsRUFDQUMsRUFDSixNQUFNQyxFQUF3QixJQUFNRixFQUM5QkcsRUFBd0IsSUFBTUYsRUFDOUJHLEVBQVl2QixHQUFPLEdBQU8sR0FDMUJ3QixFQUFZeEIsR0FBTyxHQUFNLEdBQ3pCeUIsRUNQQyxXQUNMLE1BQU1DLEVBQXNCekYsSUFDdEIwRixFQUFpQkMsSUFDakJDLEVBQU9DLFNBQVNDLGNBQWMsUUFDOUJDLEVBQW1CRixTQUFTQyxjQUFjLHFCQUMxQ0UsRUFBbUJILFNBQVNDLGNBQWMscUJBQzFDRyxFQUF1QkosU0FBU0MsY0FBYyxvQkFDOUNJLEVBQVMsR0FDZixJQUdJOUYsRUFDQUMsRUFKQTZFLEVBQXFCUSxFQUFlTix3QkFDcENlLEVBQVcsT0FDWDdFLEVBQWEsRUFHYmhCLEVBQVcsV0FzQ2YsU0FBUzhGLEVBQWdCbkcsRUFBT29HLEdBQzlCQSxFQUFhQyxVQUFZLEdBRXpCckcsRUFBTVksU0FBU3FCLElBQ2JBLEVBQUlyQixTQUFTQyxLQXhDakIsU0FBcUJBLEVBQU91RixHQUMxQixNQUFNRSxFQUFnQlYsU0FBU1csY0FBYyxPQUM3Q0QsRUFBY0UsVUFBVUMsSUFBSSxTQUNULE9BQWY1RixFQUFNakIsTUFDUjBHLEVBQWNFLFVBQVVDLElBQUksUUFFWCxPQUFmNUYsRUFBTWpCLE1BQWlCd0csSUFBaUJMLEdBQ3hDTyxFQUFjRSxVQUFVQyxJQUFJLFVBRWIsT0FBZjVGLEVBQU1qQixNQUFpQmlCLEVBQU1qQixLQUFLRixVQUNwQzRHLEVBQWNFLFVBQVVDLElBQUksU0FFWixJQUFkNUYsRUFBTXBCLEtBQ1I2RyxFQUFjRSxVQUFVQyxJQUFJLE9BRTlCSCxFQUFjdEcsTUFBUWEsRUFBTWIsTUFDNUJzRyxFQUFjekYsTUFBUUEsRUFFakJvRixFQUFPOUUsU0FBU04sRUFBTTZGLFVBQ3pCVCxFQUFPakYsS0FBS0gsRUFBTVIsVUFHSCxTQUFiNkYsR0FDRkksRUFBY0ssaUJBQWlCLFlBQWFDLEdBQzVDTixFQUFjSyxpQkFBaUIsV0FBWUUsR0FDM0NQLEVBQWNLLGlCQUFpQixRQUFTL0UsR0FDeEMwRSxFQUFjSyxpQkFBaUIsUUFBU0csSUFDbEIsU0FBYlosR0FDVEksRUFBY0ssaUJBQWlCLFFBQVNJLEdBRzFDWCxFQUFhWSxZQUFZVixFQUczQixDQU9NVyxDQUFZcEcsRUFBT3VGLEVBQWEsR0FDaEMsR0FFTixDQUVBLFNBQVNjLEVBQWlCakMsRUFBb0JDLEdBQzVDaUIsRUFBZ0JsQixFQUFvQmEsR0FDcENLLEVBQWdCakIsRUFBb0JhLEVBQ3RDLENBRUEsU0FBU2dCLEVBQVlJLEdBRW5CLEdBQUlBLEVBQUVDLE9BQU9DLGdCQUFrQnRCLEVBQWtCLE9BQ2pELElBQW1DLElBQS9CVixFQUFVZixpQkFBMkIsT0FDekMsSUFBMkIsSUFBdkI2QyxFQUFFQyxPQUFPdkcsTUFBTXBCLElBQWMsT0FFakMsTUFBTVUsRUFBSWdILEVBQUVDLE9BQU92RyxNQUFNUixTQUFTLEdBQzVCRCxFQUFJK0csRUFBRUMsT0FBT3ZHLE1BQU1SLFNBQVMsR0FLbEMsR0FIQW9GLEVBQWU2QixLQUFLbkgsRUFBR0MsR0FHbkJxRixFQUFlOEIsaUJBQW5CLENBQ0UsTUFBTXRDLEVBQXFCUSxFQUFlTix3QkFDcENELEVBQXFCTyxFQUFlTCx3QkFDMUM4QixFQUNFakMsRUFBbUJoRixXQUNuQmlGLEVBQW1CakYsV0FHdkIsTUFDQWtHLEVBQWdCZ0IsRUFBRUMsT0FBT0MsY0FBY3JILE1BQU9tSCxFQUFFQyxPQUFPQyxlQUV2REcsWUFBVyxLQUNUL0IsRUFBZTZCLE9BQ2ZuQixFQUFnQmxCLEVBQW1CaEYsV0FBWTZGLEVBQWlCLEdBQy9ELE9BQ0wsQ0FpRUEsU0FBUzJCLEVBQWlCTixHQUl4QixHQUhBbEMsRUFBcUJRLEVBQWVOLHdCQUVwQ1csRUFBaUI0QixZQUFjekMsRUFDM0I1RCxFQUFhLEVBQUcsT0FDcEIsR0FBSThGLEVBQUVDLE9BQU9DLGNBQWNLLGNBQWdCekMsRUFFekMsT0FFRixNQUFNMEMsRUFBaUJDLE1BQU1DLEtBQUtqQyxTQUFTa0MsaUJBQWlCLFdBRTVEM0gsRUFBSWdILEVBQUVDLE9BQU92RyxNQUFNUixTQUFTLEdBQzVCRCxFQUFJK0csRUFBRUMsT0FBT3ZHLE1BQU1SLFNBQVMsR0FFNUIsTUFBTUwsRUFBUWlGLEVBQW1CaEYsV0FDM0JPLEVBQWVnRixFQUFvQnBFLGlCQUN2Q0MsRUFDQWxCLEVBQ0FDLEVBQ0FDLEVBQ0FMLEdBRUYsSUFBSStILEVBQ0FDLEVBUUosT0FQcUIsSUFBakJ4SCxJQUNGdUgsRUFBd0J2SCxFQUFheUgsS0FBS3BILEdBQVVBLEVBQU1SLFdBQzFEMkgsRUFBd0JMLEVBQWUxRyxRQUNwQ0osSUFDMEQsSUFBekRrSCxFQUFzQjVHLFNBQVNOLEVBQU1BLE1BQU1SLGFBRzdDMkgsUUFBSixDQUdGLENBRUEsU0FBU3BCLEVBQXFCTyxHQUM1QixNQUFNM0csRUFBZWlILEVBQWlCTixHQUNsQzNHLEdBQ0ZBLEVBQWFJLFNBQVNDLEdBQVVBLEVBQU0yRixVQUFVQyxJQUFJLFdBRXhELENBRUEsU0FBU0ksRUFBd0JNLEdBQy9CLE1BQU0zRyxFQUFlaUgsRUFBaUJOLEdBQ2xDM0csR0FDRkEsRUFBYUksU0FBU0MsR0FBVUEsRUFBTTJGLFVBQVUwQixPQUFPLFdBRTNELENBRUEsU0FBU3RHLEVBQVV1RixHQUNqQixHQUFJOUYsRUFBYSxHQUFLOEYsRUFBRUMsT0FBT0MsZ0JBQWtCdEIsRUFDL0MsT0FFRixNQUFNMkIsRUFBY3pDLEVBQ2RqRixFQUFRaUYsRUFBbUJoRixXQUMzQmtJLEVBQWlCckMsR0FHVixJQURBNEIsRUFBWTlGLFVBQVVQLEVBQVlsQixFQUFHQyxFQUFHQyxLQUVuRDhGLEVBQWdCbkcsRUFBT21JLEdBQ3ZCOUcsR0FBYyxHQUVaQSxFQUFhLEdBckduQixXQUNFLE1BQU0rRyxFQUFReEMsU0FBU1csY0FBYyxPQUNyQzZCLEVBQU01QixVQUFVQyxJQUFJLGNBQ3BCMkIsRUFBTTVCLFVBQVVDLElBQUksU0FFcEIsTUFBTTRCLEVBQWtCekMsU0FBU1csY0FBYyxVQUMvQzhCLEVBQWdCN0IsVUFBVUMsSUFBSSxxQkFDOUI0QixFQUFnQkMsWUFBYyxhQUU5QjNDLEVBQUtxQixZQUFZb0IsR0FDakJBLEVBQU1wQixZQUFZcUIsR0FFbEJBLEVBQWdCMUIsaUJBQWlCLFNBQVMsS0FDeENoQixFQUFLNEMsWUFBWUgsR0FDakIzQyxFQUFlK0MsWUFDZnhDLEVBQXFCUSxVQUFVaUMsT0FBTyxTQUFRLEdBRWxELENBb0ZzQkMsRUFDdEIsQ0FFQSxTQUFTNUIsSUFDUCxNQUFNN0IsRUFBcUJRLEVBQWVOLHdCQUNwQ0QsRUFBcUJPLEVBQWVMLHdCQUN0Qy9ELEVBQWEsSUFBRzZFLEVBQVcsUUFDM0I3RSxFQUFhLElBQUc2RSxFQUFXLFFBQy9CZ0IsRUFDRWpDLEVBQW1CaEYsV0FDbkJpRixFQUFtQmpGLFdBRXZCLENBZUEsT0FGQStGLEVBQXFCVyxpQkFBaUIsU0FYdEMsV0FDRSxPQUFRdEcsR0FDTixJQUFLLFdBQ0hBLEVBQVcsYUFDWCxNQUNGLElBQUssYUFDSEEsRUFBVyxXQUdqQixJQUlPLENBQ0w2RyxtQkFDQXlCLG1CQXpKRixTQUE0QkMsR0FDMUIsTUFBTVIsRUFBUXhDLFNBQVNXLGNBQWMsT0FDckM2QixFQUFNNUIsVUFBVUMsSUFBSSxZQUNwQjJCLEVBQU01QixVQUFVQyxJQUFJLFNBRXBCLE1BQU1vQyxFQUFPakQsU0FBU1csY0FBYyxLQUNwQ3NDLEVBQUtyQyxVQUFVQyxJQUFJLGlCQUNuQm9DLEVBQUtQLFlBQWMsR0FBR00sUUFFdEIsTUFBTUUsRUFBZ0JsRCxTQUFTVyxjQUFjLFVBQzdDdUMsRUFBY3RDLFVBQVVDLElBQUksbUJBQzVCcUMsRUFBY1IsWUFBYyxXQUU1QjNDLEVBQUtxQixZQUFZb0IsR0FDakJBLEVBQU1wQixZQUFZNkIsR0FDbEJULEVBQU1wQixZQUFZOEIsR0FFbEJBLEVBQWNuQyxpQkFBaUIsU0FBUyxNQWlDMUMsV0FDRSxNQUFNeUIsRUFBUXhDLFNBQVNDLGNBQWMsVUFFckNGLEVBQUs0QyxZQUFZSCxHQUNqQmxDLEVBQVcsT0FDWDdFLEVBQWEsRUFDYm9FLEVBQWVzRCxnQkFDakIsQ0F2Q01DLEdBQ0FoRCxFQUFxQlEsVUFBVWlDLE9BQU8sU0FBUSxHQUVwRCxFQXFJRVEsMkJBaEhGLFdBQzBCckQsU0FBU2tDLGlCQUFpQixVQUVsQ2xILFNBQVNDLElBQ3ZCQSxFQUFNcUksb0JBQW9CLFFBQVNuQyxFQUFZLEdBRW5ELEVBMkdFakIsbUJBQ0FDLG1CQUVKLENEeFBZb0QsR0FJTCxTQUFTekQsSUEyQ2QsU0FBUzZCLElBQ1AsT0FDMkMsSUFBekN0QyxFQUFtQjdDLG9CQUNzQixJQUF6QzhDLEVBQW1COUMsaUJBS3ZCLENBRUEsU0FBU2dILEVBQVFSLEdBQ2ZyRCxFQUFJb0QsbUJBQW1CQyxHQUN2QnJELEVBQUkwRCw0QkFDTixDQUVBLE1BQU8sQ0FDTFQsVUE5Q0YsV0FDRW5ELEVBQVVkLGdCQUFlLEdBQ3pCZSxFQUFVZixnQkFBZSxHQUV6QlcsRUFBbUIxQyxtQkFBbUIsR0FDdEMrQyxFQUFJMkIsaUJBQWlCakMsRUFBbUJoRixXQUFZaUYsRUFBbUJqRixXQUN6RSxFQXlDRXFILEtBdkNGLFNBQWNuSCxFQUFHQyxHQUNmLE1BQU1pSixFQUFnQmhFLEVBQVVmLGlCQUMxQmdGLEVBQWdCaEUsRUFBVWhCLGlCQVFoQyxJQU5zQixJQUFsQitFLEVBQ0ZoRSxFQUFVYixPQUFPVSxFQUFvQkksRUFBV25GLEVBQUdDLElBQ3hCLElBQWxCa0osR0FDVGhFLEVBQVVkLE9BQU9TLEVBQW9CSSxHQUduQ2tDLElBQWtCLENBQ3BCLElBQUlxQixFQUFTLElBQ2dDLElBQXpDM0QsRUFBbUI3QyxvQkFDckJ3RyxFQUFTLGVBRWtDLElBQXpDMUQsRUFBbUI5QyxvQkFDckJ3RyxFQUFTLGNBRVhRLEVBQVFSLEVBQ1YsQ0FDRixFQW9CRVEsVUFDQTdCLGlCQUNBd0IsZUE5REYsV0FDRSxNQUFNakQsRUFBbUJQLEVBQUlPLGlCQUN2QkMsRUFBbUJSLEVBQUlRLGlCQUM3QmQsRUFBcUJsRixJQUNyQm1GLEVBQXFCbkYsSUFDckJrRixFQUFtQnBELGdCQUNuQnFELEVBQW1CckQsZ0JBQ25CaUUsRUFBaUI5RixNQUFRaUYsRUFBbUJoRixXQUM1QzhGLEVBQWlCL0YsTUFBUWtGLEVBQW1CakYsV0FDNUNzRixFQUFJMkIsaUJBQWlCakMsRUFBbUJoRixXQUFZaUYsRUFBbUJqRixXQUN6RSxFQXFERWtGLHdCQUNBQyx3QkFFSixDRTdFQSxNQUFNSyxFQUFpQkMsSUFHdkJELEVBQWVzRCxpQkFDZixNQUFNckIsRUFBY2pDLEVBQWVOLHdCQUM3Qm9FLEVBQWlCOUQsRUFBZU4sd0JBQXdCbEYsV0FDOURKLFFBQVFDLElBQUk0SCxFQUFZekgsWUFFeEJ5SCxFQUFZMUYsYUFDWm5DLFFBQVFDLElBQUl1RCxFQUF3QmtHLEVBQWUsR0FBRyxHQUFJQSxFQUFlLEdBQUcsR0FBSTdCLElBR2hGOEIsT0FBT2hCLFVBQVkvQyxFQUFlK0MsVUFDbENnQixPQUFPSixRQUFVM0QsRUFBZTJELE8iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL3NoaXAuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9nYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9haS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL3BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2dhbWUuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9kb20uanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tYWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHNoaXBGYWN0b3J5ID0gKGxlbmd0aCkgPT4ge1xuICBcbiAgbGV0IG51bWJlck9mSGl0cyA9IDA7XG5cbiAgY29uc3QgZ2V0TGVuZ3RoID0gKCkgPT4gbGVuZ3RoO1xuICBjb25zdCBnZXROdW1iZXJPZkhpdHMgPSAoKSA9PiBudW1iZXJPZkhpdHNcblxuICBjb25zdCBoaXQgPSAoKSA9PiB7XG4gICAgbnVtYmVyT2ZIaXRzICs9IDFcbiAgICByZXR1cm4gbnVtYmVyT2ZIaXRzXG4gIH07XG5cbiAgY29uc3QgaXNTdW5rID0gKCkgPT4ge1xuICAgIGlmIChudW1iZXJPZkhpdHMgPT09IGxlbmd0aCkgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZ2V0TGVuZ3RoLFxuICAgIGhpdCxcbiAgICBpc1N1bmssXG4gICAgZ2V0TnVtYmVyT2ZIaXRzXG4gIH07XG59O1xuXG5jb25zdCBzaGlwID0gc2hpcEZhY3RvcnkoMSk7XG5zaGlwLmhpdCgpO1xuXG5jb25zb2xlLmxvZyhzaGlwLmdldExlbmd0aCgpKTtcbmV4cG9ydCB7IHNoaXBGYWN0b3J5IH07XG4iLCJpbXBvcnQgeyBzaGlwRmFjdG9yeSB9IGZyb20gXCIuL3NoaXAuanNcIjtcblxuZXhwb3J0IGNvbnN0IGdhbWVib2FyZEZhY3RvcnkgPSAoKSA9PiB7XG4gIGNvbnN0IGJvYXJkID0gW107XG5cbiAgY29uc3QgZ2V0Qm9hcmQgPSAoKSA9PiBib2FyZDtcblxuICBmdW5jdGlvbiBjcmVhdGVGaWVsZCh4LCB5KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHBvc2l0aW9uOiBbeCwgeV0sXG4gICAgICBvY2N1cGllZEJ5U2hpcDogZmFsc2UsXG4gICAgICBoaXQ6IGZhbHNlLFxuICAgICAgc2hpcDogbnVsbCxcbiAgICAgIGJvYXJkOiBnZXRCb2FyZCgpLFxuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBpbml0R2FtZWJvYXJkKCkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgY29uc3QgYXJyID0gW107XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgYXJyLnB1c2goY3JlYXRlRmllbGQoaSwgaikpO1xuICAgICAgfVxuICAgICAgYm9hcmQucHVzaChhcnIpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHByaW50Qm9hcmQoKSB7XG4gICAgYm9hcmQuZm9yRWFjaCgocm93KSA9PiB7XG4gICAgICBsZXQgc3RyaW5nID0gXCJcIjtcbiAgICAgIHJvdy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgICBpZiAoIWZpZWxkLm9jY3VwaWVkQnlTaGlwICYmICFmaWVsZC5oaXQpIHtcbiAgICAgICAgICBzdHJpbmcgKz0gYHwgJHtmaWVsZC5wb3NpdGlvbn0gfGA7XG4gICAgICAgIH0gZWxzZSBpZiAoIWZpZWxkLm9jY3VwaWVkQnlTaGlwICYmIGZpZWxkLmhpdCkge1xuICAgICAgICAgIHN0cmluZyArPSBgfCAgLSAgfGA7XG4gICAgICAgIH0gZWxzZSBpZiAoZmllbGQub2NjdXBpZWRCeVNoaXAgJiYgIWZpZWxkLmhpdCkge1xuICAgICAgICAgIHN0cmluZyArPSBcInwgIE8gIHxcIjtcbiAgICAgICAgfSBlbHNlIGlmIChmaWVsZC5vY2N1cGllZEJ5U2hpcCAmJiBmaWVsZC5oaXQpIHtcbiAgICAgICAgICBzdHJpbmcgKz0gXCJ8ICBYICB8XCI7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgY29uc29sZS5sb2coc3RyaW5nKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmROZWlnaGJvdXJGaWVsZHModGFyZ2V0RmllbGRzKSB7XG4gICAgaWYgKCF0YXJnZXRGaWVsZHMpIHJldHVybiBmYWxzZTtcbiAgICBjb25zdCBib2FyZCA9IGdldEJvYXJkKCk7XG4gICAgbGV0IGR1cGxpY2F0ZWROZWlnaGJvdXJzID0gW107XG4gICAgY29uc3QgbmVpZ2hib3VycyA9IFtdO1xuICAgIGNvbnN0IHBvc3NiaWxlTmVpZ2hib3VycyA9IFtdO1xuXG4gICAgdGFyZ2V0RmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICBjb25zdCB4ID0gZmllbGQucG9zaXRpb25bMF07XG4gICAgICBjb25zdCB5ID0gZmllbGQucG9zaXRpb25bMV07XG5cbiAgICAgIC8vIGFsbCB0aGUgcG9zc2libGUgbmVpZ2hib3VyIGZpZWxkc1xuICAgICAgY29uc3QgcG9zc2libGVOZWlnaGJvdXJzQ29vcmRpbmF0ZXMgPSBbXG4gICAgICAgIFt4IC0gMSwgeSAtIDFdLFxuICAgICAgICBbeCAtIDEsIHldLFxuICAgICAgICBbeCAtIDEsIHkgKyAxXSxcbiAgICAgICAgW3gsIHkgKyAxXSxcbiAgICAgICAgW3ggKyAxLCB5ICsgMV0sXG4gICAgICAgIFt4ICsgMSwgeV0sXG4gICAgICAgIFt4ICsgMSwgeSAtIDFdLFxuICAgICAgICBbeCwgeSAtIDFdLFxuICAgICAgXTtcblxuICAgICAgLy8gcHVzaCB0aGUgbmVpZ2hib3VyIGZpZWxkcyB0aGF0IGFyZSBub3Qgb3V0IG9mIGJvdW5kc1xuICAgICAgcG9zc2libGVOZWlnaGJvdXJzQ29vcmRpbmF0ZXMuZm9yRWFjaCgoY29vcmRpbmF0ZSkgPT4ge1xuICAgICAgICBpZiAoaXNPdXRPZkJvdW5kKGNvb3JkaW5hdGVbMF0sIGNvb3JkaW5hdGVbMV0pID09PSBmYWxzZSlcbiAgICAgICAgICBwb3NzYmlsZU5laWdoYm91cnMucHVzaChib2FyZFtjb29yZGluYXRlWzBdXVtjb29yZGluYXRlWzFdXSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIGFkZCBvbmx5IG5laWdoYm91cnMgdGhhdCBhcmUgbm90IGluY2x1ZGVkIGluIHRoZSB0YXJnZXQgZmllbGRzIGFycmF5XG5cbiAgICBkdXBsaWNhdGVkTmVpZ2hib3VycyA9IHBvc3NiaWxlTmVpZ2hib3Vycy5maWx0ZXIoXG4gICAgICAobmVpZ2hib3VyKSA9PiB0YXJnZXRGaWVsZHMuaW5jbHVkZXMobmVpZ2hib3VyKSA9PT0gZmFsc2UsXG4gICAgKTtcblxuICAgIGR1cGxpY2F0ZWROZWlnaGJvdXJzLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICBpZiAoIW5laWdoYm91cnMuaW5jbHVkZXMoZmllbGQpKSBuZWlnaGJvdXJzLnB1c2goZmllbGQpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIG5laWdoYm91cnM7XG4gIH1cblxuICBmdW5jdGlvbiBmaW5kVGFyZ2V0RmllbGRzKHNoaXBMZW5ndGgsIHgsIHksIGRpcmVjdGlvbiwgYm9hcmQpIHtcbiAgICBjb25zdCB0YXJnZXRGaWVsZHMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gXCJob3Jpem9udGFsXCIpIHtcbiAgICAgICAgaWYgKGlzT3V0T2ZCb3VuZCh4LCB5ICsgaSkpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIm91dCBvZiBib3VuZHNcIik7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRhcmdldEZpZWxkcy5wdXNoKGJvYXJkW3hdW3kgKyBpXSk7XG4gICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gXCJ2ZXJ0aWNhbFwiKSB7XG4gICAgICAgIGlmIChpc091dE9mQm91bmQoeCArIGksIHkpKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJvdXQgb2YgYm91bmRzXCIpO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0YXJnZXRGaWVsZHMucHVzaChib2FyZFt4ICsgaV1beV0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGFyZ2V0RmllbGRzO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNPdXRPZkJvdW5kKHgsIHkpIHtcbiAgICBpZiAoeCA8IDAgfHwgeCA+IDkgfHwgeSA8IDAgfHwgeSA+IDkpIHJldHVybiB0cnVlO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNoZWNrSWZGaWVsZE9jY3VwaWVkKGZpZWxkKSB7XG4gICAgcmV0dXJuIGZpZWxkLm9jY3VwaWVkQnlTaGlwID09PSB0cnVlO1xuICB9XG5cbiAgZnVuY3Rpb24gY2FuU2hpcEJlUGxhY2VkKHRhcmdldEZpZWxkcywgbmVpZ2hib3VyRmllbGRzKSB7XG4gICAgY29uc29sZS5sb2codGFyZ2V0RmllbGRzLCBcInRhcmdldCBmaWVsZHNcIik7XG4gICAgaWYgKCF0YXJnZXRGaWVsZHMpIHJldHVybiBmYWxzZTtcblxuICAgIC8vIGlmIGZpZWxkcyBhcmUgYWxyZWFkeSBvY2N1cGllZCwgb3IgbmVpZ2hib3VyIGZpZWxkcyBhcmUgb2NjdXBpZWQsIHJldHVybiBmYWxzZVxuICAgIGlmIChcbiAgICAgIHRhcmdldEZpZWxkcy5zb21lKGNoZWNrSWZGaWVsZE9jY3VwaWVkKSB8fFxuICAgICAgbmVpZ2hib3VyRmllbGRzLnNvbWUoY2hlY2tJZkZpZWxkT2NjdXBpZWQpXG4gICAgKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBmdW5jdGlvbiBwbGFjZVNoaXAoc2hpcExlbmd0aCwgeCwgeSwgZGlyZWN0aW9uID0gXCJob3Jpem9udGFsXCIpIHtcbiAgICBjb25zdCBib2FyZCA9IGdldEJvYXJkKCk7XG4gICAgY29uc3QgdGFyZ2V0RmllbGRzID0gZmluZFRhcmdldEZpZWxkcyhzaGlwTGVuZ3RoLCB4LCB5LCBkaXJlY3Rpb24sIGJvYXJkKTtcbiAgICBjb25zdCBuZWlnaGJvdXJGaWVsZHMgPSBmaW5kTmVpZ2hib3VyRmllbGRzKHRhcmdldEZpZWxkcyk7XG4gICAgaWYgKCFjYW5TaGlwQmVQbGFjZWQodGFyZ2V0RmllbGRzLCBuZWlnaGJvdXJGaWVsZHMpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IHNoaXAgPSBzaGlwRmFjdG9yeShzaGlwTGVuZ3RoKTtcblxuICAgIHRhcmdldEZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgZmllbGQub2NjdXBpZWRCeVNoaXAgPSB0cnVlO1xuICAgICAgZmllbGQuc2hpcCA9IHNoaXA7XG4gICAgfSk7XG4gICAgcmV0dXJuIHNoaXA7XG4gIH1cblxuICBmdW5jdGlvbiBwbGFjZVNoaXBzUmFuZG9tbHkoYW1vdW50KSB7XG4gICAgY29uc3QgcGxhY2VkU2hpcHMgPSBbXTtcbiAgICBsZXQgY3VycmVudFNoaXBMZW5naHQgPSAxO1xuICAgIHdoaWxlIChwbGFjZWRTaGlwcy5sZW5ndGggIT09IGFtb3VudCkge1xuICAgICAgY29uc3QgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICBjb25zdCByYW5kb21EaXJlY3Rpb24gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKTtcbiAgICAgIGxldCBkaXJlY3Rpb247XG5cbiAgICAgIHN3aXRjaCAocmFuZG9tRGlyZWN0aW9uKSB7XG4gICAgICAgIGNhc2UgMTpcbiAgICAgICAgICBkaXJlY3Rpb24gPSBcInZlcnRpY2FsXCI7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMDpcbiAgICAgICAgICBkaXJlY3Rpb24gPSBcImhvcml6b250YWxcIjtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc2hpcCA9IHBsYWNlU2hpcChjdXJyZW50U2hpcExlbmdodCwgeCwgeSwgZGlyZWN0aW9uKTtcblxuICAgICAgaWYgKHNoaXAgIT09IGZhbHNlKSB7XG4gICAgICAgIHBsYWNlZFNoaXBzLnB1c2goc2hpcCk7XG4gICAgICAgIGN1cnJlbnRTaGlwTGVuZ2h0Kys7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcmVjZWl2ZUF0dGFjayh4LCB5KSB7XG4gICAgaWYgKGlzT3V0T2ZCb3VuZCh4LCB5KSkge1xuICAgICAgY29uc29sZS5sb2coXCJvdXQgb2YgYm91bmRzXCIpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmIChib2FyZFt4XVt5XS5oaXQpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiZmllbGQgYWxyZWFkeSBoaXRcIik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKGJvYXJkW3hdW3ldLnNoaXAgIT09IG51bGwpIGJvYXJkW3hdW3ldLnNoaXAuaGl0KCk7XG5cbiAgICBib2FyZFt4XVt5XS5oaXQgPSB0cnVlO1xuICAgIC8vIHByaW50Qm9hcmQoKTtcbiAgICByZXR1cm4gYm9hcmRbeF1beV1cbiAgfVxuXG4gIGZ1bmN0aW9uIGFyZUFsbFNoaXBzU3VuaygpIHtcbiAgICBjb25zdCBmaWVsZHNPY2N1cGllZEJ5U2hpcHMgPSBbXTtcbiAgICBib2FyZC5mb3JFYWNoKChyb3cpID0+IHtcbiAgICAgIGNvbnN0IG9jY3VwaWVkID0gcm93LmZpbHRlcigoZmllbGQpID0+IHtcbiAgICAgICAgcmV0dXJuIGZpZWxkLm9jY3VwaWVkQnlTaGlwID09PSB0cnVlO1xuICAgICAgfSk7XG4gICAgICBmaWVsZHNPY2N1cGllZEJ5U2hpcHMucHVzaCguLi5vY2N1cGllZCk7XG4gICAgfSk7XG4gICAgaWYgKGZpZWxkc09jY3VwaWVkQnlTaGlwcy5ldmVyeSgoZmllbGQpID0+IGZpZWxkLmhpdCA9PT0gdHJ1ZSkpIHJldHVybiB0cnVlO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgY3JlYXRlRmllbGQsXG4gICAgaW5pdEdhbWVib2FyZCxcbiAgICBwcmludEJvYXJkLFxuICAgIGdldEJvYXJkLFxuICAgIGZpbmRUYXJnZXRGaWVsZHMsXG4gICAgZmluZE5laWdoYm91ckZpZWxkcyxcbiAgICBjYW5TaGlwQmVQbGFjZWQsXG4gICAgcGxhY2VTaGlwLFxuICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgYXJlQWxsU2hpcHNTdW5rLFxuICAgIHBsYWNlU2hpcHNSYW5kb21seSxcbiAgfTtcbn07XG4iLCJsZXQgaGl0cyA9IDA7XG5sZXQgaGl0ZWRTaGlwO1xubGV0IGhpdGVkRmllbGQ7XG5sZXQgdGVtcEhpdGVkRmllbGQ7XG5cbmZ1bmN0aW9uIGlzTW92ZUxlZ2FsKHgsIHksIGJvYXJkKSB7XG4gIGlmICh4ID4gOSB8fCB4IDwgMCB8fCB5IDwgMCB8fCB5ID4gOSkgcmV0dXJuIGZhbHNlO1xuICBpZiAoYm9hcmRbeF1beV0uaGl0ID09PSB0cnVlKSByZXR1cm4gZmFsc2U7XG4gIHJldHVybiB0cnVlO1xufVxuZnVuY3Rpb24gZmluZFJhbmRvbU1vdmUoKSB7XG4gIGNvbnN0IHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gIGNvbnN0IHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG5cbiAgcmV0dXJuIFt4LCB5XTtcbn1cblxuZnVuY3Rpb24gZmluZEZvdXJBZGphY2VudEZpZWxkcyhmaWVsZCwgYm9hcmQpIHtcbiAgY29uc3QgeCA9IGZpZWxkLnBvc2l0aW9uWzBdO1xuICBjb25zdCB5ID0gZmllbGQucG9zaXRpb25bMV07XG4gIGNvbnN0IHBvc3NpYmxlRmllbGRzID0gW1xuICAgIFt4LCB5ICsgMV0sXG4gICAgW3gsIHkgLSAxXSxcbiAgICBbeCArIDEsIHldLFxuICAgIFt4IC0gMSwgeV0sXG4gIF07XG4gIGNvbnN0IHRhcmdldEZpZWxkcyA9IHBvc3NpYmxlRmllbGRzLmZpbHRlcigoZmllbGQpID0+XG4gICAgaXNNb3ZlTGVnYWwoZmllbGRbMF0sIGZpZWxkWzFdLCBib2FyZC5nZXRCb2FyZCgpKSxcbiAgKTtcbiAgcmV0dXJuIHRhcmdldEZpZWxkcztcbn1cblxuZnVuY3Rpb24gZmluZEFkamFjZW50RmllbGRPbkF4aXMoZmllbGRPbmUsIGZpZWxkVHdvLCBib2FyZCkge1xuICBsZXQgYSA9IGZpZWxkT25lLnBvc2l0aW9uWzBdO1xuICBsZXQgYiA9IGZpZWxkT25lLnBvc2l0aW9uWzFdO1xuICBsZXQgeCA9IGZpZWxkVHdvLnBvc2l0aW9uWzBdO1xuICBsZXQgeSA9IGZpZWxkVHdvLnBvc2l0aW9uWzFdO1xuICBjb25zdCBwb3NzaWJsZUZpZWxkcyA9IFtdO1xuICBsZXQgYXhpcztcbiAgXG5cbiAgaWYgKGEgPT09IHgpIHtcbiAgICBheGlzID0gXCJob3Jpem9udGFsXCI7XG4gIH0gZWxzZSBpZiAoYiA9PT0geSkge1xuICAgIGF4aXMgPSBcInZlcnRpY2FsXCI7XG4gIH1cbiAgY29uc29sZS5sb2coYXhpcylcbiAgaWYgKGF4aXMgPT09IFwiaG9yaXpvbnRhbFwiKSB7XG4gICAgaWYgKGIgPiB5KSB7XG4gICAgICAgIGEgPSBmaWVsZFR3by5wb3NpdGlvblswXVxuICAgICAgICBiID0gZmllbGRUd28ucG9zaXRpb25bMV1cbiAgICAgICAgeCA9IGZpZWxkT25lLnBvc2l0aW9uWzBdXG4gICAgICAgIHkgPSBmaWVsZE9uZS5wb3NpdGlvblsxXVxuICAgIH1cbiAgICBjb25zdCB0YXJnZXRGaWVsZE9uZSA9IFthLCBiIC0gMV07XG4gICAgY29uc3QgdGFyZ2V0RmllbGRUd28gPSBbeCwgeSArIDFdO1xuICAgIHBvc3NpYmxlRmllbGRzLnB1c2godGFyZ2V0RmllbGRPbmUsIHRhcmdldEZpZWxkVHdvKTtcbiAgfSBlbHNlIGlmIChheGlzID09PSBcInZlcnRpY2FsXCIpIHtcbiAgICBpZiAoYSA+IHgpIHtcbiAgICAgICAgYSA9IGZpZWxkVHdvLnBvc2l0aW9uWzBdXG4gICAgICAgIGIgPSBmaWVsZFR3by5wb3NpdGlvblsxXVxuICAgICAgICB4ID0gZmllbGRPbmUucG9zaXRpb25bMF1cbiAgICAgICAgeSA9IGZpZWxkT25lLnBvc2l0aW9uWzFdXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGEsIGIpXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHgsIHkpXG4gICAgfVxuICAgIGNvbnN0IHRhcmdldEZpZWxkT25lID0gW2EgLSAxLCBiXTtcbiAgICBjb25zdCB0YXJnZXRGaWVsZFR3byA9IFt4ICsgMSwgeV07XG4gICAgcG9zc2libGVGaWVsZHMucHVzaCh0YXJnZXRGaWVsZE9uZSwgdGFyZ2V0RmllbGRUd28pO1xuICB9XG5cbiAgY29uc29sZS5sb2cocG9zc2libGVGaWVsZHMsICdwb3NzaWJsZSBmaWVsZHMnKVxuLy8gICBjb25zb2xlLmxvZyhpc01vdmVMZWdhbChwb3NzaWJsZUZpZWxkc1swXVswXSwgcG9zc2libGVGaWVsZHNbMF1bMV0sIGJvYXJkLmdldEJvYXJkKCkpKVxuLy8gICBjb25zb2xlLmxvZyhpc01vdmVMZWdhbChwb3NzaWJsZUZpZWxkc1sxXVswXSwgcG9zc2libGVGaWVsZHNbMV1bMV0sIGJvYXJkLmdldEJvYXJkKCkpKVxuICBjb25zdCB0YXJnZXRGaWVsZHMgPSBwb3NzaWJsZUZpZWxkcy5maWx0ZXIoKGZpZWxkKSA9PiB7XG4gICAgcmV0dXJuIGlzTW92ZUxlZ2FsKGZpZWxkWzBdLCBmaWVsZFsxXSwgYm9hcmQuZ2V0Qm9hcmQoKSk7XG4gIH0pO1xuICBjb25zb2xlLmxvZyh0YXJnZXRGaWVsZHMsICd0YXJnZXQgZmllbGRzJylcbiAgcmV0dXJuIHRhcmdldEZpZWxkcztcbn1cblxuLy8gTmEgcmF6aWUgYWkgcG8gMSB0cmFmaWVuaXUgdWRlcnphIHcgamVkZW4geiBjenRlcmVjaCBzbG90w7N3IHcgb2vDs8WCXG5mdW5jdGlvbiBhaUF0dGFjayhib2FyZCkge1xuICBpZiAoaGl0ZWRTaGlwICE9PSB1bmRlZmluZWQgJiYgaGl0ZWRTaGlwLmlzU3VuaygpID09PSB0cnVlKSB7XG4gICAgaGl0cyA9IDA7XG4gICAgaGl0ZWRTaGlwID0gdW5kZWZpbmVkO1xuICB9XG4gIGlmIChoaXRzID09PSAxKSB7XG4gICAgY29uc3QgYWRqYWNlbnRGaWVsZHMgPSBmaW5kRm91ckFkamFjZW50RmllbGRzKGhpdGVkRmllbGQsIGJvYXJkKTtcbiAgICBjb25zdCByYW5kb21OdW0gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhZGphY2VudEZpZWxkcy5sZW5ndGgpO1xuICAgIGNvbnN0IHJhbmRvbU1vdmUgPSBhZGphY2VudEZpZWxkc1tyYW5kb21OdW1dO1xuICAgIHRlbXBIaXRlZEZpZWxkID0gYm9hcmQucmVjZWl2ZUF0dGFjayguLi5yYW5kb21Nb3ZlKTtcbiAgICBpZiAodGVtcEhpdGVkRmllbGQuc2hpcCAhPT0gbnVsbCkge1xuICAgICAgaGl0cyArPSAxO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKGhpdGVkU2hpcCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGhpdHMgPiAxKSB7XG4gICAgY29uc29sZS5sb2coJ2hpdGVkRmllbGQnLCBoaXRlZEZpZWxkLCAndGVtcCBoaXRlZCBmaWVsZCcsIHRlbXBIaXRlZEZpZWxkKVxuICAgIGNvbnN0IHRhcmdldEZpZWxkcyA9IGZpbmRBZGphY2VudEZpZWxkT25BeGlzKFxuICAgICAgaGl0ZWRGaWVsZCxcbiAgICAgIHRlbXBIaXRlZEZpZWxkLFxuICAgICAgYm9hcmQsXG4gICAgKTtcbiAgICBjb25zdCByYW5kb21OdW0gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0YXJnZXRGaWVsZHMubGVuZ3RoKTtcbiAgICBjb25zdCByYW5kb21Nb3ZlID0gdGFyZ2V0RmllbGRzW3JhbmRvbU51bV07XG4gICAgY29uc3QgbmV3SGl0ZWRGaWVsZCA9IGJvYXJkLnJlY2VpdmVBdHRhY2soLi4ucmFuZG9tTW92ZSk7XG4gICAgaWYgKG5ld0hpdGVkRmllbGQuc2hpcCAhPT0gbnVsbCkge1xuICAgICAgdGVtcEhpdGVkRmllbGQgPSBuZXdIaXRlZEZpZWxkO1xuICAgICAgaGl0cyArPSAxO1xuICAgIH1cbiAgICByZXR1cm5cbiAgfVxuICBsZXQgcmFuZG9tTW92ZSA9IGZpbmRSYW5kb21Nb3ZlKCk7XG4gIHdoaWxlIChcbiAgICBpc01vdmVMZWdhbChyYW5kb21Nb3ZlWzBdLCByYW5kb21Nb3ZlWzFdLCBib2FyZC5nZXRCb2FyZCgpKSA9PT0gZmFsc2VcbiAgKSB7XG4gICAgcmFuZG9tTW92ZSA9IGZpbmRSYW5kb21Nb3ZlKCk7XG4gIH1cbiAgaGl0ZWRGaWVsZCA9IGJvYXJkLnJlY2VpdmVBdHRhY2soLi4ucmFuZG9tTW92ZSk7XG4gIGlmIChoaXRlZEZpZWxkLnNoaXAgIT09IG51bGwpIHtcbiAgICBoaXRlZFNoaXAgPSBoaXRlZEZpZWxkLnNoaXA7XG4gICAgaGl0cyArPSAxO1xuICB9XG59XG5leHBvcnQgeyBhaUF0dGFjaywgZmluZEFkamFjZW50RmllbGRPbkF4aXMgfTtcbiIsImltcG9ydCB7IGFpQXR0YWNrIH0gZnJvbSBcIi4vYWkuanNcIjtcblxuZXhwb3J0IGNvbnN0IHBsYXllciA9IChhaSwgaXNJdFBsYXllcnNUdXJuKSA9PiB7XG4gIGNvbnN0IGlzQWkgPSBhaTtcbiAgbGV0IHBsYXllcnNUdXJuID0gaXNJdFBsYXllcnNUdXJuO1xuICBjb25zdCBnZXRQbGF5ZXJzVHVybiA9ICgpID0+IHBsYXllcnNUdXJuO1xuICBjb25zdCBzZXRQbGF5ZXJzVHVybiA9ICh2YWx1ZSkgPT4ge1xuICAgIHBsYXllcnNUdXJuID0gdmFsdWVcbiAgfVxuXG4gIGZ1bmN0aW9uIGNoYW5nZVBsYXllcnNUdXJuKHNlY29uZFBsYXllcikge1xuICAgIGNvbnN0IHNlY29uZFBsYXllclR1cm4gPSBzZWNvbmRQbGF5ZXIuZ2V0UGxheWVyc1R1cm4oKTtcbiAgICBzd2l0Y2ggKHBsYXllcnNUdXJuKSB7XG4gICAgICBjYXNlIHRydWU6XG4gICAgICAgIHBsYXllcnNUdXJuID0gZmFsc2U7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBmYWxzZTpcbiAgICAgICAgcGxheWVyc1R1cm4gPSB0cnVlO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgc3dpdGNoIChzZWNvbmRQbGF5ZXJUdXJuKSB7XG4gICAgICBjYXNlIHRydWU6XG4gICAgICAgIHNlY29uZFBsYXllci5zZXRQbGF5ZXJzVHVybihmYWxzZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBmYWxzZTpcbiAgICAgICAgc2Vjb25kUGxheWVyLnNldFBsYXllcnNUdXJuKHRydWUpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgXG4gIH1cblxuICBmdW5jdGlvbiBhdHRhY2soYm9hcmQsIGF0dGFja2VkUGxheWVyLCB4LCB5KSB7XG4gICAgY2hhbmdlUGxheWVyc1R1cm4oYXR0YWNrZWRQbGF5ZXIpO1xuICAgIGlmIChpc0FpKSB7XG4gICAgICBjb25zb2xlLmxvZyhcInBsYXllciBvbmUgdHVyblwiLCBwbGF5ZXJzVHVybik7XG4gICAgICBjb25zb2xlLmxvZyhcInBsYXllciB0d28gdHVyblwiLCBhdHRhY2tlZFBsYXllci5nZXRQbGF5ZXJzVHVybigpKTtcbiAgICAgIGFpQXR0YWNrKGJvYXJkLCBhdHRhY2tlZFBsYXllcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKFwicGxheWVyIG9uZSB0dXJuXCIsIHBsYXllcnNUdXJuKTtcbiAgICAgIGNvbnNvbGUubG9nKFwicGxheWVyIHR3byB0dXJuXCIsIGF0dGFja2VkUGxheWVyLmdldFBsYXllcnNUdXJuKCkpO1xuICAgICAgcmV0dXJuIGJvYXJkLnJlY2VpdmVBdHRhY2soeCwgeSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZmluZFJhbmRvbU1vdmUoKSB7XG4gICAgY29uc3QgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICBjb25zdCB5ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuXG4gICAgcmV0dXJuIFt4LCB5XTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzTW92ZUxlZ2FsKHgsIHksIGJvYXJkKSB7XG4gICAgaWYgKGJvYXJkW3hdW3ldLmhpdCA9PT0gdHJ1ZSkgcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLy8gZnVuY3Rpb24gYWlBdHRhY2soYm9hcmQpIHtcbiAgLy8gICBsZXQgcmFuZG9tTW92ZSA9IGZpbmRSYW5kb21Nb3ZlKCk7XG4gIC8vICAgd2hpbGUgKFxuICAvLyAgICAgaXNNb3ZlTGVnYWwocmFuZG9tTW92ZVswXSwgcmFuZG9tTW92ZVsxXSwgYm9hcmQuZ2V0Qm9hcmQoKSkgPT09IGZhbHNlXG4gIC8vICAgKSB7XG4gIC8vICAgICByYW5kb21Nb3ZlID0gZmluZFJhbmRvbU1vdmUoKTtcbiAgLy8gICB9XG4gIC8vICAgY29uc29sZS5sb2coLi4ucmFuZG9tTW92ZSlcbiAgLy8gICByZXR1cm4gYm9hcmQucmVjZWl2ZUF0dGFjayguLi5yYW5kb21Nb3ZlKTtcbiAgLy8gfVxuXG4gIHJldHVybiB7XG4gICAgYXR0YWNrLFxuICAgIGdldFBsYXllcnNUdXJuLFxuICAgIHNldFBsYXllcnNUdXJuLFxuICAgIGlzTW92ZUxlZ2FsLFxuICAgIGNoYW5nZVBsYXllcnNUdXJuLFxuICAgIGZpbmRSYW5kb21Nb3ZlXG4gIH07XG59O1xuIiwiaW1wb3J0IHsgZ2FtZWJvYXJkRmFjdG9yeSB9IGZyb20gXCIuL2dhbWVib2FyZC5qc1wiO1xuaW1wb3J0IHsgcGxheWVyIH0gZnJvbSBcIi4vcGxheWVyLmpzXCI7XG5pbXBvcnQgeyBkb21Db250cm9sbGVyIH0gZnJvbSBcIi4vZG9tLmpzXCI7XG5cbmxldCBwbGF5ZXJPbmVHYW1lYm9hcmQgXG5sZXQgcGxheWVyVHdvR2FtZWJvYXJkIFxuY29uc3QgZ2V0UGxheWVyT25lR2FtZWJvYXJkID0gKCkgPT4gcGxheWVyT25lR2FtZWJvYXJkXG5jb25zdCBnZXRQbGF5ZXJUd29HYW1lYm9hcmQgPSAoKSA9PiBwbGF5ZXJUd29HYW1lYm9hcmRcbmNvbnN0IHBsYXllck9uZSA9IHBsYXllcihmYWxzZSwgdHJ1ZSk7XG5jb25zdCBwbGF5ZXJUd28gPSBwbGF5ZXIodHJ1ZSwgZmFsc2UpO1xuY29uc3QgZG9tID0gZG9tQ29udHJvbGxlcihcbiAgcGxheWVyT25lLFxuICBwbGF5ZXJUd28sXG4pO1xuZXhwb3J0IGZ1bmN0aW9uIGdhbWUoKSB7XG4gIGZ1bmN0aW9uIGluaXRHYW1lYm9hcmRzKCkge1xuICAgIGNvbnN0IHBsYXllck9uZURpc3BsYXkgPSBkb20ucGxheWVyT25lRGlzcGxheVxuICAgIGNvbnN0IHBsYXllclR3b0Rpc3BsYXkgPSBkb20ucGxheWVyVHdvRGlzcGxheVxuICAgIHBsYXllck9uZUdhbWVib2FyZCA9IGdhbWVib2FyZEZhY3RvcnkoKTtcbiAgICBwbGF5ZXJUd29HYW1lYm9hcmQgPSBnYW1lYm9hcmRGYWN0b3J5KCk7XG4gICAgcGxheWVyT25lR2FtZWJvYXJkLmluaXRHYW1lYm9hcmQoKTtcbiAgICBwbGF5ZXJUd29HYW1lYm9hcmQuaW5pdEdhbWVib2FyZCgpO1xuICAgIHBsYXllck9uZURpc3BsYXkuYm9hcmQgPSBwbGF5ZXJPbmVHYW1lYm9hcmQuZ2V0Qm9hcmQoKVxuICAgIHBsYXllclR3b0Rpc3BsYXkuYm9hcmQgPSBwbGF5ZXJUd29HYW1lYm9hcmQuZ2V0Qm9hcmQoKVxuICAgIGRvbS5yZW5kZXJHYW1lYm9hcmRzKHBsYXllck9uZUdhbWVib2FyZC5nZXRCb2FyZCgpLCBwbGF5ZXJUd29HYW1lYm9hcmQuZ2V0Qm9hcmQoKSk7XG4gIH1cblxuICBmdW5jdGlvbiBzdGFydEdhbWUoKSB7XG4gICAgcGxheWVyT25lLnNldFBsYXllcnNUdXJuKHRydWUpO1xuICAgIHBsYXllclR3by5zZXRQbGF5ZXJzVHVybihmYWxzZSk7XG5cbiAgICBwbGF5ZXJUd29HYW1lYm9hcmQucGxhY2VTaGlwc1JhbmRvbWx5KDUpO1xuICAgIGRvbS5yZW5kZXJHYW1lYm9hcmRzKHBsYXllck9uZUdhbWVib2FyZC5nZXRCb2FyZCgpLCBwbGF5ZXJUd29HYW1lYm9hcmQuZ2V0Qm9hcmQoKSk7XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5KHgsIHkpIHtcbiAgICBjb25zdCBwbGF5ZXJPbmVUdXJuID0gcGxheWVyT25lLmdldFBsYXllcnNUdXJuKCk7XG4gICAgY29uc3QgcGxheWVyVHdvVHVybiA9IHBsYXllclR3by5nZXRQbGF5ZXJzVHVybigpO1xuXG4gICAgaWYgKHBsYXllck9uZVR1cm4gPT09IHRydWUpIHtcbiAgICAgIHBsYXllck9uZS5hdHRhY2socGxheWVyVHdvR2FtZWJvYXJkLCBwbGF5ZXJUd28sIHgsIHkpO1xuICAgIH0gZWxzZSBpZiAocGxheWVyVHdvVHVybiA9PT0gdHJ1ZSkge1xuICAgICAgcGxheWVyVHdvLmF0dGFjayhwbGF5ZXJPbmVHYW1lYm9hcmQsIHBsYXllck9uZSk7XG4gICAgfVxuXG4gICAgaWYgKGlzR2FtZUZpbmlzaGVkKCkpIHtcbiAgICAgIGxldCB3aW5uZXIgPSBcIlwiO1xuICAgICAgaWYgKHBsYXllck9uZUdhbWVib2FyZC5hcmVBbGxTaGlwc1N1bmsoKSA9PT0gdHJ1ZSkge1xuICAgICAgICB3aW5uZXIgPSBcIlBsYXllciBUd29cIjtcbiAgICAgIH1cbiAgICAgIGlmIChwbGF5ZXJUd29HYW1lYm9hcmQuYXJlQWxsU2hpcHNTdW5rKCkgPT09IHRydWUpIHtcbiAgICAgICAgd2lubmVyID0gXCJQbGF5ZXIgT25lXCI7XG4gICAgICB9XG4gICAgICBlbmRHYW1lKHdpbm5lcik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaXNHYW1lRmluaXNoZWQoKSB7XG4gICAgaWYgKFxuICAgICAgcGxheWVyT25lR2FtZWJvYXJkLmFyZUFsbFNoaXBzU3VuaygpID09PSB0cnVlIHx8XG4gICAgICBwbGF5ZXJUd29HYW1lYm9hcmQuYXJlQWxsU2hpcHNTdW5rKCkgPT09IHRydWVcbiAgICApIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBmdW5jdGlvbiBlbmRHYW1lKHdpbm5lcikge1xuICAgIGRvbS5jcmVhdGVFbmRHYW1lUG9wdXAod2lubmVyKTtcbiAgICBkb20ucmVtb3ZlRmllbGRzRXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgc3RhcnRHYW1lLFxuICAgIHBsYXksXG4gICAgZW5kR2FtZSxcbiAgICBpc0dhbWVGaW5pc2hlZCxcbiAgICBpbml0R2FtZWJvYXJkcyxcbiAgICBnZXRQbGF5ZXJPbmVHYW1lYm9hcmQsXG4gICAgZ2V0UGxheWVyVHdvR2FtZWJvYXJkXG4gIH07XG59XG5cbmV4cG9ydCB7IHBsYXllck9uZSwgcGxheWVyVHdvIH07XG4iLCJpbXBvcnQgeyBnYW1lLCBwbGF5ZXJPbmUgfSBmcm9tIFwiLi9nYW1lLmpzXCI7XG5pbXBvcnQgeyBnYW1lYm9hcmRGYWN0b3J5IH0gZnJvbSBcIi4vZ2FtZWJvYXJkLmpzXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBkb21Db250cm9sbGVyKCkge1xuICBjb25zdCBnYW1lYm9hcmRDb250cm9sbGVyID0gZ2FtZWJvYXJkRmFjdG9yeSgpO1xuICBjb25zdCBnYW1lQ29udHJvbGxlciA9IGdhbWUoKTtcbiAgY29uc3QgbWFpbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJtYWluXCIpO1xuICBjb25zdCBwbGF5ZXJPbmVEaXNwbGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItb25lLWJvYXJkXCIpO1xuICBjb25zdCBwbGF5ZXJUd29EaXNwbGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItdHdvLWJvYXJkXCIpO1xuICBjb25zdCBzd2l0Y2hQb3NpdGlvbkJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc3dpdGNoLXBvc2l0aW9uXCIpO1xuICBjb25zdCBmaWVsZHMgPSBbXTtcbiAgbGV0IHBsYXllck9uZUdhbWVib2FyZCA9IGdhbWVDb250cm9sbGVyLmdldFBsYXllck9uZUdhbWVib2FyZCgpO1xuICBsZXQgZ2FtZU1vZGUgPSBcImluaXRcIjtcbiAgbGV0IHNoaXBMZW5ndGggPSAxO1xuICBsZXQgeDtcbiAgbGV0IHk7XG4gIGxldCBwb3NpdGlvbiA9IFwidmVydGljYWxcIjtcblxuICBmdW5jdGlvbiByZW5kZXJGaWVsZChmaWVsZCwgYm9hcmREaXNwbGF5KSB7XG4gICAgY29uc3QgcmVuZGVyZWRGaWVsZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgcmVuZGVyZWRGaWVsZC5jbGFzc0xpc3QuYWRkKFwiZmllbGRcIik7XG4gICAgaWYgKGZpZWxkLnNoaXAgIT09IG51bGwpIHtcbiAgICAgIHJlbmRlcmVkRmllbGQuY2xhc3NMaXN0LmFkZChcInNoaXBcIik7XG4gICAgfVxuICAgIGlmIChmaWVsZC5zaGlwICE9PSBudWxsICYmIGJvYXJkRGlzcGxheSA9PT0gcGxheWVyVHdvRGlzcGxheSkge1xuICAgICAgICByZW5kZXJlZEZpZWxkLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICB9XG4gICAgaWYgKGZpZWxkLnNoaXAgIT09IG51bGwgJiYgZmllbGQuc2hpcC5pc1N1bmsoKSkge1xuICAgICAgcmVuZGVyZWRGaWVsZC5jbGFzc0xpc3QuYWRkKFwic3Vua1wiKTtcbiAgICB9XG4gICAgaWYgKGZpZWxkLmhpdCA9PT0gdHJ1ZSkge1xuICAgICAgcmVuZGVyZWRGaWVsZC5jbGFzc0xpc3QuYWRkKFwiaGl0XCIpO1xuICAgIH1cbiAgICByZW5kZXJlZEZpZWxkLmJvYXJkID0gZmllbGQuYm9hcmQ7XG4gICAgcmVuZGVyZWRGaWVsZC5maWVsZCA9IGZpZWxkO1xuXG4gICAgaWYgKCFmaWVsZHMuaW5jbHVkZXMoZmllbGQucG9zdGlvbikpIHtcbiAgICAgIGZpZWxkcy5wdXNoKGZpZWxkLnBvc2l0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAoZ2FtZU1vZGUgPT09IFwiaW5pdFwiKSB7XG4gICAgICByZW5kZXJlZEZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW92ZXJcIiwgaGlnaGxpZ2h0VGFyZ2V0RmllbGQpO1xuICAgICAgcmVuZGVyZWRGaWVsZC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIiwgdW5oaWdobGlnaHRUYXJnZXRGaWVsZHMpO1xuICAgICAgcmVuZGVyZWRGaWVsZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgcGxhY2VTaGlwKTtcbiAgICAgIHJlbmRlcmVkRmllbGQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNoYW5nZUdhbWVNb2RlKTtcbiAgICB9IGVsc2UgaWYgKGdhbWVNb2RlID09PSBcImdhbWVcIikge1xuICAgICAgcmVuZGVyZWRGaWVsZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgcGxheU9uQ2xpY2spO1xuICAgIH1cblxuICAgIGJvYXJkRGlzcGxheS5hcHBlbmRDaGlsZChyZW5kZXJlZEZpZWxkKTtcblxuICAgIHJldHVybiByZW5kZXJlZEZpZWxkO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVuZGVyR2FtZWJvYXJkKGJvYXJkLCBib2FyZERpc3BsYXkpIHtcbiAgICBib2FyZERpc3BsYXkuaW5uZXJIVE1MID0gXCJcIjtcblxuICAgIGJvYXJkLmZvckVhY2goKHJvdykgPT4ge1xuICAgICAgcm93LmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICAgIHJlbmRlckZpZWxkKGZpZWxkLCBib2FyZERpc3BsYXkpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiByZW5kZXJHYW1lYm9hcmRzKHBsYXllck9uZUdhbWVib2FyZCwgcGxheWVyVHdvR2FtZWJvYXJkKSB7XG4gICAgcmVuZGVyR2FtZWJvYXJkKHBsYXllck9uZUdhbWVib2FyZCwgcGxheWVyT25lRGlzcGxheSk7XG4gICAgcmVuZGVyR2FtZWJvYXJkKHBsYXllclR3b0dhbWVib2FyZCwgcGxheWVyVHdvRGlzcGxheSk7XG4gIH1cblxuICBmdW5jdGlvbiBwbGF5T25DbGljayhlKSB7XG4gICAgLy8gSWYgY2xpY2tlZCBmaWVsZCBpcyBub3Qgb24gZW5lbXkgYm9hcmQgb3IgaXQgaXMgbm90IGh1bWFuIHBsYXllciB0dXJuOiByZXR1cm5cbiAgICBpZiAoZS50YXJnZXQucGFyZW50RWxlbWVudCAhPT0gcGxheWVyVHdvRGlzcGxheSkgcmV0dXJuO1xuICAgIGlmIChwbGF5ZXJPbmUuZ2V0UGxheWVyc1R1cm4oKSAhPT0gdHJ1ZSkgcmV0dXJuO1xuICAgIGlmIChlLnRhcmdldC5maWVsZC5oaXQgPT09IHRydWUpIHJldHVybjtcblxuICAgIGNvbnN0IHggPSBlLnRhcmdldC5maWVsZC5wb3NpdGlvblswXTtcbiAgICBjb25zdCB5ID0gZS50YXJnZXQuZmllbGQucG9zaXRpb25bMV07XG5cbiAgICBnYW1lQ29udHJvbGxlci5wbGF5KHgsIHkpO1xuXG4gICAgLy8gVGhpcyBnYW1lIGVuZGluZyBjb25kaXRpb24gaXMgYWxzbyBwcmVzZW50IGluIGdhbWUuanNcbiAgICBpZiAoZ2FtZUNvbnRyb2xsZXIuaXNHYW1lRmluaXNoZWQoKSkge1xuICAgICAgY29uc3QgcGxheWVyT25lR2FtZWJvYXJkID0gZ2FtZUNvbnRyb2xsZXIuZ2V0UGxheWVyT25lR2FtZWJvYXJkKCk7XG4gICAgICBjb25zdCBwbGF5ZXJUd29HYW1lYm9hcmQgPSBnYW1lQ29udHJvbGxlci5nZXRQbGF5ZXJUd29HYW1lYm9hcmQoKTtcbiAgICAgIHJlbmRlckdhbWVib2FyZHMoXG4gICAgICAgIHBsYXllck9uZUdhbWVib2FyZC5nZXRCb2FyZCgpLFxuICAgICAgICBwbGF5ZXJUd29HYW1lYm9hcmQuZ2V0Qm9hcmQoKSxcbiAgICAgICk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHJlbmRlckdhbWVib2FyZChlLnRhcmdldC5wYXJlbnRFbGVtZW50LmJvYXJkLCBlLnRhcmdldC5wYXJlbnRFbGVtZW50KTtcblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgZ2FtZUNvbnRyb2xsZXIucGxheSgpO1xuICAgICAgcmVuZGVyR2FtZWJvYXJkKHBsYXllck9uZUdhbWVib2FyZC5nZXRCb2FyZCgpLCBwbGF5ZXJPbmVEaXNwbGF5KTtcbiAgICB9LCBcIjE1MDBcIik7XG4gIH1cblxuICAvLyBTdGFydC9FbmQgR2FtZSBQb3B1cHNcblxuICBmdW5jdGlvbiBjcmVhdGVFbmRHYW1lUG9wdXAod2lubmVyKSB7XG4gICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJlbmQtZ2FtZVwiKTtcbiAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxcIik7XG5cbiAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XG4gICAgdGV4dC5jbGFzc0xpc3QuYWRkKFwiZW5kLWdhbWUtdGV4dFwiKTtcbiAgICB0ZXh0LnRleHRDb250ZW50ID0gYCR7d2lubmVyfSBXb25gO1xuXG4gICAgY29uc3QgbmV3R2FtZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgbmV3R2FtZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwibmV3LWdhbWUtYnV0dG9uXCIpO1xuICAgIG5ld0dhbWVCdXR0b24udGV4dENvbnRlbnQgPSBcIk5ldyBHYW1lXCI7XG5cbiAgICBtYWluLmFwcGVuZENoaWxkKG1vZGFsKTtcbiAgICBtb2RhbC5hcHBlbmRDaGlsZCh0ZXh0KTtcbiAgICBtb2RhbC5hcHBlbmRDaGlsZChuZXdHYW1lQnV0dG9uKTtcblxuICAgIG5ld0dhbWVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgcmVzZXREaXNwbGF5KClcbiAgICAgICAgc3dpdGNoUG9zaXRpb25CdXR0b24uY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJylcbiAgICB9KVxuICB9XG5cbiAgZnVuY3Rpb24gY3JlYXRlU3RhcnRHYW1lUG9wdXAoKSB7XG4gICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJzdGFydC1nYW1lXCIpO1xuICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbFwiKTtcblxuICAgIGNvbnN0IHN0YXJ0R2FtZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgc3RhcnRHYW1lQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJzdGFydC1nYW1lLWJ1dHRvblwiKTtcbiAgICBzdGFydEdhbWVCdXR0b24udGV4dENvbnRlbnQgPSBcIlN0YXJ0IEdhbWVcIjtcblxuICAgIG1haW4uYXBwZW5kQ2hpbGQobW9kYWwpO1xuICAgIG1vZGFsLmFwcGVuZENoaWxkKHN0YXJ0R2FtZUJ1dHRvbik7XG5cbiAgICBzdGFydEdhbWVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIG1haW4ucmVtb3ZlQ2hpbGQobW9kYWwpO1xuICAgICAgZ2FtZUNvbnRyb2xsZXIuc3RhcnRHYW1lKCk7XG4gICAgICBzd2l0Y2hQb3NpdGlvbkJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nKVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVtb3ZlRmllbGRzRXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgY29uc3QgZGlzcGxheWVkRmllbGRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5maWVsZFwiKTtcblxuICAgIGRpc3BsYXllZEZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgZmllbGQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHBsYXlPbkNsaWNrKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlc2V0RGlzcGxheSgpIHtcbiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxcIik7XG5cbiAgICBtYWluLnJlbW92ZUNoaWxkKG1vZGFsKTtcbiAgICBnYW1lTW9kZSA9IFwiaW5pdFwiO1xuICAgIHNoaXBMZW5ndGggPSAxO1xuICAgIGdhbWVDb250cm9sbGVyLmluaXRHYW1lYm9hcmRzKCk7XG4gIH1cblxuICAvLyBTSElQIFBMQUNJTkcgTE9HSUNcblxuICBmdW5jdGlvbiBzaG93VGFyZ2V0RmllbGRzKGUpIHtcbiAgICBwbGF5ZXJPbmVHYW1lYm9hcmQgPSBnYW1lQ29udHJvbGxlci5nZXRQbGF5ZXJPbmVHYW1lYm9hcmQoKTtcblxuICAgIHBsYXllck9uZURpc3BsYXkuYm9hcmRPYmplY3QgPSBwbGF5ZXJPbmVHYW1lYm9hcmQ7XG4gICAgaWYgKHNoaXBMZW5ndGggPiA1KSByZXR1cm47XG4gICAgaWYgKGUudGFyZ2V0LnBhcmVudEVsZW1lbnQuYm9hcmRPYmplY3QgIT09IHBsYXllck9uZUdhbWVib2FyZCkge1xuXG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHJlbmRlcmVkRmllbGRzID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmZpZWxkXCIpKTtcblxuICAgIHggPSBlLnRhcmdldC5maWVsZC5wb3NpdGlvblswXTtcbiAgICB5ID0gZS50YXJnZXQuZmllbGQucG9zaXRpb25bMV07XG4gICAgLy8gY29uc3QgYm9hcmQgPSBlLnRhcmdldC5wYXJlbnRFbGVtZW50LmJvYXJkO1xuICAgIGNvbnN0IGJvYXJkID0gcGxheWVyT25lR2FtZWJvYXJkLmdldEJvYXJkKCk7XG4gICAgY29uc3QgdGFyZ2V0RmllbGRzID0gZ2FtZWJvYXJkQ29udHJvbGxlci5maW5kVGFyZ2V0RmllbGRzKFxuICAgICAgc2hpcExlbmd0aCxcbiAgICAgIHgsXG4gICAgICB5LFxuICAgICAgcG9zaXRpb24sXG4gICAgICBib2FyZCxcbiAgICApO1xuICAgIGxldCB0YXJnZXRGaWVsZHNQb3NpdGlvbnM7XG4gICAgbGV0IGRpc3BsYXllZFRhcmdldEZpZWxkcztcbiAgICBpZiAodGFyZ2V0RmllbGRzICE9PSBmYWxzZSkge1xuICAgICAgdGFyZ2V0RmllbGRzUG9zaXRpb25zID0gdGFyZ2V0RmllbGRzLm1hcCgoZmllbGQpID0+IGZpZWxkLnBvc2l0aW9uKTtcbiAgICAgIGRpc3BsYXllZFRhcmdldEZpZWxkcyA9IHJlbmRlcmVkRmllbGRzLmZpbHRlcihcbiAgICAgICAgKGZpZWxkKSA9PlxuICAgICAgICAgIHRhcmdldEZpZWxkc1Bvc2l0aW9ucy5pbmNsdWRlcyhmaWVsZC5maWVsZC5wb3NpdGlvbikgPT09IHRydWUsXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoZGlzcGxheWVkVGFyZ2V0RmllbGRzKSB7XG4gICAgICByZXR1cm4gZGlzcGxheWVkVGFyZ2V0RmllbGRzO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGhpZ2hsaWdodFRhcmdldEZpZWxkKGUpIHtcbiAgICBjb25zdCB0YXJnZXRGaWVsZHMgPSBzaG93VGFyZ2V0RmllbGRzKGUpO1xuICAgIGlmICh0YXJnZXRGaWVsZHMpIHtcbiAgICAgIHRhcmdldEZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4gZmllbGQuY2xhc3NMaXN0LmFkZChcImFjdGl2ZVwiKSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gdW5oaWdobGlnaHRUYXJnZXRGaWVsZHMoZSkge1xuICAgIGNvbnN0IHRhcmdldEZpZWxkcyA9IHNob3dUYXJnZXRGaWVsZHMoZSk7XG4gICAgaWYgKHRhcmdldEZpZWxkcykge1xuICAgICAgdGFyZ2V0RmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiBmaWVsZC5jbGFzc0xpc3QucmVtb3ZlKFwiYWN0aXZlXCIpKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBwbGFjZVNoaXAoZSkge1xuICAgIGlmIChzaGlwTGVuZ3RoID4gNSB8fCBlLnRhcmdldC5wYXJlbnRFbGVtZW50ID09PSBwbGF5ZXJUd29EaXNwbGF5KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGJvYXJkT2JqZWN0ID0gcGxheWVyT25lR2FtZWJvYXJkO1xuICAgIGNvbnN0IGJvYXJkID0gcGxheWVyT25lR2FtZWJvYXJkLmdldEJvYXJkKCk7XG4gICAgY29uc3QgZGlzcGxheWVkQm9hcmQgPSBwbGF5ZXJPbmVEaXNwbGF5O1xuXG4gICAgY29uc3Qgc2hpcCA9IGJvYXJkT2JqZWN0LnBsYWNlU2hpcChzaGlwTGVuZ3RoLCB4LCB5LCBwb3NpdGlvbik7XG4gICAgaWYgKHNoaXAgIT09IGZhbHNlKSB7XG4gICAgICByZW5kZXJHYW1lYm9hcmQoYm9hcmQsIGRpc3BsYXllZEJvYXJkKTtcbiAgICAgIHNoaXBMZW5ndGggKz0gMTtcbiAgICB9XG4gICAgaWYgKHNoaXBMZW5ndGggPiA1KSBjcmVhdGVTdGFydEdhbWVQb3B1cCgpO1xuICB9XG5cbiAgZnVuY3Rpb24gY2hhbmdlR2FtZU1vZGUoKSB7XG4gICAgY29uc3QgcGxheWVyT25lR2FtZWJvYXJkID0gZ2FtZUNvbnRyb2xsZXIuZ2V0UGxheWVyT25lR2FtZWJvYXJkKCk7XG4gICAgY29uc3QgcGxheWVyVHdvR2FtZWJvYXJkID0gZ2FtZUNvbnRyb2xsZXIuZ2V0UGxheWVyVHdvR2FtZWJvYXJkKCk7XG4gICAgaWYgKHNoaXBMZW5ndGggPiA1KSBnYW1lTW9kZSA9IFwiZ2FtZVwiO1xuICAgIGlmIChzaGlwTGVuZ3RoIDwgNSkgZ2FtZU1vZGUgPSBcImluaXRcIjtcbiAgICByZW5kZXJHYW1lYm9hcmRzKFxuICAgICAgcGxheWVyT25lR2FtZWJvYXJkLmdldEJvYXJkKCksXG4gICAgICBwbGF5ZXJUd29HYW1lYm9hcmQuZ2V0Qm9hcmQoKSxcbiAgICApO1xuICB9XG5cbiAgZnVuY3Rpb24gc3dpdGNoUG9zaXRpb24oKSB7XG4gICAgc3dpdGNoIChwb3NpdGlvbikge1xuICAgICAgY2FzZSBcInZlcnRpY2FsXCI6XG4gICAgICAgIHBvc2l0aW9uID0gXCJob3Jpem9udGFsXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImhvcml6b250YWxcIjpcbiAgICAgICAgcG9zaXRpb24gPSBcInZlcnRpY2FsXCI7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHN3aXRjaFBvc2l0aW9uQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBzd2l0Y2hQb3NpdGlvbik7XG5cbiAgcmV0dXJuIHtcbiAgICByZW5kZXJHYW1lYm9hcmRzLFxuICAgIGNyZWF0ZUVuZEdhbWVQb3B1cCxcbiAgICByZW1vdmVGaWVsZHNFdmVudExpc3RlbmVycyxcbiAgICBwbGF5ZXJPbmVEaXNwbGF5LFxuICAgIHBsYXllclR3b0Rpc3BsYXksXG4gIH07XG59XG4iLCJpbXBvcnQgeyBnYW1lIH0gZnJvbSBcIi4vZ2FtZS5qc1wiO1xuaW1wb3J0IHsgZmluZEFkamFjZW50RmllbGRPbkF4aXMgfSBmcm9tIFwiLi9haS5qc1wiO1xuXG5cbmNvbnN0IGdhbWVDb250cm9sbGVyID0gZ2FtZSgpXG5cblxuZ2FtZUNvbnRyb2xsZXIuaW5pdEdhbWVib2FyZHMoKVxuY29uc3QgYm9hcmRPYmplY3QgPSBnYW1lQ29udHJvbGxlci5nZXRQbGF5ZXJPbmVHYW1lYm9hcmQoKVxuY29uc3QgcGxheWVyT25lQm9hcmQgPSBnYW1lQ29udHJvbGxlci5nZXRQbGF5ZXJPbmVHYW1lYm9hcmQoKS5nZXRCb2FyZCgpXG5jb25zb2xlLmxvZyhib2FyZE9iamVjdC5nZXRCb2FyZCgpKVxuLy8gY29uc29sZS5sb2cocGxheWVyT25lQm9hcmQpXG5ib2FyZE9iamVjdC5wcmludEJvYXJkKClcbmNvbnNvbGUubG9nKGZpbmRBZGphY2VudEZpZWxkT25BeGlzKHBsYXllck9uZUJvYXJkWzZdWzddLCBwbGF5ZXJPbmVCb2FyZFs1XVs3XSwgYm9hcmRPYmplY3QpKVxuXG5cbndpbmRvdy5zdGFydEdhbWUgPSBnYW1lQ29udHJvbGxlci5zdGFydEdhbWVcbndpbmRvdy5lbmRHYW1lID0gZ2FtZUNvbnRyb2xsZXIuZW5kR2FtZVxuLy8gZ2FtZUNvbnRyb2xsZXIuc3RhcnRHYW1lKClcblxuIl0sIm5hbWVzIjpbInNoaXBGYWN0b3J5IiwibGVuZ3RoIiwibnVtYmVyT2ZIaXRzIiwiZ2V0TGVuZ3RoIiwiaGl0IiwiaXNTdW5rIiwiZ2V0TnVtYmVyT2ZIaXRzIiwic2hpcCIsImNvbnNvbGUiLCJsb2ciLCJnYW1lYm9hcmRGYWN0b3J5IiwiYm9hcmQiLCJnZXRCb2FyZCIsImNyZWF0ZUZpZWxkIiwieCIsInkiLCJwb3NpdGlvbiIsIm9jY3VwaWVkQnlTaGlwIiwiZmluZE5laWdoYm91ckZpZWxkcyIsInRhcmdldEZpZWxkcyIsImR1cGxpY2F0ZWROZWlnaGJvdXJzIiwibmVpZ2hib3VycyIsInBvc3NiaWxlTmVpZ2hib3VycyIsImZvckVhY2giLCJmaWVsZCIsImNvb3JkaW5hdGUiLCJpc091dE9mQm91bmQiLCJwdXNoIiwiZmlsdGVyIiwibmVpZ2hib3VyIiwiaW5jbHVkZXMiLCJmaW5kVGFyZ2V0RmllbGRzIiwic2hpcExlbmd0aCIsImRpcmVjdGlvbiIsImkiLCJjaGVja0lmRmllbGRPY2N1cGllZCIsImNhblNoaXBCZVBsYWNlZCIsIm5laWdoYm91ckZpZWxkcyIsInNvbWUiLCJwbGFjZVNoaXAiLCJpbml0R2FtZWJvYXJkIiwiYXJyIiwiaiIsInByaW50Qm9hcmQiLCJyb3ciLCJzdHJpbmciLCJyZWNlaXZlQXR0YWNrIiwiYXJlQWxsU2hpcHNTdW5rIiwiZmllbGRzT2NjdXBpZWRCeVNoaXBzIiwib2NjdXBpZWQiLCJldmVyeSIsInBsYWNlU2hpcHNSYW5kb21seSIsImFtb3VudCIsInBsYWNlZFNoaXBzIiwiY3VycmVudFNoaXBMZW5naHQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJoaXRlZFNoaXAiLCJoaXRlZEZpZWxkIiwidGVtcEhpdGVkRmllbGQiLCJoaXRzIiwiaXNNb3ZlTGVnYWwiLCJmaW5kUmFuZG9tTW92ZSIsImZpbmRBZGphY2VudEZpZWxkT25BeGlzIiwiZmllbGRPbmUiLCJmaWVsZFR3byIsImEiLCJiIiwicG9zc2libGVGaWVsZHMiLCJheGlzIiwidGFyZ2V0RmllbGRPbmUiLCJ0YXJnZXRGaWVsZFR3byIsInBsYXllciIsImFpIiwiaXNJdFBsYXllcnNUdXJuIiwiaXNBaSIsInBsYXllcnNUdXJuIiwiY2hhbmdlUGxheWVyc1R1cm4iLCJzZWNvbmRQbGF5ZXIiLCJzZWNvbmRQbGF5ZXJUdXJuIiwiZ2V0UGxheWVyc1R1cm4iLCJzZXRQbGF5ZXJzVHVybiIsImF0dGFjayIsImF0dGFja2VkUGxheWVyIiwidW5kZWZpbmVkIiwiYWRqYWNlbnRGaWVsZHMiLCJmaW5kRm91ckFkamFjZW50RmllbGRzIiwicmFuZG9tTW92ZSIsIm5ld0hpdGVkRmllbGQiLCJhaUF0dGFjayIsInZhbHVlIiwicGxheWVyT25lR2FtZWJvYXJkIiwicGxheWVyVHdvR2FtZWJvYXJkIiwiZ2V0UGxheWVyT25lR2FtZWJvYXJkIiwiZ2V0UGxheWVyVHdvR2FtZWJvYXJkIiwicGxheWVyT25lIiwicGxheWVyVHdvIiwiZG9tIiwiZ2FtZWJvYXJkQ29udHJvbGxlciIsImdhbWVDb250cm9sbGVyIiwiZ2FtZSIsIm1haW4iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJwbGF5ZXJPbmVEaXNwbGF5IiwicGxheWVyVHdvRGlzcGxheSIsInN3aXRjaFBvc2l0aW9uQnV0dG9uIiwiZmllbGRzIiwiZ2FtZU1vZGUiLCJyZW5kZXJHYW1lYm9hcmQiLCJib2FyZERpc3BsYXkiLCJpbm5lckhUTUwiLCJyZW5kZXJlZEZpZWxkIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInBvc3Rpb24iLCJhZGRFdmVudExpc3RlbmVyIiwiaGlnaGxpZ2h0VGFyZ2V0RmllbGQiLCJ1bmhpZ2hsaWdodFRhcmdldEZpZWxkcyIsImNoYW5nZUdhbWVNb2RlIiwicGxheU9uQ2xpY2siLCJhcHBlbmRDaGlsZCIsInJlbmRlckZpZWxkIiwicmVuZGVyR2FtZWJvYXJkcyIsImUiLCJ0YXJnZXQiLCJwYXJlbnRFbGVtZW50IiwicGxheSIsImlzR2FtZUZpbmlzaGVkIiwic2V0VGltZW91dCIsInNob3dUYXJnZXRGaWVsZHMiLCJib2FyZE9iamVjdCIsInJlbmRlcmVkRmllbGRzIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsInRhcmdldEZpZWxkc1Bvc2l0aW9ucyIsImRpc3BsYXllZFRhcmdldEZpZWxkcyIsIm1hcCIsInJlbW92ZSIsImRpc3BsYXllZEJvYXJkIiwibW9kYWwiLCJzdGFydEdhbWVCdXR0b24iLCJ0ZXh0Q29udGVudCIsInJlbW92ZUNoaWxkIiwic3RhcnRHYW1lIiwidG9nZ2xlIiwiY3JlYXRlU3RhcnRHYW1lUG9wdXAiLCJjcmVhdGVFbmRHYW1lUG9wdXAiLCJ3aW5uZXIiLCJ0ZXh0IiwibmV3R2FtZUJ1dHRvbiIsImluaXRHYW1lYm9hcmRzIiwicmVzZXREaXNwbGF5IiwicmVtb3ZlRmllbGRzRXZlbnRMaXN0ZW5lcnMiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZG9tQ29udHJvbGxlciIsImVuZEdhbWUiLCJwbGF5ZXJPbmVUdXJuIiwicGxheWVyVHdvVHVybiIsInBsYXllck9uZUJvYXJkIiwid2luZG93Il0sInNvdXJjZVJvb3QiOiIifQ==