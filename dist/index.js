(()=>{"use strict";const t=t=>{let e=0;return{getLength:()=>t,hit:()=>(e+=1,e),isSunk:()=>e===t,getNumberOfHits:()=>e}},e=t(1);e.hit(),console.log(e.getLength());const n=()=>{const e=[],n=()=>e;function o(t,e){return{position:[t,e],occupiedByShip:!1,hit:!1,ship:null,board:n()}}function i(t){if(!t)return!1;const e=n();let o=[];const i=[],r=[];return t.forEach((t=>{const n=t.position[0],o=t.position[1];[[n-1,o-1],[n-1,o],[n-1,o+1],[n,o+1],[n+1,o+1],[n+1,o],[n+1,o-1],[n,o-1]].forEach((t=>{!1===a(t[0],t[1])&&r.push(e[t[0]][t[1]])}))})),o=r.filter((e=>!1===t.includes(e))),o.forEach((t=>{i.includes(t)||i.push(t)})),i}function r(t,e,n,o,i){const r=[];for(let s=0;s<t;s++)if("horizontal"===o){if(a(e,n+s))return!1;r.push(i[e][n+s])}else if("vertical"===o){if(a(e+s,n))return!1;r.push(i[e+s][n])}return r}function a(t,e){return t<0||t>9||e<0||e>9}function s(t){return!0===t.occupiedByShip}function c(t,e){return!!t&&!t.some(s)&&!e.some(s)}function l(e,o,a,s="horizontal"){const l=r(e,o,a,s,n());if(!c(l,i(l)))return!1;const d=t(e);return l.forEach((t=>{t.occupiedByShip=!0,t.ship=d})),d}return{createField:o,initGameboard:function(){for(let t=0;t<10;t++){const n=[];for(let e=0;e<10;e++)n.push(o(t,e));e.push(n)}},printBoard:function(){e.forEach((t=>{let e="";t.forEach((t=>{t.occupiedByShip||t.hit?!t.occupiedByShip&&t.hit?e+="|  -  |":t.occupiedByShip&&!t.hit?e+="|  O  |":t.occupiedByShip&&t.hit&&(e+="|  X  |"):e+=`| ${t.position} |`})),console.log(e)}))},getBoard:n,findTargetFields:r,findNeighbourFields:i,canShipBePlaced:c,placeShip:l,receiveAttack:function(t,n){return!a(t,n)&&!e[t][n].hit&&(null!==e[t][n].ship&&e[t][n].ship.hit(),e[t][n].hit=!0,e[t][n])},areAllShipsSunk:function(){const t=[];return e.forEach((e=>{const n=e.filter((t=>!0===t.occupiedByShip));t.push(...n)})),!!t.every((t=>!0===t.hit))},placeShipsRandomly:function(t){const e=[];let n=1;for(;e.length!==t;){const t=Math.floor(10*Math.random()),o=Math.floor(10*Math.random());let i;switch(Math.floor(2*Math.random())){case 1:i="vertical";break;case 0:i="horizontal"}const r=l(n,t,o,i);!1!==r&&(e.push(r),n++)}}}};let o,i,r,a=0;function s(t,e,n){return!(t>9||t<0||e<0||e>9)&&!0!==n[t][e].hit}function c(){return[Math.floor(10*Math.random()),Math.floor(10*Math.random())]}const l=(t,e)=>{const n=t;let l=e;function d(t){const e=t.getPlayersTurn();switch(l){case!0:l=!1;break;case!1:l=!0}switch(e){case!0:t.setPlayersTurn(!1);break;case!1:t.setPlayersTurn(!0)}}return{attack:function(t,e,l,u){if(d(e),!n)return t.receiveAttack(l,u);!function(t){if(void 0!==o&&!0===o.isSunk()&&(a=0,o=void 0),1===a){const e=function(t,e){const n=t.position[0],o=t.position[1],i=[[n,o+1],[n,o-1],[n+1,o],[n-1,o]].filter((t=>s(t[0],t[1],e.getBoard())));return i}(i,t),n=e[Math.floor(Math.random()*e.length)];return r=t.receiveAttack(...n),void(null!==r.ship&&(a+=1,console.log(r)))}if(a>1){if(r.position[0]>i.position[0]||r[1]>i[1]){let t=i;i=r,r=t}const e=function(t,e,n){let o=t.position[0],i=t.position[1],r=e.position[0],a=e.position[1];const c=[];let l;if(o===r?l="horizontal":i===a&&(l="vertical"),"horizontal"===l){i>a&&(o=e.position[0],i=e.position[1],r=t.position[0],a=t.position[1]);const n=[o,i-1],s=[r,a+1];c.push(n,s)}else if("vertical"===l){o>r&&(o=e.position[0],i=e.position[1],r=t.position[0],a=t.position[1]);const n=[o-1,i],s=[r+1,a];c.push(n,s)}return c.filter((t=>s(t[0],t[1],n.getBoard())))}(i,r,t);console.log(e,"target fields"),console.log(i.position,"hited field"),console.log(r.position,"temp hited field");const n=Math.floor(Math.random()*e.length);console.log(n,"random num");const o=e[n];console.log(o,"random move");const c=t.receiveAttack(...o);return console.log(c.position,"new hited field"),console.log(i.position,"hited field"),console.log(r.position,"temp hited field"),void(null!==c.ship&&c.position[0]<i.position[0]||c.position[1]<i.position[1]?(r=c,a+=1):null!==c.ship&&(c.position[0]>i.position[0]||c.position[1]>i.position[1])&&(i=c,a+=1))}let e=c();for(;!1===s(e[0],e[1],t.getBoard());)e=c();i=t.receiveAttack(...e),null!==i.ship&&(o=i.ship,a+=1)}(t)},getPlayersTurn:()=>l,setPlayersTurn:t=>{l=t},isMoveLegal:function(t,e,n){return!0!==n[t][e].hit},changePlayersTurn:d,findRandomMove:function(){return[Math.floor(10*Math.random()),Math.floor(10*Math.random())]}}};let d,u;const p=()=>d,h=()=>u,f=l(!1,!0),m=l(!0,!1),g=function(){const t=n(),e=y(),o=document.querySelector("main"),i=document.querySelector(".player-one-board"),r=document.querySelector(".player-two-board"),a=document.querySelector(".switch-position"),s=[];let c,l,d=e.getPlayerOneGameboard(),u="init",p=1,h="vertical";function m(t,e){e.innerHTML="",t.forEach((t=>{t.forEach((t=>{!function(t,e){const n=document.createElement("div");n.classList.add("field"),null!==t.ship&&n.classList.add("ship"),null!==t.ship&&e===r&&n.classList.add("hidden"),null!==t.ship&&t.ship.isSunk()&&n.classList.add("sunk"),!0===t.hit&&n.classList.add("hit"),n.board=t.board,n.field=t,s.includes(t.postion)||s.push(t.position),"init"===u?(n.addEventListener("mouseover",E),n.addEventListener("mouseout",S),n.addEventListener("click",L),n.addEventListener("click",k)):"game"===u&&n.addEventListener("click",v),e.appendChild(n)}(t,e)}))}))}function g(t,e){m(t,i),m(e,r)}function v(t){if(t.target.parentElement!==r)return;if(!0!==f.getPlayersTurn())return;if(!0===t.target.field.hit)return;const n=t.target.field.position[0],o=t.target.field.position[1];if(e.play(n,o),e.isGameFinished()){const t=e.getPlayerOneGameboard(),n=e.getPlayerTwoGameboard();g(t.getBoard(),n.getBoard())}else m(t.target.parentElement.board,t.target.parentElement),setTimeout((()=>{e.play(),m(d.getBoard(),i)}),"1500")}function b(n){if(d=e.getPlayerOneGameboard(),i.boardObject=d,p>5)return;if(n.target.parentElement.boardObject!==d)return;const o=Array.from(document.querySelectorAll(".field"));c=n.target.field.position[0],l=n.target.field.position[1];const r=d.getBoard(),a=t.findTargetFields(p,c,l,h,r);let s,u;return!1!==a&&(s=a.map((t=>t.position)),u=o.filter((t=>!0===s.includes(t.field.position)))),u||void 0}function E(t){const e=b(t);e&&e.forEach((t=>t.classList.add("active")))}function S(t){const e=b(t);e&&e.forEach((t=>t.classList.remove("active")))}function L(t){if(p>5||t.target.parentElement===r)return;const n=d,s=d.getBoard(),u=i;!1!==n.placeShip(p,c,l,h)&&(m(s,u),p+=1),p>5&&function(){const t=document.createElement("div");t.classList.add("start-game"),t.classList.add("modal");const n=document.createElement("button");n.classList.add("start-game-button"),n.textContent="Start Game",o.appendChild(t),t.appendChild(n),n.addEventListener("click",(()=>{o.removeChild(t),e.startGame(),a.classList.toggle("hidden")}))}()}function k(){const t=e.getPlayerOneGameboard(),n=e.getPlayerTwoGameboard();p>5&&(u="game"),p<5&&(u="init"),g(t.getBoard(),n.getBoard())}return a.addEventListener("click",(function(){switch(h){case"vertical":h="horizontal";break;case"horizontal":h="vertical"}})),{renderGameboards:g,createEndGamePopup:function(t){const n=document.createElement("div");n.classList.add("end-game"),n.classList.add("modal");const i=document.createElement("p");i.classList.add("end-game-text"),i.textContent=`${t} Won`;const r=document.createElement("button");r.classList.add("new-game-button"),r.textContent="New Game",o.appendChild(n),n.appendChild(i),n.appendChild(r),r.addEventListener("click",(()=>{!function(){const t=document.querySelector(".modal");o.removeChild(t),u="init",p=1,e.initGameboards()}(),a.classList.toggle("hidden")}))},removeFieldsEventListeners:function(){document.querySelectorAll(".field").forEach((t=>{t.removeEventListener("click",v)}))},playerOneDisplay:i,playerTwoDisplay:r}}();function y(){function t(){return!0===d.areAllShipsSunk()||!0===u.areAllShipsSunk()}function e(t){g.createEndGamePopup(t),g.removeFieldsEventListeners()}return{startGame:function(){f.setPlayersTurn(!0),m.setPlayersTurn(!1),u.placeShipsRandomly(5),g.renderGameboards(d.getBoard(),u.getBoard())},play:function(n,o){const i=f.getPlayersTurn(),r=m.getPlayersTurn();if(!0===i?f.attack(u,m,n,o):!0===r&&m.attack(d,f),t()){let t="";!0===d.areAllShipsSunk()&&(t="Player Two"),!0===u.areAllShipsSunk()&&(t="Player One"),e(t)}},endGame:e,isGameFinished:t,initGameboards:function(){const t=g.playerOneDisplay,e=g.playerTwoDisplay;d=n(),u=n(),d.initGameboard(),u.initGameboard(),t.board=d.getBoard(),e.board=u.getBoard(),g.renderGameboards(d.getBoard(),u.getBoard())},getPlayerOneGameboard:p,getPlayerTwoGameboard:h}}y().initGameboards()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dUJNLElBR1JxRCxnQiIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvc2hpcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2dhbWVib2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2FpLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvcGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2RvbS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgc2hpcEZhY3RvcnkgPSAobGVuZ3RoKSA9PiB7XG4gIFxuICBsZXQgbnVtYmVyT2ZIaXRzID0gMDtcblxuICBjb25zdCBnZXRMZW5ndGggPSAoKSA9PiBsZW5ndGg7XG4gIGNvbnN0IGdldE51bWJlck9mSGl0cyA9ICgpID0+IG51bWJlck9mSGl0c1xuXG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBudW1iZXJPZkhpdHMgKz0gMVxuICAgIHJldHVybiBudW1iZXJPZkhpdHNcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgaWYgKG51bWJlck9mSGl0cyA9PT0gbGVuZ3RoKSByZXR1cm4gdHJ1ZTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRMZW5ndGgsXG4gICAgaGl0LFxuICAgIGlzU3VuayxcbiAgICBnZXROdW1iZXJPZkhpdHNcbiAgfTtcbn07XG5cbmNvbnN0IHNoaXAgPSBzaGlwRmFjdG9yeSgxKTtcbnNoaXAuaGl0KCk7XG5cbmNvbnNvbGUubG9nKHNoaXAuZ2V0TGVuZ3RoKCkpO1xuZXhwb3J0IHsgc2hpcEZhY3RvcnkgfTtcbiIsImltcG9ydCB7IHNoaXBGYWN0b3J5IH0gZnJvbSBcIi4vc2hpcC5qc1wiO1xuXG5leHBvcnQgY29uc3QgZ2FtZWJvYXJkRmFjdG9yeSA9ICgpID0+IHtcbiAgY29uc3QgYm9hcmQgPSBbXTtcblxuICBjb25zdCBnZXRCb2FyZCA9ICgpID0+IGJvYXJkO1xuXG4gIGZ1bmN0aW9uIGNyZWF0ZUZpZWxkKHgsIHkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcG9zaXRpb246IFt4LCB5XSxcbiAgICAgIG9jY3VwaWVkQnlTaGlwOiBmYWxzZSxcbiAgICAgIGhpdDogZmFsc2UsXG4gICAgICBzaGlwOiBudWxsLFxuICAgICAgYm9hcmQ6IGdldEJvYXJkKCksXG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGluaXRHYW1lYm9hcmQoKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICBjb25zdCBhcnIgPSBbXTtcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGorKykge1xuICAgICAgICBhcnIucHVzaChjcmVhdGVGaWVsZChpLCBqKSk7XG4gICAgICB9XG4gICAgICBib2FyZC5wdXNoKGFycik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcHJpbnRCb2FyZCgpIHtcbiAgICBib2FyZC5mb3JFYWNoKChyb3cpID0+IHtcbiAgICAgIGxldCBzdHJpbmcgPSBcIlwiO1xuICAgICAgcm93LmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICAgIGlmICghZmllbGQub2NjdXBpZWRCeVNoaXAgJiYgIWZpZWxkLmhpdCkge1xuICAgICAgICAgIHN0cmluZyArPSBgfCAke2ZpZWxkLnBvc2l0aW9ufSB8YDtcbiAgICAgICAgfSBlbHNlIGlmICghZmllbGQub2NjdXBpZWRCeVNoaXAgJiYgZmllbGQuaGl0KSB7XG4gICAgICAgICAgc3RyaW5nICs9IGB8ICAtICB8YDtcbiAgICAgICAgfSBlbHNlIGlmIChmaWVsZC5vY2N1cGllZEJ5U2hpcCAmJiAhZmllbGQuaGl0KSB7XG4gICAgICAgICAgc3RyaW5nICs9IFwifCAgTyAgfFwiO1xuICAgICAgICB9IGVsc2UgaWYgKGZpZWxkLm9jY3VwaWVkQnlTaGlwICYmIGZpZWxkLmhpdCkge1xuICAgICAgICAgIHN0cmluZyArPSBcInwgIFggIHxcIjtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBjb25zb2xlLmxvZyhzdHJpbmcpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZmluZE5laWdoYm91ckZpZWxkcyh0YXJnZXRGaWVsZHMpIHtcbiAgICBpZiAoIXRhcmdldEZpZWxkcykgcmV0dXJuIGZhbHNlO1xuICAgIGNvbnN0IGJvYXJkID0gZ2V0Qm9hcmQoKTtcbiAgICBsZXQgZHVwbGljYXRlZE5laWdoYm91cnMgPSBbXTtcbiAgICBjb25zdCBuZWlnaGJvdXJzID0gW107XG4gICAgY29uc3QgcG9zc2JpbGVOZWlnaGJvdXJzID0gW107XG5cbiAgICB0YXJnZXRGaWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgIGNvbnN0IHggPSBmaWVsZC5wb3NpdGlvblswXTtcbiAgICAgIGNvbnN0IHkgPSBmaWVsZC5wb3NpdGlvblsxXTtcblxuICAgICAgLy8gYWxsIHRoZSBwb3NzaWJsZSBuZWlnaGJvdXIgZmllbGRzXG4gICAgICBjb25zdCBwb3NzaWJsZU5laWdoYm91cnNDb29yZGluYXRlcyA9IFtcbiAgICAgICAgW3ggLSAxLCB5IC0gMV0sXG4gICAgICAgIFt4IC0gMSwgeV0sXG4gICAgICAgIFt4IC0gMSwgeSArIDFdLFxuICAgICAgICBbeCwgeSArIDFdLFxuICAgICAgICBbeCArIDEsIHkgKyAxXSxcbiAgICAgICAgW3ggKyAxLCB5XSxcbiAgICAgICAgW3ggKyAxLCB5IC0gMV0sXG4gICAgICAgIFt4LCB5IC0gMV0sXG4gICAgICBdO1xuXG4gICAgICAvLyBwdXNoIHRoZSBuZWlnaGJvdXIgZmllbGRzIHRoYXQgYXJlIG5vdCBvdXQgb2YgYm91bmRzXG4gICAgICBwb3NzaWJsZU5laWdoYm91cnNDb29yZGluYXRlcy5mb3JFYWNoKChjb29yZGluYXRlKSA9PiB7XG4gICAgICAgIGlmIChpc091dE9mQm91bmQoY29vcmRpbmF0ZVswXSwgY29vcmRpbmF0ZVsxXSkgPT09IGZhbHNlKVxuICAgICAgICAgIHBvc3NiaWxlTmVpZ2hib3Vycy5wdXNoKGJvYXJkW2Nvb3JkaW5hdGVbMF1dW2Nvb3JkaW5hdGVbMV1dKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gYWRkIG9ubHkgbmVpZ2hib3VycyB0aGF0IGFyZSBub3QgaW5jbHVkZWQgaW4gdGhlIHRhcmdldCBmaWVsZHMgYXJyYXlcblxuICAgIGR1cGxpY2F0ZWROZWlnaGJvdXJzID0gcG9zc2JpbGVOZWlnaGJvdXJzLmZpbHRlcihcbiAgICAgIChuZWlnaGJvdXIpID0+IHRhcmdldEZpZWxkcy5pbmNsdWRlcyhuZWlnaGJvdXIpID09PSBmYWxzZSxcbiAgICApO1xuXG4gICAgZHVwbGljYXRlZE5laWdoYm91cnMuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgIGlmICghbmVpZ2hib3Vycy5pbmNsdWRlcyhmaWVsZCkpIG5laWdoYm91cnMucHVzaChmaWVsZCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbmVpZ2hib3VycztcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmRUYXJnZXRGaWVsZHMoc2hpcExlbmd0aCwgeCwgeSwgZGlyZWN0aW9uLCBib2FyZCkge1xuICAgIGNvbnN0IHRhcmdldEZpZWxkcyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoZGlyZWN0aW9uID09PSBcImhvcml6b250YWxcIikge1xuICAgICAgICBpZiAoaXNPdXRPZkJvdW5kKHgsIHkgKyBpKSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0YXJnZXRGaWVsZHMucHVzaChib2FyZFt4XVt5ICsgaV0pO1xuICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09IFwidmVydGljYWxcIikge1xuICAgICAgICBpZiAoaXNPdXRPZkJvdW5kKHggKyBpLCB5KSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0YXJnZXRGaWVsZHMucHVzaChib2FyZFt4ICsgaV1beV0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGFyZ2V0RmllbGRzO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNPdXRPZkJvdW5kKHgsIHkpIHtcbiAgICBpZiAoeCA8IDAgfHwgeCA+IDkgfHwgeSA8IDAgfHwgeSA+IDkpIHJldHVybiB0cnVlO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNoZWNrSWZGaWVsZE9jY3VwaWVkKGZpZWxkKSB7XG4gICAgcmV0dXJuIGZpZWxkLm9jY3VwaWVkQnlTaGlwID09PSB0cnVlO1xuICB9XG5cbiAgZnVuY3Rpb24gY2FuU2hpcEJlUGxhY2VkKHRhcmdldEZpZWxkcywgbmVpZ2hib3VyRmllbGRzKSB7XG4gICAgaWYgKCF0YXJnZXRGaWVsZHMpIHJldHVybiBmYWxzZTtcblxuICAgIC8vIGlmIGZpZWxkcyBhcmUgYWxyZWFkeSBvY2N1cGllZCwgb3IgbmVpZ2hib3VyIGZpZWxkcyBhcmUgb2NjdXBpZWQsIHJldHVybiBmYWxzZVxuICAgIGlmIChcbiAgICAgIHRhcmdldEZpZWxkcy5zb21lKGNoZWNrSWZGaWVsZE9jY3VwaWVkKSB8fFxuICAgICAgbmVpZ2hib3VyRmllbGRzLnNvbWUoY2hlY2tJZkZpZWxkT2NjdXBpZWQpXG4gICAgKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBmdW5jdGlvbiBwbGFjZVNoaXAoc2hpcExlbmd0aCwgeCwgeSwgZGlyZWN0aW9uID0gXCJob3Jpem9udGFsXCIpIHtcbiAgICBjb25zdCBib2FyZCA9IGdldEJvYXJkKCk7XG4gICAgY29uc3QgdGFyZ2V0RmllbGRzID0gZmluZFRhcmdldEZpZWxkcyhzaGlwTGVuZ3RoLCB4LCB5LCBkaXJlY3Rpb24sIGJvYXJkKTtcbiAgICBjb25zdCBuZWlnaGJvdXJGaWVsZHMgPSBmaW5kTmVpZ2hib3VyRmllbGRzKHRhcmdldEZpZWxkcyk7XG4gICAgaWYgKCFjYW5TaGlwQmVQbGFjZWQodGFyZ2V0RmllbGRzLCBuZWlnaGJvdXJGaWVsZHMpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IHNoaXAgPSBzaGlwRmFjdG9yeShzaGlwTGVuZ3RoKTtcblxuICAgIHRhcmdldEZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgZmllbGQub2NjdXBpZWRCeVNoaXAgPSB0cnVlO1xuICAgICAgZmllbGQuc2hpcCA9IHNoaXA7XG4gICAgfSk7XG4gICAgcmV0dXJuIHNoaXA7XG4gIH1cblxuICBmdW5jdGlvbiBwbGFjZVNoaXBzUmFuZG9tbHkoYW1vdW50KSB7XG4gICAgY29uc3QgcGxhY2VkU2hpcHMgPSBbXTtcbiAgICBsZXQgY3VycmVudFNoaXBMZW5naHQgPSAxO1xuICAgIHdoaWxlIChwbGFjZWRTaGlwcy5sZW5ndGggIT09IGFtb3VudCkge1xuICAgICAgY29uc3QgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICBjb25zdCByYW5kb21EaXJlY3Rpb24gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKTtcbiAgICAgIGxldCBkaXJlY3Rpb247XG5cbiAgICAgIHN3aXRjaCAocmFuZG9tRGlyZWN0aW9uKSB7XG4gICAgICAgIGNhc2UgMTpcbiAgICAgICAgICBkaXJlY3Rpb24gPSBcInZlcnRpY2FsXCI7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMDpcbiAgICAgICAgICBkaXJlY3Rpb24gPSBcImhvcml6b250YWxcIjtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc2hpcCA9IHBsYWNlU2hpcChjdXJyZW50U2hpcExlbmdodCwgeCwgeSwgZGlyZWN0aW9uKTtcblxuICAgICAgaWYgKHNoaXAgIT09IGZhbHNlKSB7XG4gICAgICAgIHBsYWNlZFNoaXBzLnB1c2goc2hpcCk7XG4gICAgICAgIGN1cnJlbnRTaGlwTGVuZ2h0Kys7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcmVjZWl2ZUF0dGFjayh4LCB5KSB7XG4gICAgaWYgKGlzT3V0T2ZCb3VuZCh4LCB5KSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmIChib2FyZFt4XVt5XS5oaXQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoYm9hcmRbeF1beV0uc2hpcCAhPT0gbnVsbCkgYm9hcmRbeF1beV0uc2hpcC5oaXQoKTtcblxuICAgIGJvYXJkW3hdW3ldLmhpdCA9IHRydWU7XG4gICAgLy8gcHJpbnRCb2FyZCgpO1xuICAgIHJldHVybiBib2FyZFt4XVt5XVxuICB9XG5cbiAgZnVuY3Rpb24gYXJlQWxsU2hpcHNTdW5rKCkge1xuICAgIGNvbnN0IGZpZWxkc09jY3VwaWVkQnlTaGlwcyA9IFtdO1xuICAgIGJvYXJkLmZvckVhY2goKHJvdykgPT4ge1xuICAgICAgY29uc3Qgb2NjdXBpZWQgPSByb3cuZmlsdGVyKChmaWVsZCkgPT4ge1xuICAgICAgICByZXR1cm4gZmllbGQub2NjdXBpZWRCeVNoaXAgPT09IHRydWU7XG4gICAgICB9KTtcbiAgICAgIGZpZWxkc09jY3VwaWVkQnlTaGlwcy5wdXNoKC4uLm9jY3VwaWVkKTtcbiAgICB9KTtcbiAgICBpZiAoZmllbGRzT2NjdXBpZWRCeVNoaXBzLmV2ZXJ5KChmaWVsZCkgPT4gZmllbGQuaGl0ID09PSB0cnVlKSkgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBjcmVhdGVGaWVsZCxcbiAgICBpbml0R2FtZWJvYXJkLFxuICAgIHByaW50Qm9hcmQsXG4gICAgZ2V0Qm9hcmQsXG4gICAgZmluZFRhcmdldEZpZWxkcyxcbiAgICBmaW5kTmVpZ2hib3VyRmllbGRzLFxuICAgIGNhblNoaXBCZVBsYWNlZCxcbiAgICBwbGFjZVNoaXAsXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBhcmVBbGxTaGlwc1N1bmssXG4gICAgcGxhY2VTaGlwc1JhbmRvbWx5LFxuICB9O1xufTtcbiIsImxldCBoaXRzID0gMDtcbmxldCBoaXRlZFNoaXA7XG5sZXQgaGl0ZWRGaWVsZDtcbmxldCB0ZW1wSGl0ZWRGaWVsZDtcblxuZnVuY3Rpb24gaXNNb3ZlTGVnYWwoeCwgeSwgYm9hcmQpIHtcbiAgaWYgKHggPiA5IHx8IHggPCAwIHx8IHkgPCAwIHx8IHkgPiA5KSByZXR1cm4gZmFsc2U7XG4gIGlmIChib2FyZFt4XVt5XS5oaXQgPT09IHRydWUpIHJldHVybiBmYWxzZTtcbiAgcmV0dXJuIHRydWU7XG59XG5mdW5jdGlvbiBmaW5kUmFuZG9tTW92ZSgpIHtcbiAgY29uc3QgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgY29uc3QgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcblxuICByZXR1cm4gW3gsIHldO1xufVxuXG5mdW5jdGlvbiBmaW5kRm91ckFkamFjZW50RmllbGRzKGZpZWxkLCBib2FyZCkge1xuICBjb25zdCB4ID0gZmllbGQucG9zaXRpb25bMF07XG4gIGNvbnN0IHkgPSBmaWVsZC5wb3NpdGlvblsxXTtcbiAgY29uc3QgcG9zc2libGVGaWVsZHMgPSBbXG4gICAgW3gsIHkgKyAxXSxcbiAgICBbeCwgeSAtIDFdLFxuICAgIFt4ICsgMSwgeV0sXG4gICAgW3ggLSAxLCB5XSxcbiAgXTtcbiAgY29uc3QgdGFyZ2V0RmllbGRzID0gcG9zc2libGVGaWVsZHMuZmlsdGVyKChmaWVsZCkgPT5cbiAgICBpc01vdmVMZWdhbChmaWVsZFswXSwgZmllbGRbMV0sIGJvYXJkLmdldEJvYXJkKCkpLFxuICApO1xuICByZXR1cm4gdGFyZ2V0RmllbGRzO1xufVxuXG5mdW5jdGlvbiBmaW5kQWRqYWNlbnRGaWVsZE9uQXhpcyhmaWVsZE9uZSwgZmllbGRUd28sIGJvYXJkKSB7XG4gIGxldCBhID0gZmllbGRPbmUucG9zaXRpb25bMF07XG4gIGxldCBiID0gZmllbGRPbmUucG9zaXRpb25bMV07XG4gIGxldCB4ID0gZmllbGRUd28ucG9zaXRpb25bMF07XG4gIGxldCB5ID0gZmllbGRUd28ucG9zaXRpb25bMV07XG4gIGNvbnN0IHBvc3NpYmxlRmllbGRzID0gW107XG4gIGxldCBheGlzO1xuXG4gIGlmIChhID09PSB4KSB7XG4gICAgYXhpcyA9IFwiaG9yaXpvbnRhbFwiO1xuICB9IGVsc2UgaWYgKGIgPT09IHkpIHtcbiAgICBheGlzID0gXCJ2ZXJ0aWNhbFwiO1xuICB9XG4gIGlmIChheGlzID09PSBcImhvcml6b250YWxcIikge1xuICAgIGlmIChiID4geSkge1xuICAgICAgYSA9IGZpZWxkVHdvLnBvc2l0aW9uWzBdO1xuICAgICAgYiA9IGZpZWxkVHdvLnBvc2l0aW9uWzFdO1xuICAgICAgeCA9IGZpZWxkT25lLnBvc2l0aW9uWzBdO1xuICAgICAgeSA9IGZpZWxkT25lLnBvc2l0aW9uWzFdO1xuICAgIH1cbiAgICBjb25zdCB0YXJnZXRGaWVsZE9uZSA9IFthLCBiIC0gMV07XG4gICAgY29uc3QgdGFyZ2V0RmllbGRUd28gPSBbeCwgeSArIDFdO1xuICAgIHBvc3NpYmxlRmllbGRzLnB1c2godGFyZ2V0RmllbGRPbmUsIHRhcmdldEZpZWxkVHdvKTtcbiAgfSBlbHNlIGlmIChheGlzID09PSBcInZlcnRpY2FsXCIpIHtcbiAgICBpZiAoYSA+IHgpIHtcbiAgICAgIGEgPSBmaWVsZFR3by5wb3NpdGlvblswXTtcbiAgICAgIGIgPSBmaWVsZFR3by5wb3NpdGlvblsxXTtcbiAgICAgIHggPSBmaWVsZE9uZS5wb3NpdGlvblswXTtcbiAgICAgIHkgPSBmaWVsZE9uZS5wb3NpdGlvblsxXTtcbiAgICB9XG4gICAgY29uc3QgdGFyZ2V0RmllbGRPbmUgPSBbYSAtIDEsIGJdO1xuICAgIGNvbnN0IHRhcmdldEZpZWxkVHdvID0gW3ggKyAxLCB5XTtcbiAgICBwb3NzaWJsZUZpZWxkcy5wdXNoKHRhcmdldEZpZWxkT25lLCB0YXJnZXRGaWVsZFR3byk7XG4gIH1cblxuICBjb25zdCB0YXJnZXRGaWVsZHMgPSBwb3NzaWJsZUZpZWxkcy5maWx0ZXIoKGZpZWxkKSA9PiB7XG4gICAgcmV0dXJuIGlzTW92ZUxlZ2FsKGZpZWxkWzBdLCBmaWVsZFsxXSwgYm9hcmQuZ2V0Qm9hcmQoKSk7XG4gIH0pO1xuICByZXR1cm4gdGFyZ2V0RmllbGRzO1xufVxuXG4vLyBOYSByYXppZSBhaSBwbyAxIHRyYWZpZW5pdSB1ZGVyemEgdyBqZWRlbiB6IGN6dGVyZWNoIHNsb3TDs3cgdyBva8OzxYJcbmZ1bmN0aW9uIGFpQXR0YWNrKGJvYXJkKSB7XG4gIGlmIChoaXRlZFNoaXAgIT09IHVuZGVmaW5lZCAmJiBoaXRlZFNoaXAuaXNTdW5rKCkgPT09IHRydWUpIHtcbiAgICBoaXRzID0gMDtcbiAgICBoaXRlZFNoaXAgPSB1bmRlZmluZWQ7XG4gIH1cbiAgaWYgKGhpdHMgPT09IDEpIHtcbiAgICBjb25zdCBhZGphY2VudEZpZWxkcyA9IGZpbmRGb3VyQWRqYWNlbnRGaWVsZHMoaGl0ZWRGaWVsZCwgYm9hcmQpO1xuICAgIGNvbnN0IHJhbmRvbU51bSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGFkamFjZW50RmllbGRzLmxlbmd0aCk7XG4gICAgY29uc3QgcmFuZG9tTW92ZSA9IGFkamFjZW50RmllbGRzW3JhbmRvbU51bV07XG4gICAgdGVtcEhpdGVkRmllbGQgPSBib2FyZC5yZWNlaXZlQXR0YWNrKC4uLnJhbmRvbU1vdmUpO1xuICAgIGlmICh0ZW1wSGl0ZWRGaWVsZC5zaGlwICE9PSBudWxsKSB7XG4gICAgICBoaXRzICs9IDE7XG4gICAgICBjb25zb2xlLmxvZyh0ZW1wSGl0ZWRGaWVsZClcbiAgICB9XG4gICAgICByZXR1cm47XG4gIH1cblxuICBpZiAoaGl0cyA+IDEpIHtcbiAgICBpZiAodGVtcEhpdGVkRmllbGQucG9zaXRpb25bMF0gPiBoaXRlZEZpZWxkLnBvc2l0aW9uWzBdIHx8IHRlbXBIaXRlZEZpZWxkWzFdID4gaGl0ZWRGaWVsZFsxXSkge1xuICAgICAgICBsZXQgdGVtcCA9IGhpdGVkRmllbGRcbiAgICAgICAgaGl0ZWRGaWVsZCA9IHRlbXBIaXRlZEZpZWxkXG4gICAgICAgIHRlbXBIaXRlZEZpZWxkID0gdGVtcFxuICAgIH1cbiAgICBjb25zdCB0YXJnZXRGaWVsZHMgPSBmaW5kQWRqYWNlbnRGaWVsZE9uQXhpcyhcbiAgICAgIGhpdGVkRmllbGQsXG4gICAgICB0ZW1wSGl0ZWRGaWVsZCxcbiAgICAgIGJvYXJkLFxuICAgICk7XG4gICAgY29uc29sZS5sb2codGFyZ2V0RmllbGRzLCBcInRhcmdldCBmaWVsZHNcIik7XG4gICAgY29uc29sZS5sb2coaGl0ZWRGaWVsZC5wb3NpdGlvbiwgXCJoaXRlZCBmaWVsZFwiKTtcbiAgICBjb25zb2xlLmxvZyh0ZW1wSGl0ZWRGaWVsZC5wb3NpdGlvbiwgXCJ0ZW1wIGhpdGVkIGZpZWxkXCIpO1xuICAgIGNvbnN0IHJhbmRvbU51bSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRhcmdldEZpZWxkcy5sZW5ndGgpO1xuICAgIGNvbnNvbGUubG9nKHJhbmRvbU51bSwgXCJyYW5kb20gbnVtXCIpO1xuICAgIGNvbnN0IHJhbmRvbU1vdmUgPSB0YXJnZXRGaWVsZHNbcmFuZG9tTnVtXTtcbiAgICBjb25zb2xlLmxvZyhyYW5kb21Nb3ZlLCBcInJhbmRvbSBtb3ZlXCIpO1xuICAgIGNvbnN0IG5ld0hpdGVkRmllbGQgPSBib2FyZC5yZWNlaXZlQXR0YWNrKC4uLnJhbmRvbU1vdmUpO1xuICAgIGNvbnNvbGUubG9nKG5ld0hpdGVkRmllbGQucG9zaXRpb24sIFwibmV3IGhpdGVkIGZpZWxkXCIpO1xuICAgIGNvbnNvbGUubG9nKGhpdGVkRmllbGQucG9zaXRpb24sIFwiaGl0ZWQgZmllbGRcIik7XG4gICAgY29uc29sZS5sb2codGVtcEhpdGVkRmllbGQucG9zaXRpb24sIFwidGVtcCBoaXRlZCBmaWVsZFwiKTtcbiAgICBpZiAoXG4gICAgICAobmV3SGl0ZWRGaWVsZC5zaGlwICE9PSBudWxsICYmXG4gICAgICAgIG5ld0hpdGVkRmllbGQucG9zaXRpb25bMF0gPCBoaXRlZEZpZWxkLnBvc2l0aW9uWzBdKSB8fFxuICAgICAgbmV3SGl0ZWRGaWVsZC5wb3NpdGlvblsxXSA8IGhpdGVkRmllbGQucG9zaXRpb25bMV1cbiAgICApIHtcbiAgICAgIHRlbXBIaXRlZEZpZWxkID0gbmV3SGl0ZWRGaWVsZDtcbiAgICAgIGhpdHMgKz0gMTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgbmV3SGl0ZWRGaWVsZC5zaGlwICE9PSBudWxsICYmXG4gICAgICAobmV3SGl0ZWRGaWVsZC5wb3NpdGlvblswXSA+IGhpdGVkRmllbGQucG9zaXRpb25bMF0gfHxcbiAgICAgICAgbmV3SGl0ZWRGaWVsZC5wb3NpdGlvblsxXSA+IGhpdGVkRmllbGQucG9zaXRpb25bMV0pXG4gICAgKSB7XG4gICAgICBoaXRlZEZpZWxkID0gbmV3SGl0ZWRGaWVsZDtcbiAgICAgIGhpdHMgKz0gMTtcbiAgICB9XG4gICAgcmV0dXJuO1xuICB9XG4gIGxldCByYW5kb21Nb3ZlID0gZmluZFJhbmRvbU1vdmUoKTtcbiAgd2hpbGUgKFxuICAgIGlzTW92ZUxlZ2FsKHJhbmRvbU1vdmVbMF0sIHJhbmRvbU1vdmVbMV0sIGJvYXJkLmdldEJvYXJkKCkpID09PSBmYWxzZVxuICApIHtcbiAgICByYW5kb21Nb3ZlID0gZmluZFJhbmRvbU1vdmUoKTtcbiAgfVxuICBoaXRlZEZpZWxkID0gYm9hcmQucmVjZWl2ZUF0dGFjayguLi5yYW5kb21Nb3ZlKTtcbiAgaWYgKGhpdGVkRmllbGQuc2hpcCAhPT0gbnVsbCkge1xuICAgIGhpdGVkU2hpcCA9IGhpdGVkRmllbGQuc2hpcDtcbiAgICBoaXRzICs9IDE7XG4gIH1cbn1cbmV4cG9ydCB7IGFpQXR0YWNrLCBmaW5kQWRqYWNlbnRGaWVsZE9uQXhpcyB9O1xuIiwiaW1wb3J0IHsgYWlBdHRhY2sgfSBmcm9tIFwiLi9haS5qc1wiO1xuXG5leHBvcnQgY29uc3QgcGxheWVyID0gKGFpLCBpc0l0UGxheWVyc1R1cm4pID0+IHtcbiAgY29uc3QgaXNBaSA9IGFpO1xuICBsZXQgcGxheWVyc1R1cm4gPSBpc0l0UGxheWVyc1R1cm47XG4gIGNvbnN0IGdldFBsYXllcnNUdXJuID0gKCkgPT4gcGxheWVyc1R1cm47XG4gIGNvbnN0IHNldFBsYXllcnNUdXJuID0gKHZhbHVlKSA9PiB7XG4gICAgcGxheWVyc1R1cm4gPSB2YWx1ZVxuICB9XG5cbiAgZnVuY3Rpb24gY2hhbmdlUGxheWVyc1R1cm4oc2Vjb25kUGxheWVyKSB7XG4gICAgY29uc3Qgc2Vjb25kUGxheWVyVHVybiA9IHNlY29uZFBsYXllci5nZXRQbGF5ZXJzVHVybigpO1xuICAgIHN3aXRjaCAocGxheWVyc1R1cm4pIHtcbiAgICAgIGNhc2UgdHJ1ZTpcbiAgICAgICAgcGxheWVyc1R1cm4gPSBmYWxzZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGZhbHNlOlxuICAgICAgICBwbGF5ZXJzVHVybiA9IHRydWU7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBzd2l0Y2ggKHNlY29uZFBsYXllclR1cm4pIHtcbiAgICAgIGNhc2UgdHJ1ZTpcbiAgICAgICAgc2Vjb25kUGxheWVyLnNldFBsYXllcnNUdXJuKGZhbHNlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGZhbHNlOlxuICAgICAgICBzZWNvbmRQbGF5ZXIuc2V0UGxheWVyc1R1cm4odHJ1ZSk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBcbiAgfVxuXG4gIGZ1bmN0aW9uIGF0dGFjayhib2FyZCwgYXR0YWNrZWRQbGF5ZXIsIHgsIHkpIHtcbiAgICBjaGFuZ2VQbGF5ZXJzVHVybihhdHRhY2tlZFBsYXllcik7XG4gICAgaWYgKGlzQWkpIHtcbiAgICAgIGFpQXR0YWNrKGJvYXJkLCBhdHRhY2tlZFBsYXllcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBib2FyZC5yZWNlaXZlQXR0YWNrKHgsIHkpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmRSYW5kb21Nb3ZlKCkge1xuICAgIGNvbnN0IHggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgY29uc3QgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcblxuICAgIHJldHVybiBbeCwgeV07XG4gIH1cblxuICBmdW5jdGlvbiBpc01vdmVMZWdhbCh4LCB5LCBib2FyZCkge1xuICAgIGlmIChib2FyZFt4XVt5XS5oaXQgPT09IHRydWUpIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG5cblxuICByZXR1cm4ge1xuICAgIGF0dGFjayxcbiAgICBnZXRQbGF5ZXJzVHVybixcbiAgICBzZXRQbGF5ZXJzVHVybixcbiAgICBpc01vdmVMZWdhbCxcbiAgICBjaGFuZ2VQbGF5ZXJzVHVybixcbiAgICBmaW5kUmFuZG9tTW92ZVxuICB9O1xufTtcbiIsImltcG9ydCB7IGdhbWVib2FyZEZhY3RvcnkgfSBmcm9tIFwiLi9nYW1lYm9hcmQuanNcIjtcbmltcG9ydCB7IHBsYXllciB9IGZyb20gXCIuL3BsYXllci5qc1wiO1xuaW1wb3J0IHsgZG9tQ29udHJvbGxlciB9IGZyb20gXCIuL2RvbS5qc1wiO1xuXG5sZXQgcGxheWVyT25lR2FtZWJvYXJkIFxubGV0IHBsYXllclR3b0dhbWVib2FyZCBcbmNvbnN0IGdldFBsYXllck9uZUdhbWVib2FyZCA9ICgpID0+IHBsYXllck9uZUdhbWVib2FyZFxuY29uc3QgZ2V0UGxheWVyVHdvR2FtZWJvYXJkID0gKCkgPT4gcGxheWVyVHdvR2FtZWJvYXJkXG5jb25zdCBwbGF5ZXJPbmUgPSBwbGF5ZXIoZmFsc2UsIHRydWUpO1xuY29uc3QgcGxheWVyVHdvID0gcGxheWVyKHRydWUsIGZhbHNlKTtcbmNvbnN0IGRvbSA9IGRvbUNvbnRyb2xsZXIoXG4gIHBsYXllck9uZSxcbiAgcGxheWVyVHdvLFxuKTtcbmV4cG9ydCBmdW5jdGlvbiBnYW1lKCkge1xuICBmdW5jdGlvbiBpbml0R2FtZWJvYXJkcygpIHtcbiAgICBjb25zdCBwbGF5ZXJPbmVEaXNwbGF5ID0gZG9tLnBsYXllck9uZURpc3BsYXlcbiAgICBjb25zdCBwbGF5ZXJUd29EaXNwbGF5ID0gZG9tLnBsYXllclR3b0Rpc3BsYXlcbiAgICBwbGF5ZXJPbmVHYW1lYm9hcmQgPSBnYW1lYm9hcmRGYWN0b3J5KCk7XG4gICAgcGxheWVyVHdvR2FtZWJvYXJkID0gZ2FtZWJvYXJkRmFjdG9yeSgpO1xuICAgIHBsYXllck9uZUdhbWVib2FyZC5pbml0R2FtZWJvYXJkKCk7XG4gICAgcGxheWVyVHdvR2FtZWJvYXJkLmluaXRHYW1lYm9hcmQoKTtcbiAgICBwbGF5ZXJPbmVEaXNwbGF5LmJvYXJkID0gcGxheWVyT25lR2FtZWJvYXJkLmdldEJvYXJkKClcbiAgICBwbGF5ZXJUd29EaXNwbGF5LmJvYXJkID0gcGxheWVyVHdvR2FtZWJvYXJkLmdldEJvYXJkKClcbiAgICBkb20ucmVuZGVyR2FtZWJvYXJkcyhwbGF5ZXJPbmVHYW1lYm9hcmQuZ2V0Qm9hcmQoKSwgcGxheWVyVHdvR2FtZWJvYXJkLmdldEJvYXJkKCkpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RhcnRHYW1lKCkge1xuICAgIHBsYXllck9uZS5zZXRQbGF5ZXJzVHVybih0cnVlKTtcbiAgICBwbGF5ZXJUd28uc2V0UGxheWVyc1R1cm4oZmFsc2UpO1xuXG4gICAgcGxheWVyVHdvR2FtZWJvYXJkLnBsYWNlU2hpcHNSYW5kb21seSg1KTtcbiAgICBkb20ucmVuZGVyR2FtZWJvYXJkcyhwbGF5ZXJPbmVHYW1lYm9hcmQuZ2V0Qm9hcmQoKSwgcGxheWVyVHdvR2FtZWJvYXJkLmdldEJvYXJkKCkpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGxheSh4LCB5KSB7XG4gICAgY29uc3QgcGxheWVyT25lVHVybiA9IHBsYXllck9uZS5nZXRQbGF5ZXJzVHVybigpO1xuICAgIGNvbnN0IHBsYXllclR3b1R1cm4gPSBwbGF5ZXJUd28uZ2V0UGxheWVyc1R1cm4oKTtcblxuICAgIGlmIChwbGF5ZXJPbmVUdXJuID09PSB0cnVlKSB7XG4gICAgICBwbGF5ZXJPbmUuYXR0YWNrKHBsYXllclR3b0dhbWVib2FyZCwgcGxheWVyVHdvLCB4LCB5KTtcbiAgICB9IGVsc2UgaWYgKHBsYXllclR3b1R1cm4gPT09IHRydWUpIHtcbiAgICAgIHBsYXllclR3by5hdHRhY2socGxheWVyT25lR2FtZWJvYXJkLCBwbGF5ZXJPbmUpO1xuICAgIH1cblxuICAgIGlmIChpc0dhbWVGaW5pc2hlZCgpKSB7XG4gICAgICBsZXQgd2lubmVyID0gXCJcIjtcbiAgICAgIGlmIChwbGF5ZXJPbmVHYW1lYm9hcmQuYXJlQWxsU2hpcHNTdW5rKCkgPT09IHRydWUpIHtcbiAgICAgICAgd2lubmVyID0gXCJQbGF5ZXIgVHdvXCI7XG4gICAgICB9XG4gICAgICBpZiAocGxheWVyVHdvR2FtZWJvYXJkLmFyZUFsbFNoaXBzU3VuaygpID09PSB0cnVlKSB7XG4gICAgICAgIHdpbm5lciA9IFwiUGxheWVyIE9uZVwiO1xuICAgICAgfVxuICAgICAgZW5kR2FtZSh3aW5uZXIpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGlzR2FtZUZpbmlzaGVkKCkge1xuICAgIGlmIChcbiAgICAgIHBsYXllck9uZUdhbWVib2FyZC5hcmVBbGxTaGlwc1N1bmsoKSA9PT0gdHJ1ZSB8fFxuICAgICAgcGxheWVyVHdvR2FtZWJvYXJkLmFyZUFsbFNoaXBzU3VuaygpID09PSB0cnVlXG4gICAgKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZnVuY3Rpb24gZW5kR2FtZSh3aW5uZXIpIHtcbiAgICBkb20uY3JlYXRlRW5kR2FtZVBvcHVwKHdpbm5lcik7XG4gICAgZG9tLnJlbW92ZUZpZWxkc0V2ZW50TGlzdGVuZXJzKCk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHN0YXJ0R2FtZSxcbiAgICBwbGF5LFxuICAgIGVuZEdhbWUsXG4gICAgaXNHYW1lRmluaXNoZWQsXG4gICAgaW5pdEdhbWVib2FyZHMsXG4gICAgZ2V0UGxheWVyT25lR2FtZWJvYXJkLFxuICAgIGdldFBsYXllclR3b0dhbWVib2FyZFxuICB9O1xufVxuXG5leHBvcnQgeyBwbGF5ZXJPbmUsIHBsYXllclR3byB9O1xuIiwiaW1wb3J0IHsgZ2FtZSwgcGxheWVyT25lIH0gZnJvbSBcIi4vZ2FtZS5qc1wiO1xuaW1wb3J0IHsgZ2FtZWJvYXJkRmFjdG9yeSB9IGZyb20gXCIuL2dhbWVib2FyZC5qc1wiO1xuXG5leHBvcnQgZnVuY3Rpb24gZG9tQ29udHJvbGxlcigpIHtcbiAgY29uc3QgZ2FtZWJvYXJkQ29udHJvbGxlciA9IGdhbWVib2FyZEZhY3RvcnkoKTtcbiAgY29uc3QgZ2FtZUNvbnRyb2xsZXIgPSBnYW1lKCk7XG4gIGNvbnN0IG1haW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwibWFpblwiKTtcbiAgY29uc3QgcGxheWVyT25lRGlzcGxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyLW9uZS1ib2FyZFwiKTtcbiAgY29uc3QgcGxheWVyVHdvRGlzcGxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyLXR3by1ib2FyZFwiKTtcbiAgY29uc3Qgc3dpdGNoUG9zaXRpb25CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnN3aXRjaC1wb3NpdGlvblwiKTtcbiAgY29uc3QgZmllbGRzID0gW107XG4gIGxldCBwbGF5ZXJPbmVHYW1lYm9hcmQgPSBnYW1lQ29udHJvbGxlci5nZXRQbGF5ZXJPbmVHYW1lYm9hcmQoKTtcbiAgbGV0IGdhbWVNb2RlID0gXCJpbml0XCI7XG4gIGxldCBzaGlwTGVuZ3RoID0gMTtcbiAgbGV0IHg7XG4gIGxldCB5O1xuICBsZXQgcG9zaXRpb24gPSBcInZlcnRpY2FsXCI7XG5cbiAgZnVuY3Rpb24gcmVuZGVyRmllbGQoZmllbGQsIGJvYXJkRGlzcGxheSkge1xuICAgIGNvbnN0IHJlbmRlcmVkRmllbGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHJlbmRlcmVkRmllbGQuY2xhc3NMaXN0LmFkZChcImZpZWxkXCIpO1xuICAgIGlmIChmaWVsZC5zaGlwICE9PSBudWxsKSB7XG4gICAgICByZW5kZXJlZEZpZWxkLmNsYXNzTGlzdC5hZGQoXCJzaGlwXCIpO1xuICAgIH1cbiAgICBpZiAoZmllbGQuc2hpcCAhPT0gbnVsbCAmJiBib2FyZERpc3BsYXkgPT09IHBsYXllclR3b0Rpc3BsYXkpIHtcbiAgICAgICAgcmVuZGVyZWRGaWVsZC5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgfVxuICAgIGlmIChmaWVsZC5zaGlwICE9PSBudWxsICYmIGZpZWxkLnNoaXAuaXNTdW5rKCkpIHtcbiAgICAgIHJlbmRlcmVkRmllbGQuY2xhc3NMaXN0LmFkZChcInN1bmtcIik7XG4gICAgfVxuICAgIGlmIChmaWVsZC5oaXQgPT09IHRydWUpIHtcbiAgICAgIHJlbmRlcmVkRmllbGQuY2xhc3NMaXN0LmFkZChcImhpdFwiKTtcbiAgICB9XG4gICAgcmVuZGVyZWRGaWVsZC5ib2FyZCA9IGZpZWxkLmJvYXJkO1xuICAgIHJlbmRlcmVkRmllbGQuZmllbGQgPSBmaWVsZDtcblxuICAgIGlmICghZmllbGRzLmluY2x1ZGVzKGZpZWxkLnBvc3Rpb24pKSB7XG4gICAgICBmaWVsZHMucHVzaChmaWVsZC5wb3NpdGlvbik7XG4gICAgfVxuXG4gICAgaWYgKGdhbWVNb2RlID09PSBcImluaXRcIikge1xuICAgICAgcmVuZGVyZWRGaWVsZC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsIGhpZ2hsaWdodFRhcmdldEZpZWxkKTtcbiAgICAgIHJlbmRlcmVkRmllbGQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3V0XCIsIHVuaGlnaGxpZ2h0VGFyZ2V0RmllbGRzKTtcbiAgICAgIHJlbmRlcmVkRmllbGQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHBsYWNlU2hpcCk7XG4gICAgICByZW5kZXJlZEZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjaGFuZ2VHYW1lTW9kZSk7XG4gICAgfSBlbHNlIGlmIChnYW1lTW9kZSA9PT0gXCJnYW1lXCIpIHtcbiAgICAgIHJlbmRlcmVkRmllbGQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHBsYXlPbkNsaWNrKTtcbiAgICB9XG5cbiAgICBib2FyZERpc3BsYXkuYXBwZW5kQ2hpbGQocmVuZGVyZWRGaWVsZCk7XG5cbiAgICByZXR1cm4gcmVuZGVyZWRGaWVsZDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbmRlckdhbWVib2FyZChib2FyZCwgYm9hcmREaXNwbGF5KSB7XG4gICAgYm9hcmREaXNwbGF5LmlubmVySFRNTCA9IFwiXCI7XG5cbiAgICBib2FyZC5mb3JFYWNoKChyb3cpID0+IHtcbiAgICAgIHJvdy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgICByZW5kZXJGaWVsZChmaWVsZCwgYm9hcmREaXNwbGF5KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVuZGVyR2FtZWJvYXJkcyhwbGF5ZXJPbmVHYW1lYm9hcmQsIHBsYXllclR3b0dhbWVib2FyZCkge1xuICAgIHJlbmRlckdhbWVib2FyZChwbGF5ZXJPbmVHYW1lYm9hcmQsIHBsYXllck9uZURpc3BsYXkpO1xuICAgIHJlbmRlckdhbWVib2FyZChwbGF5ZXJUd29HYW1lYm9hcmQsIHBsYXllclR3b0Rpc3BsYXkpO1xuICB9XG5cbiAgZnVuY3Rpb24gcGxheU9uQ2xpY2soZSkge1xuICAgIC8vIElmIGNsaWNrZWQgZmllbGQgaXMgbm90IG9uIGVuZW15IGJvYXJkIG9yIGl0IGlzIG5vdCBodW1hbiBwbGF5ZXIgdHVybjogcmV0dXJuXG4gICAgaWYgKGUudGFyZ2V0LnBhcmVudEVsZW1lbnQgIT09IHBsYXllclR3b0Rpc3BsYXkpIHJldHVybjtcbiAgICBpZiAocGxheWVyT25lLmdldFBsYXllcnNUdXJuKCkgIT09IHRydWUpIHJldHVybjtcbiAgICBpZiAoZS50YXJnZXQuZmllbGQuaGl0ID09PSB0cnVlKSByZXR1cm47XG5cbiAgICBjb25zdCB4ID0gZS50YXJnZXQuZmllbGQucG9zaXRpb25bMF07XG4gICAgY29uc3QgeSA9IGUudGFyZ2V0LmZpZWxkLnBvc2l0aW9uWzFdO1xuXG4gICAgZ2FtZUNvbnRyb2xsZXIucGxheSh4LCB5KTtcblxuICAgIC8vIFRoaXMgZ2FtZSBlbmRpbmcgY29uZGl0aW9uIGlzIGFsc28gcHJlc2VudCBpbiBnYW1lLmpzXG4gICAgaWYgKGdhbWVDb250cm9sbGVyLmlzR2FtZUZpbmlzaGVkKCkpIHtcbiAgICAgIGNvbnN0IHBsYXllck9uZUdhbWVib2FyZCA9IGdhbWVDb250cm9sbGVyLmdldFBsYXllck9uZUdhbWVib2FyZCgpO1xuICAgICAgY29uc3QgcGxheWVyVHdvR2FtZWJvYXJkID0gZ2FtZUNvbnRyb2xsZXIuZ2V0UGxheWVyVHdvR2FtZWJvYXJkKCk7XG4gICAgICByZW5kZXJHYW1lYm9hcmRzKFxuICAgICAgICBwbGF5ZXJPbmVHYW1lYm9hcmQuZ2V0Qm9hcmQoKSxcbiAgICAgICAgcGxheWVyVHdvR2FtZWJvYXJkLmdldEJvYXJkKCksXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICByZW5kZXJHYW1lYm9hcmQoZS50YXJnZXQucGFyZW50RWxlbWVudC5ib2FyZCwgZS50YXJnZXQucGFyZW50RWxlbWVudCk7XG5cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGdhbWVDb250cm9sbGVyLnBsYXkoKTtcbiAgICAgIHJlbmRlckdhbWVib2FyZChwbGF5ZXJPbmVHYW1lYm9hcmQuZ2V0Qm9hcmQoKSwgcGxheWVyT25lRGlzcGxheSk7XG4gICAgfSwgXCIxNTAwXCIpO1xuICB9XG5cbiAgLy8gU3RhcnQvRW5kIEdhbWUgUG9wdXBzXG5cbiAgZnVuY3Rpb24gY3JlYXRlRW5kR2FtZVBvcHVwKHdpbm5lcikge1xuICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwiZW5kLWdhbWVcIik7XG4gICAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsXCIpO1xuXG4gICAgY29uc3QgdGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJwXCIpO1xuICAgIHRleHQuY2xhc3NMaXN0LmFkZChcImVuZC1nYW1lLXRleHRcIik7XG4gICAgdGV4dC50ZXh0Q29udGVudCA9IGAke3dpbm5lcn0gV29uYDtcblxuICAgIGNvbnN0IG5ld0dhbWVCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgIG5ld0dhbWVCdXR0b24uY2xhc3NMaXN0LmFkZChcIm5ldy1nYW1lLWJ1dHRvblwiKTtcbiAgICBuZXdHYW1lQnV0dG9uLnRleHRDb250ZW50ID0gXCJOZXcgR2FtZVwiO1xuXG4gICAgbWFpbi5hcHBlbmRDaGlsZChtb2RhbCk7XG4gICAgbW9kYWwuYXBwZW5kQ2hpbGQodGV4dCk7XG4gICAgbW9kYWwuYXBwZW5kQ2hpbGQobmV3R2FtZUJ1dHRvbik7XG5cbiAgICBuZXdHYW1lQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIHJlc2V0RGlzcGxheSgpXG4gICAgICAgIHN3aXRjaFBvc2l0aW9uQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpXG4gICAgfSlcbiAgfVxuXG4gIGZ1bmN0aW9uIGNyZWF0ZVN0YXJ0R2FtZVBvcHVwKCkge1xuICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwic3RhcnQtZ2FtZVwiKTtcbiAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxcIik7XG5cbiAgICBjb25zdCBzdGFydEdhbWVCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgIHN0YXJ0R2FtZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwic3RhcnQtZ2FtZS1idXR0b25cIik7XG4gICAgc3RhcnRHYW1lQnV0dG9uLnRleHRDb250ZW50ID0gXCJTdGFydCBHYW1lXCI7XG5cbiAgICBtYWluLmFwcGVuZENoaWxkKG1vZGFsKTtcbiAgICBtb2RhbC5hcHBlbmRDaGlsZChzdGFydEdhbWVCdXR0b24pO1xuXG4gICAgc3RhcnRHYW1lQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBtYWluLnJlbW92ZUNoaWxkKG1vZGFsKTtcbiAgICAgIGdhbWVDb250cm9sbGVyLnN0YXJ0R2FtZSgpO1xuICAgICAgc3dpdGNoUG9zaXRpb25CdXR0b24uY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJylcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZUZpZWxkc0V2ZW50TGlzdGVuZXJzKCkge1xuICAgIGNvbnN0IGRpc3BsYXllZEZpZWxkcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZmllbGRcIik7XG5cbiAgICBkaXNwbGF5ZWRGaWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgIGZpZWxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBwbGF5T25DbGljayk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiByZXNldERpc3BsYXkoKSB7XG4gICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsXCIpO1xuXG4gICAgbWFpbi5yZW1vdmVDaGlsZChtb2RhbCk7XG4gICAgZ2FtZU1vZGUgPSBcImluaXRcIjtcbiAgICBzaGlwTGVuZ3RoID0gMTtcbiAgICBnYW1lQ29udHJvbGxlci5pbml0R2FtZWJvYXJkcygpO1xuICB9XG5cbiAgLy8gU0hJUCBQTEFDSU5HIExPR0lDXG5cbiAgZnVuY3Rpb24gc2hvd1RhcmdldEZpZWxkcyhlKSB7XG4gICAgcGxheWVyT25lR2FtZWJvYXJkID0gZ2FtZUNvbnRyb2xsZXIuZ2V0UGxheWVyT25lR2FtZWJvYXJkKCk7XG5cbiAgICBwbGF5ZXJPbmVEaXNwbGF5LmJvYXJkT2JqZWN0ID0gcGxheWVyT25lR2FtZWJvYXJkO1xuICAgIGlmIChzaGlwTGVuZ3RoID4gNSkgcmV0dXJuO1xuICAgIGlmIChlLnRhcmdldC5wYXJlbnRFbGVtZW50LmJvYXJkT2JqZWN0ICE9PSBwbGF5ZXJPbmVHYW1lYm9hcmQpIHtcblxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCByZW5kZXJlZEZpZWxkcyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5maWVsZFwiKSk7XG5cbiAgICB4ID0gZS50YXJnZXQuZmllbGQucG9zaXRpb25bMF07XG4gICAgeSA9IGUudGFyZ2V0LmZpZWxkLnBvc2l0aW9uWzFdO1xuICAgIC8vIGNvbnN0IGJvYXJkID0gZS50YXJnZXQucGFyZW50RWxlbWVudC5ib2FyZDtcbiAgICBjb25zdCBib2FyZCA9IHBsYXllck9uZUdhbWVib2FyZC5nZXRCb2FyZCgpO1xuICAgIGNvbnN0IHRhcmdldEZpZWxkcyA9IGdhbWVib2FyZENvbnRyb2xsZXIuZmluZFRhcmdldEZpZWxkcyhcbiAgICAgIHNoaXBMZW5ndGgsXG4gICAgICB4LFxuICAgICAgeSxcbiAgICAgIHBvc2l0aW9uLFxuICAgICAgYm9hcmQsXG4gICAgKTtcbiAgICBsZXQgdGFyZ2V0RmllbGRzUG9zaXRpb25zO1xuICAgIGxldCBkaXNwbGF5ZWRUYXJnZXRGaWVsZHM7XG4gICAgaWYgKHRhcmdldEZpZWxkcyAhPT0gZmFsc2UpIHtcbiAgICAgIHRhcmdldEZpZWxkc1Bvc2l0aW9ucyA9IHRhcmdldEZpZWxkcy5tYXAoKGZpZWxkKSA9PiBmaWVsZC5wb3NpdGlvbik7XG4gICAgICBkaXNwbGF5ZWRUYXJnZXRGaWVsZHMgPSByZW5kZXJlZEZpZWxkcy5maWx0ZXIoXG4gICAgICAgIChmaWVsZCkgPT5cbiAgICAgICAgICB0YXJnZXRGaWVsZHNQb3NpdGlvbnMuaW5jbHVkZXMoZmllbGQuZmllbGQucG9zaXRpb24pID09PSB0cnVlLFxuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKGRpc3BsYXllZFRhcmdldEZpZWxkcykge1xuICAgICAgcmV0dXJuIGRpc3BsYXllZFRhcmdldEZpZWxkcztcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBoaWdobGlnaHRUYXJnZXRGaWVsZChlKSB7XG4gICAgY29uc3QgdGFyZ2V0RmllbGRzID0gc2hvd1RhcmdldEZpZWxkcyhlKTtcbiAgICBpZiAodGFyZ2V0RmllbGRzKSB7XG4gICAgICB0YXJnZXRGaWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IGZpZWxkLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIikpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHVuaGlnaGxpZ2h0VGFyZ2V0RmllbGRzKGUpIHtcbiAgICBjb25zdCB0YXJnZXRGaWVsZHMgPSBzaG93VGFyZ2V0RmllbGRzKGUpO1xuICAgIGlmICh0YXJnZXRGaWVsZHMpIHtcbiAgICAgIHRhcmdldEZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4gZmllbGQuY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZVwiKSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcGxhY2VTaGlwKGUpIHtcbiAgICBpZiAoc2hpcExlbmd0aCA+IDUgfHwgZS50YXJnZXQucGFyZW50RWxlbWVudCA9PT0gcGxheWVyVHdvRGlzcGxheSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBib2FyZE9iamVjdCA9IHBsYXllck9uZUdhbWVib2FyZDtcbiAgICBjb25zdCBib2FyZCA9IHBsYXllck9uZUdhbWVib2FyZC5nZXRCb2FyZCgpO1xuICAgIGNvbnN0IGRpc3BsYXllZEJvYXJkID0gcGxheWVyT25lRGlzcGxheTtcblxuICAgIGNvbnN0IHNoaXAgPSBib2FyZE9iamVjdC5wbGFjZVNoaXAoc2hpcExlbmd0aCwgeCwgeSwgcG9zaXRpb24pO1xuICAgIGlmIChzaGlwICE9PSBmYWxzZSkge1xuICAgICAgcmVuZGVyR2FtZWJvYXJkKGJvYXJkLCBkaXNwbGF5ZWRCb2FyZCk7XG4gICAgICBzaGlwTGVuZ3RoICs9IDE7XG4gICAgfVxuICAgIGlmIChzaGlwTGVuZ3RoID4gNSkgY3JlYXRlU3RhcnRHYW1lUG9wdXAoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNoYW5nZUdhbWVNb2RlKCkge1xuICAgIGNvbnN0IHBsYXllck9uZUdhbWVib2FyZCA9IGdhbWVDb250cm9sbGVyLmdldFBsYXllck9uZUdhbWVib2FyZCgpO1xuICAgIGNvbnN0IHBsYXllclR3b0dhbWVib2FyZCA9IGdhbWVDb250cm9sbGVyLmdldFBsYXllclR3b0dhbWVib2FyZCgpO1xuICAgIGlmIChzaGlwTGVuZ3RoID4gNSkgZ2FtZU1vZGUgPSBcImdhbWVcIjtcbiAgICBpZiAoc2hpcExlbmd0aCA8IDUpIGdhbWVNb2RlID0gXCJpbml0XCI7XG4gICAgcmVuZGVyR2FtZWJvYXJkcyhcbiAgICAgIHBsYXllck9uZUdhbWVib2FyZC5nZXRCb2FyZCgpLFxuICAgICAgcGxheWVyVHdvR2FtZWJvYXJkLmdldEJvYXJkKCksXG4gICAgKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN3aXRjaFBvc2l0aW9uKCkge1xuICAgIHN3aXRjaCAocG9zaXRpb24pIHtcbiAgICAgIGNhc2UgXCJ2ZXJ0aWNhbFwiOlxuICAgICAgICBwb3NpdGlvbiA9IFwiaG9yaXpvbnRhbFwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJob3Jpem9udGFsXCI6XG4gICAgICAgIHBvc2l0aW9uID0gXCJ2ZXJ0aWNhbFwiO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBzd2l0Y2hQb3NpdGlvbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgc3dpdGNoUG9zaXRpb24pO1xuXG4gIHJldHVybiB7XG4gICAgcmVuZGVyR2FtZWJvYXJkcyxcbiAgICBjcmVhdGVFbmRHYW1lUG9wdXAsXG4gICAgcmVtb3ZlRmllbGRzRXZlbnRMaXN0ZW5lcnMsXG4gICAgcGxheWVyT25lRGlzcGxheSxcbiAgICBwbGF5ZXJUd29EaXNwbGF5LFxuICB9O1xufVxuIiwiaW1wb3J0IHsgZ2FtZSB9IGZyb20gXCIuL2dhbWUuanNcIjtcblxuXG5jb25zdCBnYW1lQ29udHJvbGxlciA9IGdhbWUoKVxuXG5cbmdhbWVDb250cm9sbGVyLmluaXRHYW1lYm9hcmRzKClcblxuXG4iXSwibmFtZXMiOlsic2hpcEZhY3RvcnkiLCJsZW5ndGgiLCJudW1iZXJPZkhpdHMiLCJnZXRMZW5ndGgiLCJoaXQiLCJpc1N1bmsiLCJnZXROdW1iZXJPZkhpdHMiLCJzaGlwIiwiY29uc29sZSIsImxvZyIsImdhbWVib2FyZEZhY3RvcnkiLCJib2FyZCIsImdldEJvYXJkIiwiY3JlYXRlRmllbGQiLCJ4IiwieSIsInBvc2l0aW9uIiwib2NjdXBpZWRCeVNoaXAiLCJmaW5kTmVpZ2hib3VyRmllbGRzIiwidGFyZ2V0RmllbGRzIiwiZHVwbGljYXRlZE5laWdoYm91cnMiLCJuZWlnaGJvdXJzIiwicG9zc2JpbGVOZWlnaGJvdXJzIiwiZm9yRWFjaCIsImZpZWxkIiwiY29vcmRpbmF0ZSIsImlzT3V0T2ZCb3VuZCIsInB1c2giLCJmaWx0ZXIiLCJuZWlnaGJvdXIiLCJpbmNsdWRlcyIsImZpbmRUYXJnZXRGaWVsZHMiLCJzaGlwTGVuZ3RoIiwiZGlyZWN0aW9uIiwiaSIsImNoZWNrSWZGaWVsZE9jY3VwaWVkIiwiY2FuU2hpcEJlUGxhY2VkIiwibmVpZ2hib3VyRmllbGRzIiwic29tZSIsInBsYWNlU2hpcCIsImluaXRHYW1lYm9hcmQiLCJhcnIiLCJqIiwicHJpbnRCb2FyZCIsInJvdyIsInN0cmluZyIsInJlY2VpdmVBdHRhY2siLCJhcmVBbGxTaGlwc1N1bmsiLCJmaWVsZHNPY2N1cGllZEJ5U2hpcHMiLCJvY2N1cGllZCIsImV2ZXJ5IiwicGxhY2VTaGlwc1JhbmRvbWx5IiwiYW1vdW50IiwicGxhY2VkU2hpcHMiLCJjdXJyZW50U2hpcExlbmdodCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImhpdGVkU2hpcCIsImhpdGVkRmllbGQiLCJ0ZW1wSGl0ZWRGaWVsZCIsImhpdHMiLCJpc01vdmVMZWdhbCIsImZpbmRSYW5kb21Nb3ZlIiwicGxheWVyIiwiYWkiLCJpc0l0UGxheWVyc1R1cm4iLCJpc0FpIiwicGxheWVyc1R1cm4iLCJjaGFuZ2VQbGF5ZXJzVHVybiIsInNlY29uZFBsYXllciIsInNlY29uZFBsYXllclR1cm4iLCJnZXRQbGF5ZXJzVHVybiIsInNldFBsYXllcnNUdXJuIiwiYXR0YWNrIiwiYXR0YWNrZWRQbGF5ZXIiLCJ1bmRlZmluZWQiLCJhZGphY2VudEZpZWxkcyIsImZpbmRGb3VyQWRqYWNlbnRGaWVsZHMiLCJyYW5kb21Nb3ZlIiwidGVtcCIsImZpZWxkT25lIiwiZmllbGRUd28iLCJhIiwiYiIsInBvc3NpYmxlRmllbGRzIiwiYXhpcyIsInRhcmdldEZpZWxkT25lIiwidGFyZ2V0RmllbGRUd28iLCJmaW5kQWRqYWNlbnRGaWVsZE9uQXhpcyIsInJhbmRvbU51bSIsIm5ld0hpdGVkRmllbGQiLCJhaUF0dGFjayIsInZhbHVlIiwicGxheWVyT25lR2FtZWJvYXJkIiwicGxheWVyVHdvR2FtZWJvYXJkIiwiZ2V0UGxheWVyT25lR2FtZWJvYXJkIiwiZ2V0UGxheWVyVHdvR2FtZWJvYXJkIiwicGxheWVyT25lIiwicGxheWVyVHdvIiwiZG9tIiwiZ2FtZWJvYXJkQ29udHJvbGxlciIsImdhbWVDb250cm9sbGVyIiwiZ2FtZSIsIm1haW4iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJwbGF5ZXJPbmVEaXNwbGF5IiwicGxheWVyVHdvRGlzcGxheSIsInN3aXRjaFBvc2l0aW9uQnV0dG9uIiwiZmllbGRzIiwiZ2FtZU1vZGUiLCJyZW5kZXJHYW1lYm9hcmQiLCJib2FyZERpc3BsYXkiLCJpbm5lckhUTUwiLCJyZW5kZXJlZEZpZWxkIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsInBvc3Rpb24iLCJhZGRFdmVudExpc3RlbmVyIiwiaGlnaGxpZ2h0VGFyZ2V0RmllbGQiLCJ1bmhpZ2hsaWdodFRhcmdldEZpZWxkcyIsImNoYW5nZUdhbWVNb2RlIiwicGxheU9uQ2xpY2siLCJhcHBlbmRDaGlsZCIsInJlbmRlckZpZWxkIiwicmVuZGVyR2FtZWJvYXJkcyIsImUiLCJ0YXJnZXQiLCJwYXJlbnRFbGVtZW50IiwicGxheSIsImlzR2FtZUZpbmlzaGVkIiwic2V0VGltZW91dCIsInNob3dUYXJnZXRGaWVsZHMiLCJib2FyZE9iamVjdCIsInJlbmRlcmVkRmllbGRzIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsInRhcmdldEZpZWxkc1Bvc2l0aW9ucyIsImRpc3BsYXllZFRhcmdldEZpZWxkcyIsIm1hcCIsInJlbW92ZSIsImRpc3BsYXllZEJvYXJkIiwibW9kYWwiLCJzdGFydEdhbWVCdXR0b24iLCJ0ZXh0Q29udGVudCIsInJlbW92ZUNoaWxkIiwic3RhcnRHYW1lIiwidG9nZ2xlIiwiY3JlYXRlU3RhcnRHYW1lUG9wdXAiLCJjcmVhdGVFbmRHYW1lUG9wdXAiLCJ3aW5uZXIiLCJ0ZXh0IiwibmV3R2FtZUJ1dHRvbiIsImluaXRHYW1lYm9hcmRzIiwicmVzZXREaXNwbGF5IiwicmVtb3ZlRmllbGRzRXZlbnRMaXN0ZW5lcnMiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZG9tQ29udHJvbGxlciIsImVuZEdhbWUiLCJwbGF5ZXJPbmVUdXJuIiwicGxheWVyVHdvVHVybiJdLCJzb3VyY2VSb290IjoiIn0=