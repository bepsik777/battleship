(()=>{"use strict";const t=t=>{let e=0;return{getLength:()=>t,hit:()=>(e+=1,e),isSunk:()=>e===t,getNumberOfHits:()=>e}},e=t(1);e.hit(),console.log(e.getLength());const n=()=>{const e=[],n=()=>e;function o(t,e){return{position:[t,e],occupiedByShip:!1,hit:!1,ship:null,board:n()}}function i(t){if(!t)return!1;const e=n();let o=[];const i=[],r=[];return t.forEach((t=>{const n=t.position[0],o=t.position[1];[[n-1,o-1],[n-1,o],[n-1,o+1],[n,o+1],[n+1,o+1],[n+1,o],[n+1,o-1],[n,o-1]].forEach((t=>{!1===a(t[0],t[1])&&r.push(e[t[0]][t[1]])}))})),o=r.filter((e=>!1===t.includes(e))),o.forEach((t=>{i.includes(t)||i.push(t)})),i}function r(t,e,n,o,i){const r=[];for(let s=0;s<t;s++)if("horizontal"===o){if(a(e,n+s))return!1;r.push(i[e][n+s])}else if("vertical"===o){if(a(e+s,n))return!1;r.push(i[e+s][n])}return r}function a(t,e){return t<0||t>9||e<0||e>9}function s(t){return!0===t.occupiedByShip}function c(t,e){return!!t&&!t.some(s)&&!e.some(s)}function l(e,o,a,s="horizontal"){const l=r(e,o,a,s,n());if(!c(l,i(l)))return!1;const d=t(e);return l.forEach((t=>{t.occupiedByShip=!0,t.ship=d})),d}return{createField:o,initGameboard:function(){for(let t=0;t<10;t++){const n=[];for(let e=0;e<10;e++)n.push(o(t,e));e.push(n)}},printBoard:function(){e.forEach((t=>{let e="";t.forEach((t=>{t.occupiedByShip||t.hit?!t.occupiedByShip&&t.hit?e+="|  -  |":t.occupiedByShip&&!t.hit?e+="|  O  |":t.occupiedByShip&&t.hit&&(e+="|  X  |"):e+=`| ${t.position} |`})),console.log(e)}))},getBoard:n,findTargetFields:r,findNeighbourFields:i,canShipBePlaced:c,placeShip:l,receiveAttack:function(t,n){return!a(t,n)&&!e[t][n].hit&&(null!==e[t][n].ship&&e[t][n].ship.hit(),e[t][n].hit=!0,e[t][n])},areAllShipsSunk:function(){const t=[];return e.forEach((e=>{const n=e.filter((t=>!0===t.occupiedByShip));t.push(...n)})),!!t.every((t=>!0===t.hit))},placeShipsRandomly:function(t){const e=[];let n=1;for(;e.length!==t;){const t=Math.floor(10*Math.random()),o=Math.floor(10*Math.random());let i;switch(Math.floor(2*Math.random())){case 1:i="vertical";break;case 0:i="horizontal"}const r=l(n,t,o,i);!1!==r&&(e.push(r),n++)}}}};let o,i,r,a=0;function s(t,e,n){return!(t>9||t<0||e<0||e>9)&&!0!==n[t][e].hit}function c(){return[Math.floor(10*Math.random()),Math.floor(10*Math.random())]}const l=(t,e)=>{const n=t;let l=e;function d(t){const e=t.getPlayersTurn();switch(l){case!0:l=!1;break;case!1:l=!0}switch(e){case!0:t.setPlayersTurn(!1);break;case!1:t.setPlayersTurn(!0)}}return{attack:function(t,e,l,u){if(d(e),!n)return t.receiveAttack(l,u);!function(t){if(void 0!==o&&!0===o.isSunk()&&(a=0,o=void 0),1===a){const e=function(t,e){const n=t.position[0],o=t.position[1],i=[[n,o+1],[n,o-1],[n+1,o],[n-1,o]].filter((t=>s(t[0],t[1],e.getBoard())));return i}(i,t),n=e[Math.floor(Math.random()*e.length)];return r=t.receiveAttack(...n),void(null!==r.ship&&(a+=1))}if(a>1){if(r.position[0]>i.position[0]||r[1]>i[1]){let t=i;i=r,r=t}const e=function(t,e,n){let o=t.position[0],i=t.position[1],r=e.position[0],a=e.position[1];const c=[];let l;if(o===r?l="horizontal":i===a&&(l="vertical"),"horizontal"===l){i>a&&(o=e.position[0],i=e.position[1],r=t.position[0],a=t.position[1]);const n=[o,i-1],s=[r,a+1];c.push(n,s)}else if("vertical"===l){o>r&&(o=e.position[0],i=e.position[1],r=t.position[0],a=t.position[1]);const n=[o-1,i],s=[r+1,a];c.push(n,s)}return c.filter((t=>s(t[0],t[1],n.getBoard())))}(i,r,t),n=e[Math.floor(Math.random()*e.length)],o=t.receiveAttack(...n);return void(null!==o.ship&&o.position[0]<i.position[0]||o.position[1]<i.position[1]?(r=o,a+=1):null!==o.ship&&(o.position[0]>i.position[0]||o.position[1]>i.position[1])&&(i=o,a+=1))}let e=c();for(;!1===s(e[0],e[1],t.getBoard());)e=c();i=t.receiveAttack(...e),null!==i.ship&&(o=i.ship,a+=1)}(t)},getPlayersTurn:()=>l,setPlayersTurn:t=>{l=t},isMoveLegal:function(t,e,n){return!0!==n[t][e].hit},changePlayersTurn:d,findRandomMove:function(){return[Math.floor(10*Math.random()),Math.floor(10*Math.random())]}}};let d,u;const p=()=>d,h=()=>u,f=l(!1,!0),m=l(!0,!1),g=function(){const t=n(),e=y(),o=document.querySelector("main"),i=document.querySelector(".player-one-board"),r=document.querySelector(".player-two-board"),a=document.querySelector(".switch-position"),s=[];let c,l,d=e.getPlayerOneGameboard(),u="init",p=1,h="vertical";function m(t,e){e.innerHTML="",t.forEach((t=>{t.forEach((t=>{!function(t,e){const n=document.createElement("div");n.classList.add("field"),null!==t.ship&&n.classList.add("ship"),null!==t.ship&&e===r&&n.classList.add("hidden"),null!==t.ship&&t.ship.isSunk()&&n.classList.add("sunk"),!0===t.hit&&n.classList.add("hit"),n.board=t.board,n.field=t,s.includes(t.postion)||s.push(t.position),"init"===u?(n.addEventListener("mouseover",E),n.addEventListener("mouseout",S),n.addEventListener("click",L),n.addEventListener("click",k)):"game"===u&&n.addEventListener("click",v),e.appendChild(n)}(t,e)}))}))}function g(t,e){m(t,i),m(e,r)}function v(t){if(t.target.parentElement!==r)return;if(!0!==f.getPlayersTurn())return;if(!0===t.target.field.hit)return;const n=t.target.field.position[0],o=t.target.field.position[1];if(e.play(n,o),e.isGameFinished()){const t=e.getPlayerOneGameboard(),n=e.getPlayerTwoGameboard();g(t.getBoard(),n.getBoard())}else m(t.target.parentElement.board,t.target.parentElement),setTimeout((()=>{e.play(),m(d.getBoard(),i)}),"1500")}function b(n){if(d=e.getPlayerOneGameboard(),i.boardObject=d,p>5)return;if(n.target.parentElement.boardObject!==d)return;const o=Array.from(document.querySelectorAll(".field"));c=n.target.field.position[0],l=n.target.field.position[1];const r=d.getBoard(),a=t.findTargetFields(p,c,l,h,r);let s,u;return!1!==a&&(s=a.map((t=>t.position)),u=o.filter((t=>!0===s.includes(t.field.position)))),u||void 0}function E(t){const e=b(t);e&&e.forEach((t=>t.classList.add("active")))}function S(t){const e=b(t);e&&e.forEach((t=>t.classList.remove("active")))}function L(t){if(p>5||t.target.parentElement===r)return;const n=d,s=d.getBoard(),u=i;!1!==n.placeShip(p,c,l,h)&&(m(s,u),p+=1),p>5&&function(){const t=document.createElement("div");t.classList.add("start-game"),t.classList.add("modal");const n=document.createElement("button");n.classList.add("start-game-button"),n.textContent="Start Game",o.appendChild(t),t.appendChild(n),n.addEventListener("click",(()=>{o.removeChild(t),e.startGame(),a.classList.toggle("hidden")}))}()}function k(){const t=e.getPlayerOneGameboard(),n=e.getPlayerTwoGameboard();p>5&&(u="game"),p<5&&(u="init"),g(t.getBoard(),n.getBoard())}return a.addEventListener("click",(function(){switch(h){case"vertical":h="horizontal";break;case"horizontal":h="vertical"}})),{renderGameboards:g,createEndGamePopup:function(t){const n=document.createElement("div");n.classList.add("end-game"),n.classList.add("modal");const i=document.createElement("p");i.classList.add("end-game-text"),i.textContent=`${t} Won`;const r=document.createElement("button");r.classList.add("new-game-button"),r.textContent="New Game",o.appendChild(n),n.appendChild(i),n.appendChild(r),r.addEventListener("click",(()=>{!function(){const t=document.querySelector(".modal");o.removeChild(t),u="init",p=1,e.initGameboards()}(),a.classList.toggle("hidden")}))},removeFieldsEventListeners:function(){document.querySelectorAll(".field").forEach((t=>{t.removeEventListener("click",v)}))},playerOneDisplay:i,playerTwoDisplay:r}}();function y(){function t(){return!0===d.areAllShipsSunk()||!0===u.areAllShipsSunk()}function e(t){g.createEndGamePopup(t),g.removeFieldsEventListeners()}return{startGame:function(){f.setPlayersTurn(!0),m.setPlayersTurn(!1),u.placeShipsRandomly(5),g.renderGameboards(d.getBoard(),u.getBoard())},play:function(n,o){const i=f.getPlayersTurn(),r=m.getPlayersTurn();if(!0===i?f.attack(u,m,n,o):!0===r&&m.attack(d,f),t()){let t="";!0===d.areAllShipsSunk()&&(t="Player Two"),!0===u.areAllShipsSunk()&&(t="Player One"),e(t)}},endGame:e,isGameFinished:t,initGameboards:function(){const t=g.playerOneDisplay,e=g.playerTwoDisplay;d=n(),u=n(),d.initGameboard(),u.initGameboard(),t.board=d.getBoard(),e.board=u.getBoard(),g.renderGameboards(d.getBoard(),u.getBoard())},getPlayerOneGameboard:p,getPlayerTwoGameboard:h}}y().initGameboards()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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akYsV0FBWWtGLEVBQW1CbEYsV0FDekUsRUF5Q0VzSCxLQXZDRixTQUFjcEgsRUFBR0MsR0FDZixNQUFNa0osRUFBZ0JoRSxFQUFVekIsaUJBQzFCMEYsRUFBZ0JoRSxFQUFVMUIsaUJBUWhDLElBTnNCLElBQWxCeUYsRUFDRmhFLEVBQVV2QixPQUFPb0IsRUFBb0JJLEVBQVdwRixFQUFHQyxJQUN4QixJQUFsQm1KLEdBQ1RoRSxFQUFVeEIsT0FBT21CLEVBQW9CSSxHQUduQ2tDLElBQWtCLENBQ3BCLElBQUlxQixFQUFTLElBQ2dDLElBQXpDM0QsRUFBbUI5QyxvQkFDckJ5RyxFQUFTLGVBRWtDLElBQXpDMUQsRUFBbUIvQyxvQkFDckJ5RyxFQUFTLGNBRVhRLEVBQVFSLEVBQ1YsQ0FDRixFQW9CRVEsVUFDQTdCLGlCQUNBd0IsZUE5REYsV0FDRSxNQUFNakQsRUFBbUJQLEVBQUlPLGlCQUN2QkMsRUFBbUJSLEVBQUlRLGlCQUM3QmQsRUFBcUJuRixJQUNyQm9GLEVBQXFCcEYsSUFDckJtRixFQUFtQnJELGdCQUNuQnNELEVBQW1CdEQsZ0JBQ25Ca0UsRUFBaUIvRixNQUFRa0YsRUFBbUJqRixXQUM1QytGLEVBQWlCaEcsTUFBUW1GLEVBQW1CbEYsV0FDNUN1RixFQUFJMkIsaUJBQWlCakMsRUFBbUJqRixXQUFZa0YsRUFBbUJsRixXQUN6RSxFQXFERW1GLHdCQUNBQyx3QkFFSixDRTlFdUJNLElBR1JxRCxnQiIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvc2hpcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2dhbWVib2FyZC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2FpLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvcGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZ2FtZS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2RvbS5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgc2hpcEZhY3RvcnkgPSAobGVuZ3RoKSA9PiB7XG4gIFxuICBsZXQgbnVtYmVyT2ZIaXRzID0gMDtcblxuICBjb25zdCBnZXRMZW5ndGggPSAoKSA9PiBsZW5ndGg7XG4gIGNvbnN0IGdldE51bWJlck9mSGl0cyA9ICgpID0+IG51bWJlck9mSGl0c1xuXG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBudW1iZXJPZkhpdHMgKz0gMVxuICAgIHJldHVybiBudW1iZXJPZkhpdHNcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiB7XG4gICAgaWYgKG51bWJlck9mSGl0cyA9PT0gbGVuZ3RoKSByZXR1cm4gdHJ1ZTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRMZW5ndGgsXG4gICAgaGl0LFxuICAgIGlzU3VuayxcbiAgICBnZXROdW1iZXJPZkhpdHNcbiAgfTtcbn07XG5cbmNvbnN0IHNoaXAgPSBzaGlwRmFjdG9yeSgxKTtcbnNoaXAuaGl0KCk7XG5cbmNvbnNvbGUubG9nKHNoaXAuZ2V0TGVuZ3RoKCkpO1xuZXhwb3J0IHsgc2hpcEZhY3RvcnkgfTtcbiIsImltcG9ydCB7IHNoaXBGYWN0b3J5IH0gZnJvbSBcIi4vc2hpcC5qc1wiO1xuXG5leHBvcnQgY29uc3QgZ2FtZWJvYXJkRmFjdG9yeSA9ICgpID0+IHtcbiAgY29uc3QgYm9hcmQgPSBbXTtcblxuICBjb25zdCBnZXRCb2FyZCA9ICgpID0+IGJvYXJkO1xuXG4gIGZ1bmN0aW9uIGNyZWF0ZUZpZWxkKHgsIHkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcG9zaXRpb246IFt4LCB5XSxcbiAgICAgIG9jY3VwaWVkQnlTaGlwOiBmYWxzZSxcbiAgICAgIGhpdDogZmFsc2UsXG4gICAgICBzaGlwOiBudWxsLFxuICAgICAgYm9hcmQ6IGdldEJvYXJkKCksXG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGluaXRHYW1lYm9hcmQoKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICBjb25zdCBhcnIgPSBbXTtcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGorKykge1xuICAgICAgICBhcnIucHVzaChjcmVhdGVGaWVsZChpLCBqKSk7XG4gICAgICB9XG4gICAgICBib2FyZC5wdXNoKGFycik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcHJpbnRCb2FyZCgpIHtcbiAgICBib2FyZC5mb3JFYWNoKChyb3cpID0+IHtcbiAgICAgIGxldCBzdHJpbmcgPSBcIlwiO1xuICAgICAgcm93LmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICAgIGlmICghZmllbGQub2NjdXBpZWRCeVNoaXAgJiYgIWZpZWxkLmhpdCkge1xuICAgICAgICAgIHN0cmluZyArPSBgfCAke2ZpZWxkLnBvc2l0aW9ufSB8YDtcbiAgICAgICAgfSBlbHNlIGlmICghZmllbGQub2NjdXBpZWRCeVNoaXAgJiYgZmllbGQuaGl0KSB7XG4gICAgICAgICAgc3RyaW5nICs9IGB8ICAtICB8YDtcbiAgICAgICAgfSBlbHNlIGlmIChmaWVsZC5vY2N1cGllZEJ5U2hpcCAmJiAhZmllbGQuaGl0KSB7XG4gICAgICAgICAgc3RyaW5nICs9IFwifCAgTyAgfFwiO1xuICAgICAgICB9IGVsc2UgaWYgKGZpZWxkLm9jY3VwaWVkQnlTaGlwICYmIGZpZWxkLmhpdCkge1xuICAgICAgICAgIHN0cmluZyArPSBcInwgIFggIHxcIjtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBjb25zb2xlLmxvZyhzdHJpbmcpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZmluZE5laWdoYm91ckZpZWxkcyh0YXJnZXRGaWVsZHMpIHtcbiAgICBpZiAoIXRhcmdldEZpZWxkcykgcmV0dXJuIGZhbHNlO1xuICAgIGNvbnN0IGJvYXJkID0gZ2V0Qm9hcmQoKTtcbiAgICBsZXQgZHVwbGljYXRlZE5laWdoYm91cnMgPSBbXTtcbiAgICBjb25zdCBuZWlnaGJvdXJzID0gW107XG4gICAgY29uc3QgcG9zc2JpbGVOZWlnaGJvdXJzID0gW107XG5cbiAgICB0YXJnZXRGaWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgIGNvbnN0IHggPSBmaWVsZC5wb3NpdGlvblswXTtcbiAgICAgIGNvbnN0IHkgPSBmaWVsZC5wb3NpdGlvblsxXTtcblxuICAgICAgLy8gYWxsIHRoZSBwb3NzaWJsZSBuZWlnaGJvdXIgZmllbGRzXG4gICAgICBjb25zdCBwb3NzaWJsZU5laWdoYm91cnNDb29yZGluYXRlcyA9IFtcbiAgICAgICAgW3ggLSAxLCB5IC0gMV0sXG4gICAgICAgIFt4IC0gMSwgeV0sXG4gICAgICAgIFt4IC0gMSwgeSArIDFdLFxuICAgICAgICBbeCwgeSArIDFdLFxuICAgICAgICBbeCArIDEsIHkgKyAxXSxcbiAgICAgICAgW3ggKyAxLCB5XSxcbiAgICAgICAgW3ggKyAxLCB5IC0gMV0sXG4gICAgICAgIFt4LCB5IC0gMV0sXG4gICAgICBdO1xuXG4gICAgICAvLyBwdXNoIHRoZSBuZWlnaGJvdXIgZmllbGRzIHRoYXQgYXJlIG5vdCBvdXQgb2YgYm91bmRzXG4gICAgICBwb3NzaWJsZU5laWdoYm91cnNDb29yZGluYXRlcy5mb3JFYWNoKChjb29yZGluYXRlKSA9PiB7XG4gICAgICAgIGlmIChpc091dE9mQm91bmQoY29vcmRpbmF0ZVswXSwgY29vcmRpbmF0ZVsxXSkgPT09IGZhbHNlKVxuICAgICAgICAgIHBvc3NiaWxlTmVpZ2hib3Vycy5wdXNoKGJvYXJkW2Nvb3JkaW5hdGVbMF1dW2Nvb3JkaW5hdGVbMV1dKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gYWRkIG9ubHkgbmVpZ2hib3VycyB0aGF0IGFyZSBub3QgaW5jbHVkZWQgaW4gdGhlIHRhcmdldCBmaWVsZHMgYXJyYXlcblxuICAgIGR1cGxpY2F0ZWROZWlnaGJvdXJzID0gcG9zc2JpbGVOZWlnaGJvdXJzLmZpbHRlcihcbiAgICAgIChuZWlnaGJvdXIpID0+IHRhcmdldEZpZWxkcy5pbmNsdWRlcyhuZWlnaGJvdXIpID09PSBmYWxzZSxcbiAgICApO1xuXG4gICAgZHVwbGljYXRlZE5laWdoYm91cnMuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgIGlmICghbmVpZ2hib3Vycy5pbmNsdWRlcyhmaWVsZCkpIG5laWdoYm91cnMucHVzaChmaWVsZCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbmVpZ2hib3VycztcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpbmRUYXJnZXRGaWVsZHMoc2hpcExlbmd0aCwgeCwgeSwgZGlyZWN0aW9uLCBib2FyZCkge1xuICAgIGNvbnN0IHRhcmdldEZpZWxkcyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoZGlyZWN0aW9uID09PSBcImhvcml6b250YWxcIikge1xuICAgICAgICBpZiAoaXNPdXRPZkJvdW5kKHgsIHkgKyBpKSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0YXJnZXRGaWVsZHMucHVzaChib2FyZFt4XVt5ICsgaV0pO1xuICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09IFwidmVydGljYWxcIikge1xuICAgICAgICBpZiAoaXNPdXRPZkJvdW5kKHggKyBpLCB5KSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0YXJnZXRGaWVsZHMucHVzaChib2FyZFt4ICsgaV1beV0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGFyZ2V0RmllbGRzO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNPdXRPZkJvdW5kKHgsIHkpIHtcbiAgICBpZiAoeCA8IDAgfHwgeCA+IDkgfHwgeSA8IDAgfHwgeSA+IDkpIHJldHVybiB0cnVlO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNoZWNrSWZGaWVsZE9jY3VwaWVkKGZpZWxkKSB7XG4gICAgcmV0dXJuIGZpZWxkLm9jY3VwaWVkQnlTaGlwID09PSB0cnVlO1xuICB9XG5cbiAgZnVuY3Rpb24gY2FuU2hpcEJlUGxhY2VkKHRhcmdldEZpZWxkcywgbmVpZ2hib3VyRmllbGRzKSB7XG4gICAgaWYgKCF0YXJnZXRGaWVsZHMpIHJldHVybiBmYWxzZTtcblxuICAgIC8vIGlmIGZpZWxkcyBhcmUgYWxyZWFkeSBvY2N1cGllZCwgb3IgbmVpZ2hib3VyIGZpZWxkcyBhcmUgb2NjdXBpZWQsIHJldHVybiBmYWxzZVxuICAgIGlmIChcbiAgICAgIHRhcmdldEZpZWxkcy5zb21lKGNoZWNrSWZGaWVsZE9jY3VwaWVkKSB8fFxuICAgICAgbmVpZ2hib3VyRmllbGRzLnNvbWUoY2hlY2tJZkZpZWxkT2NjdXBpZWQpXG4gICAgKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBmdW5jdGlvbiBwbGFjZVNoaXAoc2hpcExlbmd0aCwgeCwgeSwgZGlyZWN0aW9uID0gXCJob3Jpem9udGFsXCIpIHtcbiAgICBjb25zdCBib2FyZCA9IGdldEJvYXJkKCk7XG4gICAgY29uc3QgdGFyZ2V0RmllbGRzID0gZmluZFRhcmdldEZpZWxkcyhzaGlwTGVuZ3RoLCB4LCB5LCBkaXJlY3Rpb24sIGJvYXJkKTtcbiAgICBjb25zdCBuZWlnaGJvdXJGaWVsZHMgPSBmaW5kTmVpZ2hib3VyRmllbGRzKHRhcmdldEZpZWxkcyk7XG4gICAgaWYgKCFjYW5TaGlwQmVQbGFjZWQodGFyZ2V0RmllbGRzLCBuZWlnaGJvdXJGaWVsZHMpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IHNoaXAgPSBzaGlwRmFjdG9yeShzaGlwTGVuZ3RoKTtcblxuICAgIHRhcmdldEZpZWxkcy5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgZmllbGQub2NjdXBpZWRCeVNoaXAgPSB0cnVlO1xuICAgICAgZmllbGQuc2hpcCA9IHNoaXA7XG4gICAgfSk7XG4gICAgcmV0dXJuIHNoaXA7XG4gIH1cblxuICBmdW5jdGlvbiBwbGFjZVNoaXBzUmFuZG9tbHkoYW1vdW50KSB7XG4gICAgY29uc3QgcGxhY2VkU2hpcHMgPSBbXTtcbiAgICBsZXQgY3VycmVudFNoaXBMZW5naHQgPSAxO1xuICAgIHdoaWxlIChwbGFjZWRTaGlwcy5sZW5ndGggIT09IGFtb3VudCkge1xuICAgICAgY29uc3QgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICBjb25zdCByYW5kb21EaXJlY3Rpb24gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKTtcbiAgICAgIGxldCBkaXJlY3Rpb247XG5cbiAgICAgIHN3aXRjaCAocmFuZG9tRGlyZWN0aW9uKSB7XG4gICAgICAgIGNhc2UgMTpcbiAgICAgICAgICBkaXJlY3Rpb24gPSBcInZlcnRpY2FsXCI7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMDpcbiAgICAgICAgICBkaXJlY3Rpb24gPSBcImhvcml6b250YWxcIjtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc2hpcCA9IHBsYWNlU2hpcChjdXJyZW50U2hpcExlbmdodCwgeCwgeSwgZGlyZWN0aW9uKTtcblxuICAgICAgaWYgKHNoaXAgIT09IGZhbHNlKSB7XG4gICAgICAgIHBsYWNlZFNoaXBzLnB1c2goc2hpcCk7XG4gICAgICAgIGN1cnJlbnRTaGlwTGVuZ2h0Kys7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcmVjZWl2ZUF0dGFjayh4LCB5KSB7XG4gICAgaWYgKGlzT3V0T2ZCb3VuZCh4LCB5KSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGlmIChib2FyZFt4XVt5XS5oaXQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoYm9hcmRbeF1beV0uc2hpcCAhPT0gbnVsbCkgYm9hcmRbeF1beV0uc2hpcC5oaXQoKTtcblxuICAgIGJvYXJkW3hdW3ldLmhpdCA9IHRydWU7XG4gICAgLy8gcHJpbnRCb2FyZCgpO1xuICAgIHJldHVybiBib2FyZFt4XVt5XVxuICB9XG5cbiAgZnVuY3Rpb24gYXJlQWxsU2hpcHNTdW5rKCkge1xuICAgIGNvbnN0IGZpZWxkc09jY3VwaWVkQnlTaGlwcyA9IFtdO1xuICAgIGJvYXJkLmZvckVhY2goKHJvdykgPT4ge1xuICAgICAgY29uc3Qgb2NjdXBpZWQgPSByb3cuZmlsdGVyKChmaWVsZCkgPT4ge1xuICAgICAgICByZXR1cm4gZmllbGQub2NjdXBpZWRCeVNoaXAgPT09IHRydWU7XG4gICAgICB9KTtcbiAgICAgIGZpZWxkc09jY3VwaWVkQnlTaGlwcy5wdXNoKC4uLm9jY3VwaWVkKTtcbiAgICB9KTtcbiAgICBpZiAoZmllbGRzT2NjdXBpZWRCeVNoaXBzLmV2ZXJ5KChmaWVsZCkgPT4gZmllbGQuaGl0ID09PSB0cnVlKSkgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBjcmVhdGVGaWVsZCxcbiAgICBpbml0R2FtZWJvYXJkLFxuICAgIHByaW50Qm9hcmQsXG4gICAgZ2V0Qm9hcmQsXG4gICAgZmluZFRhcmdldEZpZWxkcyxcbiAgICBmaW5kTmVpZ2hib3VyRmllbGRzLFxuICAgIGNhblNoaXBCZVBsYWNlZCxcbiAgICBwbGFjZVNoaXAsXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBhcmVBbGxTaGlwc1N1bmssXG4gICAgcGxhY2VTaGlwc1JhbmRvbWx5LFxuICB9O1xufTtcbiIsImxldCBoaXRzID0gMDtcbmxldCBoaXRlZFNoaXA7XG5sZXQgaGl0ZWRGaWVsZDtcbmxldCB0ZW1wSGl0ZWRGaWVsZDtcblxuZnVuY3Rpb24gaXNNb3ZlTGVnYWwoeCwgeSwgYm9hcmQpIHtcbiAgaWYgKHggPiA5IHx8IHggPCAwIHx8IHkgPCAwIHx8IHkgPiA5KSByZXR1cm4gZmFsc2U7XG4gIGlmIChib2FyZFt4XVt5XS5oaXQgPT09IHRydWUpIHJldHVybiBmYWxzZTtcbiAgcmV0dXJuIHRydWU7XG59XG5mdW5jdGlvbiBmaW5kUmFuZG9tTW92ZSgpIHtcbiAgY29uc3QgeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgY29uc3QgeSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcblxuICByZXR1cm4gW3gsIHldO1xufVxuXG5mdW5jdGlvbiBmaW5kRm91ckFkamFjZW50RmllbGRzKGZpZWxkLCBib2FyZCkge1xuICBjb25zdCB4ID0gZmllbGQucG9zaXRpb25bMF07XG4gIGNvbnN0IHkgPSBmaWVsZC5wb3NpdGlvblsxXTtcbiAgY29uc3QgcG9zc2libGVGaWVsZHMgPSBbXG4gICAgW3gsIHkgKyAxXSxcbiAgICBbeCwgeSAtIDFdLFxuICAgIFt4ICsgMSwgeV0sXG4gICAgW3ggLSAxLCB5XSxcbiAgXTtcbiAgY29uc3QgdGFyZ2V0RmllbGRzID0gcG9zc2libGVGaWVsZHMuZmlsdGVyKChmaWVsZCkgPT5cbiAgICBpc01vdmVMZWdhbChmaWVsZFswXSwgZmllbGRbMV0sIGJvYXJkLmdldEJvYXJkKCkpLFxuICApO1xuICByZXR1cm4gdGFyZ2V0RmllbGRzO1xufVxuXG5mdW5jdGlvbiBmaW5kQWRqYWNlbnRGaWVsZE9uQXhpcyhmaWVsZE9uZSwgZmllbGRUd28sIGJvYXJkKSB7XG4gIGxldCBhID0gZmllbGRPbmUucG9zaXRpb25bMF07XG4gIGxldCBiID0gZmllbGRPbmUucG9zaXRpb25bMV07XG4gIGxldCB4ID0gZmllbGRUd28ucG9zaXRpb25bMF07XG4gIGxldCB5ID0gZmllbGRUd28ucG9zaXRpb25bMV07XG4gIGNvbnN0IHBvc3NpYmxlRmllbGRzID0gW107XG4gIGxldCBheGlzO1xuXG4gIGlmIChhID09PSB4KSB7XG4gICAgYXhpcyA9IFwiaG9yaXpvbnRhbFwiO1xuICB9IGVsc2UgaWYgKGIgPT09IHkpIHtcbiAgICBheGlzID0gXCJ2ZXJ0aWNhbFwiO1xuICB9XG4gIGlmIChheGlzID09PSBcImhvcml6b250YWxcIikge1xuICAgIGlmIChiID4geSkge1xuICAgICAgYSA9IGZpZWxkVHdvLnBvc2l0aW9uWzBdO1xuICAgICAgYiA9IGZpZWxkVHdvLnBvc2l0aW9uWzFdO1xuICAgICAgeCA9IGZpZWxkT25lLnBvc2l0aW9uWzBdO1xuICAgICAgeSA9IGZpZWxkT25lLnBvc2l0aW9uWzFdO1xuICAgIH1cbiAgICBjb25zdCB0YXJnZXRGaWVsZE9uZSA9IFthLCBiIC0gMV07XG4gICAgY29uc3QgdGFyZ2V0RmllbGRUd28gPSBbeCwgeSArIDFdO1xuICAgIHBvc3NpYmxlRmllbGRzLnB1c2godGFyZ2V0RmllbGRPbmUsIHRhcmdldEZpZWxkVHdvKTtcbiAgfSBlbHNlIGlmIChheGlzID09PSBcInZlcnRpY2FsXCIpIHtcbiAgICBpZiAoYSA+IHgpIHtcbiAgICAgIGEgPSBmaWVsZFR3by5wb3NpdGlvblswXTtcbiAgICAgIGIgPSBmaWVsZFR3by5wb3NpdGlvblsxXTtcbiAgICAgIHggPSBmaWVsZE9uZS5wb3NpdGlvblswXTtcbiAgICAgIHkgPSBmaWVsZE9uZS5wb3NpdGlvblsxXTtcbiAgICB9XG4gICAgY29uc3QgdGFyZ2V0RmllbGRPbmUgPSBbYSAtIDEsIGJdO1xuICAgIGNvbnN0IHRhcmdldEZpZWxkVHdvID0gW3ggKyAxLCB5XTtcbiAgICBwb3NzaWJsZUZpZWxkcy5wdXNoKHRhcmdldEZpZWxkT25lLCB0YXJnZXRGaWVsZFR3byk7XG4gIH1cblxuICBjb25zdCB0YXJnZXRGaWVsZHMgPSBwb3NzaWJsZUZpZWxkcy5maWx0ZXIoKGZpZWxkKSA9PiB7XG4gICAgcmV0dXJuIGlzTW92ZUxlZ2FsKGZpZWxkWzBdLCBmaWVsZFsxXSwgYm9hcmQuZ2V0Qm9hcmQoKSk7XG4gIH0pO1xuICByZXR1cm4gdGFyZ2V0RmllbGRzO1xufVxuXG4vLyBOYSByYXppZSBhaSBwbyAxIHRyYWZpZW5pdSB1ZGVyemEgdyBqZWRlbiB6IGN6dGVyZWNoIHNsb3TDs3cgdyBva8OzxYJcbmZ1bmN0aW9uIGFpQXR0YWNrKGJvYXJkKSB7XG4gIGlmIChoaXRlZFNoaXAgIT09IHVuZGVmaW5lZCAmJiBoaXRlZFNoaXAuaXNTdW5rKCkgPT09IHRydWUpIHtcbiAgICBoaXRzID0gMDtcbiAgICBoaXRlZFNoaXAgPSB1bmRlZmluZWQ7XG4gIH1cbiAgaWYgKGhpdHMgPT09IDEpIHtcbiAgICBjb25zdCBhZGphY2VudEZpZWxkcyA9IGZpbmRGb3VyQWRqYWNlbnRGaWVsZHMoaGl0ZWRGaWVsZCwgYm9hcmQpO1xuICAgIGNvbnN0IHJhbmRvbU51bSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGFkamFjZW50RmllbGRzLmxlbmd0aCk7XG4gICAgY29uc3QgcmFuZG9tTW92ZSA9IGFkamFjZW50RmllbGRzW3JhbmRvbU51bV07XG4gICAgdGVtcEhpdGVkRmllbGQgPSBib2FyZC5yZWNlaXZlQXR0YWNrKC4uLnJhbmRvbU1vdmUpO1xuICAgIGlmICh0ZW1wSGl0ZWRGaWVsZC5zaGlwICE9PSBudWxsKSB7XG4gICAgICBoaXRzICs9IDE7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChoaXRzID4gMSkge1xuICAgIGlmIChcbiAgICAgIHRlbXBIaXRlZEZpZWxkLnBvc2l0aW9uWzBdID4gaGl0ZWRGaWVsZC5wb3NpdGlvblswXSB8fFxuICAgICAgdGVtcEhpdGVkRmllbGRbMV0gPiBoaXRlZEZpZWxkWzFdXG4gICAgKSB7XG4gICAgICBsZXQgdGVtcCA9IGhpdGVkRmllbGQ7XG4gICAgICBoaXRlZEZpZWxkID0gdGVtcEhpdGVkRmllbGQ7XG4gICAgICB0ZW1wSGl0ZWRGaWVsZCA9IHRlbXA7XG4gICAgfVxuICAgIGNvbnN0IHRhcmdldEZpZWxkcyA9IGZpbmRBZGphY2VudEZpZWxkT25BeGlzKFxuICAgICAgaGl0ZWRGaWVsZCxcbiAgICAgIHRlbXBIaXRlZEZpZWxkLFxuICAgICAgYm9hcmQsXG4gICAgKTtcbiAgICBjb25zdCByYW5kb21OdW0gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0YXJnZXRGaWVsZHMubGVuZ3RoKTtcbiAgICBjb25zdCByYW5kb21Nb3ZlID0gdGFyZ2V0RmllbGRzW3JhbmRvbU51bV07XG4gICAgY29uc3QgbmV3SGl0ZWRGaWVsZCA9IGJvYXJkLnJlY2VpdmVBdHRhY2soLi4ucmFuZG9tTW92ZSk7XG4gICAgaWYgKFxuICAgICAgKG5ld0hpdGVkRmllbGQuc2hpcCAhPT0gbnVsbCAmJlxuICAgICAgICBuZXdIaXRlZEZpZWxkLnBvc2l0aW9uWzBdIDwgaGl0ZWRGaWVsZC5wb3NpdGlvblswXSkgfHxcbiAgICAgIG5ld0hpdGVkRmllbGQucG9zaXRpb25bMV0gPCBoaXRlZEZpZWxkLnBvc2l0aW9uWzFdXG4gICAgKSB7XG4gICAgICB0ZW1wSGl0ZWRGaWVsZCA9IG5ld0hpdGVkRmllbGQ7XG4gICAgICBoaXRzICs9IDE7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIG5ld0hpdGVkRmllbGQuc2hpcCAhPT0gbnVsbCAmJlxuICAgICAgKG5ld0hpdGVkRmllbGQucG9zaXRpb25bMF0gPiBoaXRlZEZpZWxkLnBvc2l0aW9uWzBdIHx8XG4gICAgICAgIG5ld0hpdGVkRmllbGQucG9zaXRpb25bMV0gPiBoaXRlZEZpZWxkLnBvc2l0aW9uWzFdKVxuICAgICkge1xuICAgICAgaGl0ZWRGaWVsZCA9IG5ld0hpdGVkRmllbGQ7XG4gICAgICBoaXRzICs9IDE7XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuICBsZXQgcmFuZG9tTW92ZSA9IGZpbmRSYW5kb21Nb3ZlKCk7XG4gIHdoaWxlIChcbiAgICBpc01vdmVMZWdhbChyYW5kb21Nb3ZlWzBdLCByYW5kb21Nb3ZlWzFdLCBib2FyZC5nZXRCb2FyZCgpKSA9PT0gZmFsc2VcbiAgKSB7XG4gICAgcmFuZG9tTW92ZSA9IGZpbmRSYW5kb21Nb3ZlKCk7XG4gIH1cbiAgaGl0ZWRGaWVsZCA9IGJvYXJkLnJlY2VpdmVBdHRhY2soLi4ucmFuZG9tTW92ZSk7XG4gIGlmIChoaXRlZEZpZWxkLnNoaXAgIT09IG51bGwpIHtcbiAgICBoaXRlZFNoaXAgPSBoaXRlZEZpZWxkLnNoaXA7XG4gICAgaGl0cyArPSAxO1xuICB9XG59XG5leHBvcnQgeyBhaUF0dGFjaywgZmluZEFkamFjZW50RmllbGRPbkF4aXMgfTtcbiIsImltcG9ydCB7IGFpQXR0YWNrIH0gZnJvbSBcIi4vYWkuanNcIjtcblxuZXhwb3J0IGNvbnN0IHBsYXllciA9IChhaSwgaXNJdFBsYXllcnNUdXJuKSA9PiB7XG4gIGNvbnN0IGlzQWkgPSBhaTtcbiAgbGV0IHBsYXllcnNUdXJuID0gaXNJdFBsYXllcnNUdXJuO1xuICBjb25zdCBnZXRQbGF5ZXJzVHVybiA9ICgpID0+IHBsYXllcnNUdXJuO1xuICBjb25zdCBzZXRQbGF5ZXJzVHVybiA9ICh2YWx1ZSkgPT4ge1xuICAgIHBsYXllcnNUdXJuID0gdmFsdWVcbiAgfVxuXG4gIGZ1bmN0aW9uIGNoYW5nZVBsYXllcnNUdXJuKHNlY29uZFBsYXllcikge1xuICAgIGNvbnN0IHNlY29uZFBsYXllclR1cm4gPSBzZWNvbmRQbGF5ZXIuZ2V0UGxheWVyc1R1cm4oKTtcbiAgICBzd2l0Y2ggKHBsYXllcnNUdXJuKSB7XG4gICAgICBjYXNlIHRydWU6XG4gICAgICAgIHBsYXllcnNUdXJuID0gZmFsc2U7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBmYWxzZTpcbiAgICAgICAgcGxheWVyc1R1cm4gPSB0cnVlO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgc3dpdGNoIChzZWNvbmRQbGF5ZXJUdXJuKSB7XG4gICAgICBjYXNlIHRydWU6XG4gICAgICAgIHNlY29uZFBsYXllci5zZXRQbGF5ZXJzVHVybihmYWxzZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBmYWxzZTpcbiAgICAgICAgc2Vjb25kUGxheWVyLnNldFBsYXllcnNUdXJuKHRydWUpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgXG4gIH1cblxuICBmdW5jdGlvbiBhdHRhY2soYm9hcmQsIGF0dGFja2VkUGxheWVyLCB4LCB5KSB7XG4gICAgY2hhbmdlUGxheWVyc1R1cm4oYXR0YWNrZWRQbGF5ZXIpO1xuICAgIGlmIChpc0FpKSB7XG4gICAgICBhaUF0dGFjayhib2FyZCwgYXR0YWNrZWRQbGF5ZXIpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYm9hcmQucmVjZWl2ZUF0dGFjayh4LCB5KTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBmaW5kUmFuZG9tTW92ZSgpIHtcbiAgICBjb25zdCB4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG5cbiAgICByZXR1cm4gW3gsIHldO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNNb3ZlTGVnYWwoeCwgeSwgYm9hcmQpIHtcbiAgICBpZiAoYm9hcmRbeF1beV0uaGl0ID09PSB0cnVlKSByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuXG5cbiAgcmV0dXJuIHtcbiAgICBhdHRhY2ssXG4gICAgZ2V0UGxheWVyc1R1cm4sXG4gICAgc2V0UGxheWVyc1R1cm4sXG4gICAgaXNNb3ZlTGVnYWwsXG4gICAgY2hhbmdlUGxheWVyc1R1cm4sXG4gICAgZmluZFJhbmRvbU1vdmVcbiAgfTtcbn07XG4iLCJpbXBvcnQgeyBnYW1lYm9hcmRGYWN0b3J5IH0gZnJvbSBcIi4vZ2FtZWJvYXJkLmpzXCI7XG5pbXBvcnQgeyBwbGF5ZXIgfSBmcm9tIFwiLi9wbGF5ZXIuanNcIjtcbmltcG9ydCB7IGRvbUNvbnRyb2xsZXIgfSBmcm9tIFwiLi9kb20uanNcIjtcblxubGV0IHBsYXllck9uZUdhbWVib2FyZCBcbmxldCBwbGF5ZXJUd29HYW1lYm9hcmQgXG5jb25zdCBnZXRQbGF5ZXJPbmVHYW1lYm9hcmQgPSAoKSA9PiBwbGF5ZXJPbmVHYW1lYm9hcmRcbmNvbnN0IGdldFBsYXllclR3b0dhbWVib2FyZCA9ICgpID0+IHBsYXllclR3b0dhbWVib2FyZFxuY29uc3QgcGxheWVyT25lID0gcGxheWVyKGZhbHNlLCB0cnVlKTtcbmNvbnN0IHBsYXllclR3byA9IHBsYXllcih0cnVlLCBmYWxzZSk7XG5jb25zdCBkb20gPSBkb21Db250cm9sbGVyKFxuICBwbGF5ZXJPbmUsXG4gIHBsYXllclR3byxcbik7XG5leHBvcnQgZnVuY3Rpb24gZ2FtZSgpIHtcbiAgZnVuY3Rpb24gaW5pdEdhbWVib2FyZHMoKSB7XG4gICAgY29uc3QgcGxheWVyT25lRGlzcGxheSA9IGRvbS5wbGF5ZXJPbmVEaXNwbGF5XG4gICAgY29uc3QgcGxheWVyVHdvRGlzcGxheSA9IGRvbS5wbGF5ZXJUd29EaXNwbGF5XG4gICAgcGxheWVyT25lR2FtZWJvYXJkID0gZ2FtZWJvYXJkRmFjdG9yeSgpO1xuICAgIHBsYXllclR3b0dhbWVib2FyZCA9IGdhbWVib2FyZEZhY3RvcnkoKTtcbiAgICBwbGF5ZXJPbmVHYW1lYm9hcmQuaW5pdEdhbWVib2FyZCgpO1xuICAgIHBsYXllclR3b0dhbWVib2FyZC5pbml0R2FtZWJvYXJkKCk7XG4gICAgcGxheWVyT25lRGlzcGxheS5ib2FyZCA9IHBsYXllck9uZUdhbWVib2FyZC5nZXRCb2FyZCgpXG4gICAgcGxheWVyVHdvRGlzcGxheS5ib2FyZCA9IHBsYXllclR3b0dhbWVib2FyZC5nZXRCb2FyZCgpXG4gICAgZG9tLnJlbmRlckdhbWVib2FyZHMocGxheWVyT25lR2FtZWJvYXJkLmdldEJvYXJkKCksIHBsYXllclR3b0dhbWVib2FyZC5nZXRCb2FyZCgpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0YXJ0R2FtZSgpIHtcbiAgICBwbGF5ZXJPbmUuc2V0UGxheWVyc1R1cm4odHJ1ZSk7XG4gICAgcGxheWVyVHdvLnNldFBsYXllcnNUdXJuKGZhbHNlKTtcblxuICAgIHBsYXllclR3b0dhbWVib2FyZC5wbGFjZVNoaXBzUmFuZG9tbHkoNSk7XG4gICAgZG9tLnJlbmRlckdhbWVib2FyZHMocGxheWVyT25lR2FtZWJvYXJkLmdldEJvYXJkKCksIHBsYXllclR3b0dhbWVib2FyZC5nZXRCb2FyZCgpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXkoeCwgeSkge1xuICAgIGNvbnN0IHBsYXllck9uZVR1cm4gPSBwbGF5ZXJPbmUuZ2V0UGxheWVyc1R1cm4oKTtcbiAgICBjb25zdCBwbGF5ZXJUd29UdXJuID0gcGxheWVyVHdvLmdldFBsYXllcnNUdXJuKCk7XG5cbiAgICBpZiAocGxheWVyT25lVHVybiA9PT0gdHJ1ZSkge1xuICAgICAgcGxheWVyT25lLmF0dGFjayhwbGF5ZXJUd29HYW1lYm9hcmQsIHBsYXllclR3bywgeCwgeSk7XG4gICAgfSBlbHNlIGlmIChwbGF5ZXJUd29UdXJuID09PSB0cnVlKSB7XG4gICAgICBwbGF5ZXJUd28uYXR0YWNrKHBsYXllck9uZUdhbWVib2FyZCwgcGxheWVyT25lKTtcbiAgICB9XG5cbiAgICBpZiAoaXNHYW1lRmluaXNoZWQoKSkge1xuICAgICAgbGV0IHdpbm5lciA9IFwiXCI7XG4gICAgICBpZiAocGxheWVyT25lR2FtZWJvYXJkLmFyZUFsbFNoaXBzU3VuaygpID09PSB0cnVlKSB7XG4gICAgICAgIHdpbm5lciA9IFwiUGxheWVyIFR3b1wiO1xuICAgICAgfVxuICAgICAgaWYgKHBsYXllclR3b0dhbWVib2FyZC5hcmVBbGxTaGlwc1N1bmsoKSA9PT0gdHJ1ZSkge1xuICAgICAgICB3aW5uZXIgPSBcIlBsYXllciBPbmVcIjtcbiAgICAgIH1cbiAgICAgIGVuZEdhbWUod2lubmVyKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBpc0dhbWVGaW5pc2hlZCgpIHtcbiAgICBpZiAoXG4gICAgICBwbGF5ZXJPbmVHYW1lYm9hcmQuYXJlQWxsU2hpcHNTdW5rKCkgPT09IHRydWUgfHxcbiAgICAgIHBsYXllclR3b0dhbWVib2FyZC5hcmVBbGxTaGlwc1N1bmsoKSA9PT0gdHJ1ZVxuICAgICkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGVuZEdhbWUod2lubmVyKSB7XG4gICAgZG9tLmNyZWF0ZUVuZEdhbWVQb3B1cCh3aW5uZXIpO1xuICAgIGRvbS5yZW1vdmVGaWVsZHNFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBzdGFydEdhbWUsXG4gICAgcGxheSxcbiAgICBlbmRHYW1lLFxuICAgIGlzR2FtZUZpbmlzaGVkLFxuICAgIGluaXRHYW1lYm9hcmRzLFxuICAgIGdldFBsYXllck9uZUdhbWVib2FyZCxcbiAgICBnZXRQbGF5ZXJUd29HYW1lYm9hcmRcbiAgfTtcbn1cblxuZXhwb3J0IHsgcGxheWVyT25lLCBwbGF5ZXJUd28gfTtcbiIsImltcG9ydCB7IGdhbWUsIHBsYXllck9uZSB9IGZyb20gXCIuL2dhbWUuanNcIjtcbmltcG9ydCB7IGdhbWVib2FyZEZhY3RvcnkgfSBmcm9tIFwiLi9nYW1lYm9hcmQuanNcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGRvbUNvbnRyb2xsZXIoKSB7XG4gIGNvbnN0IGdhbWVib2FyZENvbnRyb2xsZXIgPSBnYW1lYm9hcmRGYWN0b3J5KCk7XG4gIGNvbnN0IGdhbWVDb250cm9sbGVyID0gZ2FtZSgpO1xuICBjb25zdCBtYWluID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIm1haW5cIik7XG4gIGNvbnN0IHBsYXllck9uZURpc3BsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci1vbmUtYm9hcmRcIik7XG4gIGNvbnN0IHBsYXllclR3b0Rpc3BsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci10d28tYm9hcmRcIik7XG4gIGNvbnN0IHN3aXRjaFBvc2l0aW9uQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zd2l0Y2gtcG9zaXRpb25cIik7XG4gIGNvbnN0IGZpZWxkcyA9IFtdO1xuICBsZXQgcGxheWVyT25lR2FtZWJvYXJkID0gZ2FtZUNvbnRyb2xsZXIuZ2V0UGxheWVyT25lR2FtZWJvYXJkKCk7XG4gIGxldCBnYW1lTW9kZSA9IFwiaW5pdFwiO1xuICBsZXQgc2hpcExlbmd0aCA9IDE7XG4gIGxldCB4O1xuICBsZXQgeTtcbiAgbGV0IHBvc2l0aW9uID0gXCJ2ZXJ0aWNhbFwiO1xuXG4gIGZ1bmN0aW9uIHJlbmRlckZpZWxkKGZpZWxkLCBib2FyZERpc3BsYXkpIHtcbiAgICBjb25zdCByZW5kZXJlZEZpZWxkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICByZW5kZXJlZEZpZWxkLmNsYXNzTGlzdC5hZGQoXCJmaWVsZFwiKTtcbiAgICBpZiAoZmllbGQuc2hpcCAhPT0gbnVsbCkge1xuICAgICAgcmVuZGVyZWRGaWVsZC5jbGFzc0xpc3QuYWRkKFwic2hpcFwiKTtcbiAgICB9XG4gICAgaWYgKGZpZWxkLnNoaXAgIT09IG51bGwgJiYgYm9hcmREaXNwbGF5ID09PSBwbGF5ZXJUd29EaXNwbGF5KSB7XG4gICAgICAgIHJlbmRlcmVkRmllbGQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgIH1cbiAgICBpZiAoZmllbGQuc2hpcCAhPT0gbnVsbCAmJiBmaWVsZC5zaGlwLmlzU3VuaygpKSB7XG4gICAgICByZW5kZXJlZEZpZWxkLmNsYXNzTGlzdC5hZGQoXCJzdW5rXCIpO1xuICAgIH1cbiAgICBpZiAoZmllbGQuaGl0ID09PSB0cnVlKSB7XG4gICAgICByZW5kZXJlZEZpZWxkLmNsYXNzTGlzdC5hZGQoXCJoaXRcIik7XG4gICAgfVxuICAgIHJlbmRlcmVkRmllbGQuYm9hcmQgPSBmaWVsZC5ib2FyZDtcbiAgICByZW5kZXJlZEZpZWxkLmZpZWxkID0gZmllbGQ7XG5cbiAgICBpZiAoIWZpZWxkcy5pbmNsdWRlcyhmaWVsZC5wb3N0aW9uKSkge1xuICAgICAgZmllbGRzLnB1c2goZmllbGQucG9zaXRpb24pO1xuICAgIH1cblxuICAgIGlmIChnYW1lTW9kZSA9PT0gXCJpbml0XCIpIHtcbiAgICAgIHJlbmRlcmVkRmllbGQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCBoaWdobGlnaHRUYXJnZXRGaWVsZCk7XG4gICAgICByZW5kZXJlZEZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW91dFwiLCB1bmhpZ2hsaWdodFRhcmdldEZpZWxkcyk7XG4gICAgICByZW5kZXJlZEZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBwbGFjZVNoaXApO1xuICAgICAgcmVuZGVyZWRGaWVsZC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2hhbmdlR2FtZU1vZGUpO1xuICAgIH0gZWxzZSBpZiAoZ2FtZU1vZGUgPT09IFwiZ2FtZVwiKSB7XG4gICAgICByZW5kZXJlZEZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBwbGF5T25DbGljayk7XG4gICAgfVxuXG4gICAgYm9hcmREaXNwbGF5LmFwcGVuZENoaWxkKHJlbmRlcmVkRmllbGQpO1xuXG4gICAgcmV0dXJuIHJlbmRlcmVkRmllbGQ7XG4gIH1cblxuICBmdW5jdGlvbiByZW5kZXJHYW1lYm9hcmQoYm9hcmQsIGJvYXJkRGlzcGxheSkge1xuICAgIGJvYXJkRGlzcGxheS5pbm5lckhUTUwgPSBcIlwiO1xuXG4gICAgYm9hcmQuZm9yRWFjaCgocm93KSA9PiB7XG4gICAgICByb3cuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICAgICAgcmVuZGVyRmllbGQoZmllbGQsIGJvYXJkRGlzcGxheSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbmRlckdhbWVib2FyZHMocGxheWVyT25lR2FtZWJvYXJkLCBwbGF5ZXJUd29HYW1lYm9hcmQpIHtcbiAgICByZW5kZXJHYW1lYm9hcmQocGxheWVyT25lR2FtZWJvYXJkLCBwbGF5ZXJPbmVEaXNwbGF5KTtcbiAgICByZW5kZXJHYW1lYm9hcmQocGxheWVyVHdvR2FtZWJvYXJkLCBwbGF5ZXJUd29EaXNwbGF5KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYXlPbkNsaWNrKGUpIHtcbiAgICAvLyBJZiBjbGlja2VkIGZpZWxkIGlzIG5vdCBvbiBlbmVteSBib2FyZCBvciBpdCBpcyBub3QgaHVtYW4gcGxheWVyIHR1cm46IHJldHVyblxuICAgIGlmIChlLnRhcmdldC5wYXJlbnRFbGVtZW50ICE9PSBwbGF5ZXJUd29EaXNwbGF5KSByZXR1cm47XG4gICAgaWYgKHBsYXllck9uZS5nZXRQbGF5ZXJzVHVybigpICE9PSB0cnVlKSByZXR1cm47XG4gICAgaWYgKGUudGFyZ2V0LmZpZWxkLmhpdCA9PT0gdHJ1ZSkgcmV0dXJuO1xuXG4gICAgY29uc3QgeCA9IGUudGFyZ2V0LmZpZWxkLnBvc2l0aW9uWzBdO1xuICAgIGNvbnN0IHkgPSBlLnRhcmdldC5maWVsZC5wb3NpdGlvblsxXTtcblxuICAgIGdhbWVDb250cm9sbGVyLnBsYXkoeCwgeSk7XG5cbiAgICAvLyBUaGlzIGdhbWUgZW5kaW5nIGNvbmRpdGlvbiBpcyBhbHNvIHByZXNlbnQgaW4gZ2FtZS5qc1xuICAgIGlmIChnYW1lQ29udHJvbGxlci5pc0dhbWVGaW5pc2hlZCgpKSB7XG4gICAgICBjb25zdCBwbGF5ZXJPbmVHYW1lYm9hcmQgPSBnYW1lQ29udHJvbGxlci5nZXRQbGF5ZXJPbmVHYW1lYm9hcmQoKTtcbiAgICAgIGNvbnN0IHBsYXllclR3b0dhbWVib2FyZCA9IGdhbWVDb250cm9sbGVyLmdldFBsYXllclR3b0dhbWVib2FyZCgpO1xuICAgICAgcmVuZGVyR2FtZWJvYXJkcyhcbiAgICAgICAgcGxheWVyT25lR2FtZWJvYXJkLmdldEJvYXJkKCksXG4gICAgICAgIHBsYXllclR3b0dhbWVib2FyZC5nZXRCb2FyZCgpLFxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcmVuZGVyR2FtZWJvYXJkKGUudGFyZ2V0LnBhcmVudEVsZW1lbnQuYm9hcmQsIGUudGFyZ2V0LnBhcmVudEVsZW1lbnQpO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBnYW1lQ29udHJvbGxlci5wbGF5KCk7XG4gICAgICByZW5kZXJHYW1lYm9hcmQocGxheWVyT25lR2FtZWJvYXJkLmdldEJvYXJkKCksIHBsYXllck9uZURpc3BsYXkpO1xuICAgIH0sIFwiMTUwMFwiKTtcbiAgfVxuXG4gIC8vIFN0YXJ0L0VuZCBHYW1lIFBvcHVwc1xuXG4gIGZ1bmN0aW9uIGNyZWF0ZUVuZEdhbWVQb3B1cCh3aW5uZXIpIHtcbiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgbW9kYWwuY2xhc3NMaXN0LmFkZChcImVuZC1nYW1lXCIpO1xuICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbFwiKTtcblxuICAgIGNvbnN0IHRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcbiAgICB0ZXh0LmNsYXNzTGlzdC5hZGQoXCJlbmQtZ2FtZS10ZXh0XCIpO1xuICAgIHRleHQudGV4dENvbnRlbnQgPSBgJHt3aW5uZXJ9IFdvbmA7XG5cbiAgICBjb25zdCBuZXdHYW1lQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICBuZXdHYW1lQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJuZXctZ2FtZS1idXR0b25cIik7XG4gICAgbmV3R2FtZUJ1dHRvbi50ZXh0Q29udGVudCA9IFwiTmV3IEdhbWVcIjtcblxuICAgIG1haW4uYXBwZW5kQ2hpbGQobW9kYWwpO1xuICAgIG1vZGFsLmFwcGVuZENoaWxkKHRleHQpO1xuICAgIG1vZGFsLmFwcGVuZENoaWxkKG5ld0dhbWVCdXR0b24pO1xuXG4gICAgbmV3R2FtZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICByZXNldERpc3BsYXkoKVxuICAgICAgICBzd2l0Y2hQb3NpdGlvbkJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nKVxuICAgIH0pXG4gIH1cblxuICBmdW5jdGlvbiBjcmVhdGVTdGFydEdhbWVQb3B1cCgpIHtcbiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgbW9kYWwuY2xhc3NMaXN0LmFkZChcInN0YXJ0LWdhbWVcIik7XG4gICAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsXCIpO1xuXG4gICAgY29uc3Qgc3RhcnRHYW1lQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICBzdGFydEdhbWVCdXR0b24uY2xhc3NMaXN0LmFkZChcInN0YXJ0LWdhbWUtYnV0dG9uXCIpO1xuICAgIHN0YXJ0R2FtZUJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU3RhcnQgR2FtZVwiO1xuXG4gICAgbWFpbi5hcHBlbmRDaGlsZChtb2RhbCk7XG4gICAgbW9kYWwuYXBwZW5kQ2hpbGQoc3RhcnRHYW1lQnV0dG9uKTtcblxuICAgIHN0YXJ0R2FtZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgbWFpbi5yZW1vdmVDaGlsZChtb2RhbCk7XG4gICAgICBnYW1lQ29udHJvbGxlci5zdGFydEdhbWUoKTtcbiAgICAgIHN3aXRjaFBvc2l0aW9uQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpXG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiByZW1vdmVGaWVsZHNFdmVudExpc3RlbmVycygpIHtcbiAgICBjb25zdCBkaXNwbGF5ZWRGaWVsZHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmZpZWxkXCIpO1xuXG4gICAgZGlzcGxheWVkRmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICBmaWVsZC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgcGxheU9uQ2xpY2spO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVzZXREaXNwbGF5KCkge1xuICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbFwiKTtcblxuICAgIG1haW4ucmVtb3ZlQ2hpbGQobW9kYWwpO1xuICAgIGdhbWVNb2RlID0gXCJpbml0XCI7XG4gICAgc2hpcExlbmd0aCA9IDE7XG4gICAgZ2FtZUNvbnRyb2xsZXIuaW5pdEdhbWVib2FyZHMoKTtcbiAgfVxuXG4gIC8vIFNISVAgUExBQ0lORyBMT0dJQ1xuXG4gIGZ1bmN0aW9uIHNob3dUYXJnZXRGaWVsZHMoZSkge1xuICAgIHBsYXllck9uZUdhbWVib2FyZCA9IGdhbWVDb250cm9sbGVyLmdldFBsYXllck9uZUdhbWVib2FyZCgpO1xuXG4gICAgcGxheWVyT25lRGlzcGxheS5ib2FyZE9iamVjdCA9IHBsYXllck9uZUdhbWVib2FyZDtcbiAgICBpZiAoc2hpcExlbmd0aCA+IDUpIHJldHVybjtcbiAgICBpZiAoZS50YXJnZXQucGFyZW50RWxlbWVudC5ib2FyZE9iamVjdCAhPT0gcGxheWVyT25lR2FtZWJvYXJkKSB7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgcmVuZGVyZWRGaWVsZHMgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZmllbGRcIikpO1xuXG4gICAgeCA9IGUudGFyZ2V0LmZpZWxkLnBvc2l0aW9uWzBdO1xuICAgIHkgPSBlLnRhcmdldC5maWVsZC5wb3NpdGlvblsxXTtcbiAgICAvLyBjb25zdCBib2FyZCA9IGUudGFyZ2V0LnBhcmVudEVsZW1lbnQuYm9hcmQ7XG4gICAgY29uc3QgYm9hcmQgPSBwbGF5ZXJPbmVHYW1lYm9hcmQuZ2V0Qm9hcmQoKTtcbiAgICBjb25zdCB0YXJnZXRGaWVsZHMgPSBnYW1lYm9hcmRDb250cm9sbGVyLmZpbmRUYXJnZXRGaWVsZHMoXG4gICAgICBzaGlwTGVuZ3RoLFxuICAgICAgeCxcbiAgICAgIHksXG4gICAgICBwb3NpdGlvbixcbiAgICAgIGJvYXJkLFxuICAgICk7XG4gICAgbGV0IHRhcmdldEZpZWxkc1Bvc2l0aW9ucztcbiAgICBsZXQgZGlzcGxheWVkVGFyZ2V0RmllbGRzO1xuICAgIGlmICh0YXJnZXRGaWVsZHMgIT09IGZhbHNlKSB7XG4gICAgICB0YXJnZXRGaWVsZHNQb3NpdGlvbnMgPSB0YXJnZXRGaWVsZHMubWFwKChmaWVsZCkgPT4gZmllbGQucG9zaXRpb24pO1xuICAgICAgZGlzcGxheWVkVGFyZ2V0RmllbGRzID0gcmVuZGVyZWRGaWVsZHMuZmlsdGVyKFxuICAgICAgICAoZmllbGQpID0+XG4gICAgICAgICAgdGFyZ2V0RmllbGRzUG9zaXRpb25zLmluY2x1ZGVzKGZpZWxkLmZpZWxkLnBvc2l0aW9uKSA9PT0gdHJ1ZSxcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChkaXNwbGF5ZWRUYXJnZXRGaWVsZHMpIHtcbiAgICAgIHJldHVybiBkaXNwbGF5ZWRUYXJnZXRGaWVsZHM7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaGlnaGxpZ2h0VGFyZ2V0RmllbGQoZSkge1xuICAgIGNvbnN0IHRhcmdldEZpZWxkcyA9IHNob3dUYXJnZXRGaWVsZHMoZSk7XG4gICAgaWYgKHRhcmdldEZpZWxkcykge1xuICAgICAgdGFyZ2V0RmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiBmaWVsZC5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiB1bmhpZ2hsaWdodFRhcmdldEZpZWxkcyhlKSB7XG4gICAgY29uc3QgdGFyZ2V0RmllbGRzID0gc2hvd1RhcmdldEZpZWxkcyhlKTtcbiAgICBpZiAodGFyZ2V0RmllbGRzKSB7XG4gICAgICB0YXJnZXRGaWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IGZpZWxkLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIikpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBsYWNlU2hpcChlKSB7XG4gICAgaWYgKHNoaXBMZW5ndGggPiA1IHx8IGUudGFyZ2V0LnBhcmVudEVsZW1lbnQgPT09IHBsYXllclR3b0Rpc3BsYXkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgYm9hcmRPYmplY3QgPSBwbGF5ZXJPbmVHYW1lYm9hcmQ7XG4gICAgY29uc3QgYm9hcmQgPSBwbGF5ZXJPbmVHYW1lYm9hcmQuZ2V0Qm9hcmQoKTtcbiAgICBjb25zdCBkaXNwbGF5ZWRCb2FyZCA9IHBsYXllck9uZURpc3BsYXk7XG5cbiAgICBjb25zdCBzaGlwID0gYm9hcmRPYmplY3QucGxhY2VTaGlwKHNoaXBMZW5ndGgsIHgsIHksIHBvc2l0aW9uKTtcbiAgICBpZiAoc2hpcCAhPT0gZmFsc2UpIHtcbiAgICAgIHJlbmRlckdhbWVib2FyZChib2FyZCwgZGlzcGxheWVkQm9hcmQpO1xuICAgICAgc2hpcExlbmd0aCArPSAxO1xuICAgIH1cbiAgICBpZiAoc2hpcExlbmd0aCA+IDUpIGNyZWF0ZVN0YXJ0R2FtZVBvcHVwKCk7XG4gIH1cblxuICBmdW5jdGlvbiBjaGFuZ2VHYW1lTW9kZSgpIHtcbiAgICBjb25zdCBwbGF5ZXJPbmVHYW1lYm9hcmQgPSBnYW1lQ29udHJvbGxlci5nZXRQbGF5ZXJPbmVHYW1lYm9hcmQoKTtcbiAgICBjb25zdCBwbGF5ZXJUd29HYW1lYm9hcmQgPSBnYW1lQ29udHJvbGxlci5nZXRQbGF5ZXJUd29HYW1lYm9hcmQoKTtcbiAgICBpZiAoc2hpcExlbmd0aCA+IDUpIGdhbWVNb2RlID0gXCJnYW1lXCI7XG4gICAgaWYgKHNoaXBMZW5ndGggPCA1KSBnYW1lTW9kZSA9IFwiaW5pdFwiO1xuICAgIHJlbmRlckdhbWVib2FyZHMoXG4gICAgICBwbGF5ZXJPbmVHYW1lYm9hcmQuZ2V0Qm9hcmQoKSxcbiAgICAgIHBsYXllclR3b0dhbWVib2FyZC5nZXRCb2FyZCgpLFxuICAgICk7XG4gIH1cblxuICBmdW5jdGlvbiBzd2l0Y2hQb3NpdGlvbigpIHtcbiAgICBzd2l0Y2ggKHBvc2l0aW9uKSB7XG4gICAgICBjYXNlIFwidmVydGljYWxcIjpcbiAgICAgICAgcG9zaXRpb24gPSBcImhvcml6b250YWxcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiaG9yaXpvbnRhbFwiOlxuICAgICAgICBwb3NpdGlvbiA9IFwidmVydGljYWxcIjtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgc3dpdGNoUG9zaXRpb25CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHN3aXRjaFBvc2l0aW9uKTtcblxuICByZXR1cm4ge1xuICAgIHJlbmRlckdhbWVib2FyZHMsXG4gICAgY3JlYXRlRW5kR2FtZVBvcHVwLFxuICAgIHJlbW92ZUZpZWxkc0V2ZW50TGlzdGVuZXJzLFxuICAgIHBsYXllck9uZURpc3BsYXksXG4gICAgcGxheWVyVHdvRGlzcGxheSxcbiAgfTtcbn1cbiIsImltcG9ydCB7IGdhbWUgfSBmcm9tIFwiLi9nYW1lLmpzXCI7XG5cblxuY29uc3QgZ2FtZUNvbnRyb2xsZXIgPSBnYW1lKClcblxuXG5nYW1lQ29udHJvbGxlci5pbml0R2FtZWJvYXJkcygpXG5cblxuIl0sIm5hbWVzIjpbInNoaXBGYWN0b3J5IiwibGVuZ3RoIiwibnVtYmVyT2ZIaXRzIiwiZ2V0TGVuZ3RoIiwiaGl0IiwiaXNTdW5rIiwiZ2V0TnVtYmVyT2ZIaXRzIiwic2hpcCIsImNvbnNvbGUiLCJsb2ciLCJnYW1lYm9hcmRGYWN0b3J5IiwiYm9hcmQiLCJnZXRCb2FyZCIsImNyZWF0ZUZpZWxkIiwieCIsInkiLCJwb3NpdGlvbiIsIm9jY3VwaWVkQnlTaGlwIiwiZmluZE5laWdoYm91ckZpZWxkcyIsInRhcmdldEZpZWxkcyIsImR1cGxpY2F0ZWROZWlnaGJvdXJzIiwibmVpZ2hib3VycyIsInBvc3NiaWxlTmVpZ2hib3VycyIsImZvckVhY2giLCJmaWVsZCIsImNvb3JkaW5hdGUiLCJpc091dE9mQm91bmQiLCJwdXNoIiwiZmlsdGVyIiwibmVpZ2hib3VyIiwiaW5jbHVkZXMiLCJmaW5kVGFyZ2V0RmllbGRzIiwic2hpcExlbmd0aCIsImRpcmVjdGlvbiIsImkiLCJjaGVja0lmRmllbGRPY2N1cGllZCIsImNhblNoaXBCZVBsYWNlZCIsIm5laWdoYm91ckZpZWxkcyIsInNvbWUiLCJwbGFjZVNoaXAiLCJpbml0R2FtZWJvYXJkIiwiYXJyIiwiaiIsInByaW50Qm9hcmQiLCJyb3ciLCJzdHJpbmciLCJyZWNlaXZlQXR0YWNrIiwiYXJlQWxsU2hpcHNTdW5rIiwiZmllbGRzT2NjdXBpZWRCeVNoaXBzIiwib2NjdXBpZWQiLCJldmVyeSIsInBsYWNlU2hpcHNSYW5kb21seSIsImFtb3VudCIsInBsYWNlZFNoaXBzIiwiY3VycmVudFNoaXBMZW5naHQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJoaXRlZFNoaXAiLCJoaXRlZEZpZWxkIiwidGVtcEhpdGVkRmllbGQiLCJoaXRzIiwiaXNNb3ZlTGVnYWwiLCJmaW5kUmFuZG9tTW92ZSIsInBsYXllciIsImFpIiwiaXNJdFBsYXllcnNUdXJuIiwiaXNBaSIsInBsYXllcnNUdXJuIiwiY2hhbmdlUGxheWVyc1R1cm4iLCJzZWNvbmRQbGF5ZXIiLCJzZWNvbmRQbGF5ZXJUdXJuIiwiZ2V0UGxheWVyc1R1cm4iLCJzZXRQbGF5ZXJzVHVybiIsImF0dGFjayIsImF0dGFja2VkUGxheWVyIiwidW5kZWZpbmVkIiwiYWRqYWNlbnRGaWVsZHMiLCJmaW5kRm91ckFkamFjZW50RmllbGRzIiwicmFuZG9tTW92ZSIsInRlbXAiLCJmaWVsZE9uZSIsImZpZWxkVHdvIiwiYSIsImIiLCJwb3NzaWJsZUZpZWxkcyIsImF4aXMiLCJ0YXJnZXRGaWVsZE9uZSIsInRhcmdldEZpZWxkVHdvIiwiZmluZEFkamFjZW50RmllbGRPbkF4aXMiLCJuZXdIaXRlZEZpZWxkIiwiYWlBdHRhY2siLCJ2YWx1ZSIsInBsYXllck9uZUdhbWVib2FyZCIsInBsYXllclR3b0dhbWVib2FyZCIsImdldFBsYXllck9uZUdhbWVib2FyZCIsImdldFBsYXllclR3b0dhbWVib2FyZCIsInBsYXllck9uZSIsInBsYXllclR3byIsImRvbSIsImdhbWVib2FyZENvbnRyb2xsZXIiLCJnYW1lQ29udHJvbGxlciIsImdhbWUiLCJtYWluIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwicGxheWVyT25lRGlzcGxheSIsInBsYXllclR3b0Rpc3BsYXkiLCJzd2l0Y2hQb3NpdGlvbkJ1dHRvbiIsImZpZWxkcyIsImdhbWVNb2RlIiwicmVuZGVyR2FtZWJvYXJkIiwiYm9hcmREaXNwbGF5IiwiaW5uZXJIVE1MIiwicmVuZGVyZWRGaWVsZCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJwb3N0aW9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsImhpZ2hsaWdodFRhcmdldEZpZWxkIiwidW5oaWdobGlnaHRUYXJnZXRGaWVsZHMiLCJjaGFuZ2VHYW1lTW9kZSIsInBsYXlPbkNsaWNrIiwiYXBwZW5kQ2hpbGQiLCJyZW5kZXJGaWVsZCIsInJlbmRlckdhbWVib2FyZHMiLCJlIiwidGFyZ2V0IiwicGFyZW50RWxlbWVudCIsInBsYXkiLCJpc0dhbWVGaW5pc2hlZCIsInNldFRpbWVvdXQiLCJzaG93VGFyZ2V0RmllbGRzIiwiYm9hcmRPYmplY3QiLCJyZW5kZXJlZEZpZWxkcyIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJ0YXJnZXRGaWVsZHNQb3NpdGlvbnMiLCJkaXNwbGF5ZWRUYXJnZXRGaWVsZHMiLCJtYXAiLCJyZW1vdmUiLCJkaXNwbGF5ZWRCb2FyZCIsIm1vZGFsIiwic3RhcnRHYW1lQnV0dG9uIiwidGV4dENvbnRlbnQiLCJyZW1vdmVDaGlsZCIsInN0YXJ0R2FtZSIsInRvZ2dsZSIsImNyZWF0ZVN0YXJ0R2FtZVBvcHVwIiwiY3JlYXRlRW5kR2FtZVBvcHVwIiwid2lubmVyIiwidGV4dCIsIm5ld0dhbWVCdXR0b24iLCJpbml0R2FtZWJvYXJkcyIsInJlc2V0RGlzcGxheSIsInJlbW92ZUZpZWxkc0V2ZW50TGlzdGVuZXJzIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImRvbUNvbnRyb2xsZXIiLCJlbmRHYW1lIiwicGxheWVyT25lVHVybiIsInBsYXllclR3b1R1cm4iXSwic291cmNlUm9vdCI6IiJ9